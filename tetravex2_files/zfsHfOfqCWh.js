/*!CK:3627568450!*//*1428395070,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["VEZvI"]); }

__d("VaultEditableGrid",["Event","Arbiter","AsyncRequest","CSS","DOM","$","copyProperties","csx","ge","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q={};function r(s,t,u,v){q[s.id]=this;this._grid=s;this._gridID=s.id;this._dialogEndpoint=t;this._collapseWhenEmpty=u;this._attachmentCount=v;this._selectedVaultImageIDs=[];h.subscribe('multi-upload/image-removed/'+this._gridID,function(w,x){p(this._selectedVaultImageIDs,x);this.updateAttachmentCount(this._attachmentCount-1);}.bind(this));h.subscribe('multi-upload/composer-reset/'+this._gridID,function(w,x){this.removeImages();}.bind(this));h.subscribe(['multi-upload/images-upload-start/'+this._gridID,'multi-upload/video-added/'+this._gridID],function(){this.updateAttachmentCount(this._attachmentCount+1);}.bind(this));h.inform('fbVaultEditableGrid/created/'+s.id,this,h.BEHAVIOR_PERSISTENT);h.subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));this.updateAttachmentCount(this._attachmentCount);}m(r,{VAULT_IMAGE:'vault_image',getInstance:function(s){return q[s];},registerDialogWithGrid:function(s,t,u){h.subscribe(['multi-upload/images-upload-start/'+s,'multi-upload/video-added/'+s],u.hide.bind(u));h.subscribe('fbVaultEditableGrid/created/'+s,function(v,w){w._registerDialogWithGrid(t,u);});},onImagesSelected:function(s,t,u){q[s]._onImagesSelected(t,u);}});m(r.prototype,{getRoot:function(){var s=o(this._gridID);if(s){return s;}else return this._grid;},_registerDialogWithGrid:function(s,t){this._dialog=t;var u=this.getMoreLink();u&&g.listen(u,'click',function(){t.show();return false;});t.subscribe('aftershow',function(){var v=[];k.scry(l(this._gridID),'input[type="hidden"]').forEach(function(x){if(x.name.match('composer_vault_images')||x.name.match('composer_unpublished_photo'))v.push(x.value);});var w=s.getGrid();w.bulkChange(function(){var x=w.getSelectionSet();x.clear();x.addAll(v);});}.bind(this));},updateAttachmentCount:function(s){this._attachmentCount=s;if(this._collapseWhenEmpty)j.conditionShow(this._grid,this._attachmentCount>0);},getID:function(){return this._gridID;},_onImagesSelected:function(s,t){var u=k.find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=t;s.forEach(function(v){k.insertBefore(u,v);});h.inform('multi-upload/images-added/'+this._gridID,{fbids:t});this._scrollToRight();},removeImages:function(){k.scry(this.getRoot(),'.fbVaultGridItem').forEach(function(s){if(!j.hasClass(s,'fbVaultEditableGridMoreLink'))k.remove(s);});this._selectedVaultImageIDs=[];h.inform('multi-upload/all-images-removed/'+this._gridID);this.updateAttachmentCount(0);},_scrollToRight:function(){var s=this.getRoot(),t=k.find(s,'.fbScrollableAreaWrap');t.scrollLeft=Math.max(0,k.find(s,'.fbScrollableAreaBody').offsetWidth-t.offsetWidth);},showDialog:function(s,t){if(this._dialog){this._dialog.show();}else i.bootstrap(this._dialogEndpoint,s);},getMoreLink:function(){return k.scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});e.exports=r;},null);
__d("BasePhotoUploader",["Arbiter","ArbiterMixin","CSS","DOM","PhotosMultiUploadInput","VaultEditableGrid","TimelineMapScrollableArea","mixin","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u){"use strict";new m(t,{verticalscroll:true});this.$BasePhotoUploader0=t;this.$BasePhotoUploader1=this.$BasePhotoUploader2();this.$BasePhotoUploader3=false;this.$BasePhotoUploader4=null;u.addSubscriptions(g.subscribe('multi-upload/images-added/'+this.$BasePhotoUploader0.id,function(v,w){var x=Object.assign({},w.fbids);Object.assign(this.$BasePhotoUploader1,x);this.$BasePhotoUploader5();this.inform('upload-completed',{fbids:o(x)});}.bind(this)),g.subscribe('multi-upload/image-removed/'+this.$BasePhotoUploader0.id,function(v,w){for(var x in this.$BasePhotoUploader1)if(this.$BasePhotoUploader1[x]===w){delete this.$BasePhotoUploader1[x];break;}this.$BasePhotoUploader5();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+this.$BasePhotoUploader0.id,function(v,w){i.show(this.$BasePhotoUploader0);this.$BasePhotoUploader3=true;this.inform('dom-updated');this.inform('upload-started',w);}.bind(this)),g.subscribe('multi-upload/composer-reset/'+this.$BasePhotoUploader0.id,this.clear.bind(this)),g.subscribe('multi-upload/all-images-removed/'+this.$BasePhotoUploader0.id,this.$BasePhotoUploader6.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+this.$BasePhotoUploader0.id,function(v){this.$BasePhotoUploader3=false;this.inform('all-uploads-completed');this.$BasePhotoUploader5();}.bind(this)));i.conditionShow(this.$BasePhotoUploader0,Object.keys(this.$BasePhotoUploader1).length);}s.prototype.getSelectedFBIDs=function(){"use strict";var t=Object.keys(this.$BasePhotoUploader1).sort();return t.map(function(u){return this.$BasePhotoUploader1[u];}.bind(this));};s.prototype.isUploading=function(){"use strict";return this.$BasePhotoUploader3;};s.prototype.clear=function(){"use strict";var t=l.getInstance(this.$BasePhotoUploader0.id);t&&t.removeImages();};s.prototype.getWaterfallID=function(){"use strict";return k.getWaterfallID(this.$BasePhotoUploader0.id);};s.prototype.$BasePhotoUploader6=function(){"use strict";this.$BasePhotoUploader1={};this.$BasePhotoUploader3=false;i.hide(this.$BasePhotoUploader0);this.inform('all-uploads-completed');this.inform('dom-updated');};s.prototype.$BasePhotoUploader2=function(){"use strict";var t={},u=-10000;j.scry(this.$BasePhotoUploader0,'input[type="hidden"]').forEach(function(v){if(v.name.match('composer_vault_images')){t[u]=v.value;u--;}});return t;};s.prototype.$BasePhotoUploader5=function(){"use strict";i.conditionShow(this.$BasePhotoUploader0,Object.keys(this.$BasePhotoUploader1).length>0);this.inform('dom-updated');};s.prototype.setCurrentMethod=function(t){"use strict";this.$BasePhotoUploader4=t;};s.prototype.getCurrentMethod=function(){"use strict";return this.$BasePhotoUploader4;};e.exports=s;},null);
__d("MercuryPhotoUploader",["Arbiter","AsyncRequest","copyProperties","DOM","FileInput","Parent","PhotosMultiUploadInput","PUWMethods","VaultEditableGrid","Focus","csx","cx","Event","BasePhotoUploader"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();for(var u in t)if(t.hasOwnProperty(u))w[u]=t[u];var v=t===null?null:t.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=t;function w(x,y,z,aa){"use strict";t.call(this,x,z);this.$MercuryPhotoUploader0=x.id;this.$MercuryPhotoUploader1=false;g.subscribe('PhotosMultiUploadInput/loaded/'+x.id,function(){this.$MercuryPhotoUploader1=true;}.bind(this));g.subscribe('MercuryPhotoUploader/initUploadButton/'+x.id,function(){var ba=j.scry(y,'input[type="file"]')[0];if(!ba)ba=j.create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var ca=l.byClass(y,"_9_h"),da=new k(ca,j.find(ca,"._214"),ba);da.subscribe('change',m.doFileUpload.bind(null,x.id,da));});g.subscribe('MercuryPhotoUploader/registerPhotoMenu/'+x.id,function(ba,ca){var da=ca.menu.getRoot();ca.menu.setContext(y);var ea=j.scry(da,"._d2p"),fa=ea&&ea[0];fa&&s.listen(fa,'click',function(){o.getInstance(x.id).showDialog(fa,o.VAULT_IMAGE);this.setCurrentMethod(n.VAULT);this.inform('selection-start',{method:n.VAULT});}.bind(this));s.listen(y,'click',function(){if(!this.$MercuryPhotoUploader1)return;if(!ca.menu.isShown()){var ha=j.scry(ca.menu.getContentRoot(),'li');this.inform('menu-show');ca.menu.show();if(ha)p.setWithoutOutline(ha[0]);}else{this.inform('menu-hide');ca.menu.hide();}}.bind(this));s.listen(document.documentElement,'click',function(event){if(!j.contains(y,event.getTarget())&&!j.contains(fa,event.getTarget())){if(ca.menu.isShown())this.inform('menu-hide');ca.menu.hide();}}.bind(this));var ga=j.find(da,"._9_h");s.listen(ga,'click',function(){this.setCurrentMethod(n.FILE_SELECTOR);this.inform('selection-start',{method:n.FILE_SELECTOR});}.bind(this));}.bind(this));aa&&m.initDragDrop(x.id,aa);}w.prototype.uploadPastedFile=function(x){"use strict";m.onFilesDrop(this.$MercuryPhotoUploader0,[x]);};w.prototype.addCachedPhotos=function(x){"use strict";h.post('/ajax/vault/selected.php',{max_select:10,grid_id:this.$MercuryPhotoUploader0,source:'messenger',image_ids:x});};i(w,{initUploadButton:function(x){g.inform('MercuryPhotoUploader/initUploadButton/'+x,{},g.BEHAVIOR_PERSISTENT);},registerPhotoMenu:function(x,y){g.inform('MercuryPhotoUploader/registerPhotoMenu/'+x,{menu:y},g.BEHAVIOR_PERSISTENT);}});e.exports=w;},null);
__d("MercuryDrafts",["CacheStorage","MercurySingletonMixin","copyProperties","isEmpty"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){"use strict";this.$MercuryDrafts0=l;this.$MercuryDrafts1=new g('localstorage','mercury-drafts:'+this.$MercuryDrafts0);}k.prototype.saveDraft=function(l,m){"use strict";if(this.isMessageEmpty(m)){this.removeDraft(l);}else this.$MercuryDrafts1.set(l,this.$MercuryDrafts2(l,m));};k.prototype.removeDraft=function(l){"use strict";this.$MercuryDrafts1.remove(l);};k.prototype.getDraft=function(l){"use strict";var m=this.$MercuryDrafts1.get(l,{});return m.message;};k.prototype.isMessageEmpty=function(l){"use strict";return j(l)||(j(l.body)&&j(l.content_attachment)&&j(l.raw_attachments)&&j(l.photo_fbids)&&j(l.image_ids));};k.prototype.$MercuryDrafts2=function(l,m){"use strict";return {thread_id:l,message:m};};i(k,h);e.exports=k;},null);
__d("MercuryDraftsController",["Input","MercurySingletonMixin","copyProperties","isEmpty","MercuryDrafts"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryDrafts').get();function l(m){"use strict";this.$MercuryDraftsController0;}l.prototype.clearDraft=function(m){"use strict";if(this.canSaveDrafts(m))k.removeDraft(m);};l.prototype.saveDraft=function(m,n,o,p,q){"use strict";if(!this.canSaveDrafts(m))return;var r={body:g.getValue(n)};if(!j(o.getAttachments())){r.has_attachment=true;r.raw_attachments=o.getAttachments();}if(!j(o.getImageFiles())){r.has_attachment=true;r.image_ids=o.getImageFiles();}if(q&&!j(q.getSelectedFBIDs())){r.has_attachment=true;r.photo_fbids=q.getSelectedFBIDs();}if(p.getAttachData()){r.has_attachment=true;r.content_attachment=p.getAttachData();}k.saveDraft(m,r);};l.prototype.loadDraft=function(m,n,o,p,q){"use strict";if(!this.canSaveDrafts(m)||this.$MercuryDraftsController1(n,o,p,q))return;var r=k.getDraft(m);if(!j(r)){if(r.body){n.focus();g.setValue(n,r.body);}if(!j(r.raw_attachments))o.addCachedAttachments(r.raw_attachments);if(!j(r.image_ids))o.addCachedImageFiles(r.image_ids);if(!j(r.content_attachment))p.loadShare(r.content_attachment.attachment.params.url);if(q&&!j(r.photo_fbids))q.addCachedPhotos(r.photo_fbids);this.clearDraft(m);}};l.prototype.canSaveDrafts=function(m){"use strict";return !!(m);};l.prototype.$MercuryDraftsController1=function(m,n,o,p){"use strict";return !g.isEmpty(m)||!j(n.getAttachments())||!j(n.getImageFiles())||(p&&!j(p.getSelectedFBIDs()))||o.getAttachData();};l.prototype.toString=function(){"use strict";return '[object MercuryDraftsController:'+this.$MercuryDraftsController0+']';};i(l,h);e.exports=l;},null);
__d("MercuryTypeaheadRenderer",["Event","Badge.react","CSS","DOM","Image.react","MercuryTypeaheadConstants","MercuryParticipantsConstants","React","MercuryTypeaheadTemplates","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();function r(t,u){var v;switch(t.type){case l.HEADER_TYPE:v=o[':fb:mercury:typeahead:header'].build();r.renderHeader(v,t);break;case l.USER_TYPE:case l.PAGE_TYPE:v=o[':fb:mercury:typeahead:result'].build();r.renderPerson(v,t);break;default:throw new Error('Unsupported result type: '+t.type);}return v.getRoot();}p(r,{renderHeader:function(t,u){if(u.disabled){i.hide(t.getRoot());return;}var v=u.getLinkHandler&&u.getLinkHandler();if(v){var w=t.getNode('link');j.setContent(w,u.linkText);g.listen(w,'click',v);}else i.hide(t.getNode('link'));t.setNodeContent('text',u.text);},renderPersonWithBigPhoto:function(t,u){s(t,u,m.BIG_IMAGE_SIZE);},renderPerson:function(t,u){s(t,u,m.IMAGE_SIZE);},renderPage:function(t,u){s(t,u,m.IMAGE_SIZE);}});function s(t,u,v){if(u.photo){var w=n.createElement(k,{width:v,height:v,src:u.photo});n.render(w,t.getNode('image'));}if(u.text){j.setContent(t.getNode('name'),u.text);t.getRoot().setAttribute('aria-label',u.text);}var x=[];if(u.subtext||u.category){if(u.subtext)x.push(u.subtext);if(u.category)x.push(u.category);j.appendContent(t.getNode('snippet'),x.join(" \u00b7 "));}var y=null;if(u.is_verified){y=n.createElement(h,{type:"verified",size:"xsmall"});n.render(y,t.getNode('badge'));}else if(u.is_work_user){y=n.createElement(h,{type:"work",size:"xsmall"});n.render(y,t.getNode('badge'));}if(u.non_employee){if(x.length)j.prependContent(t.getNode('snippet')," \u00b7 ");var z=j.create('span',{className:"_52l8 highlight"},'(Non-Employee)');j.prependContent(t.getNode('snippet'),z);}}e.exports=r;},null);
__d("WebMessengerAddPeopleToConversationDialog",["ContextualTypeaheadView","Dialog","DOM","MercuryAPIArgsSource","MercuryDataSources","MercuryIDs","MercuryLogMessageType","MercurySourceType","MercuryTypeahead","MercuryTypeaheadConstants","MercuryTypeaheadRenderer","WebMessengerTemplates","WorkModeConfig","fbt","MercuryMessageObject","MercuryMessageActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=b('MercuryMessageObject').get(),v=b('MercuryMessageActions').get(),w=b('MercuryThreads').get(),x={show:function(z){var aa=t._("Ajouter des personnes"),ba={};ba[p.FRIEND_TYPE]={uid:p.FRIEND_TYPE,type:p.HEADER_TYPE,disabled:true};ba[p.NON_FRIEND_TYPE]={uid:p.NON_FRIEND_TYPE,text:t._("Autres personnes"),type:p.HEADER_TYPE};var ca=new o(k.get('MercuryRecipientsDataSource'),g);ca.setViewOption('renderer',q);ca.setViewOption('typeObjects',ba);var da=s.is_work_user?t._("Ajouter des coll\u00e8gues \u00e0 cette discussion instantan\u00e9e"):t._("Ajouter des amis \u00e0 cette discussion");ca.setPlaceholder(da);var ea=[];ea.push({name:'subscribe',label:aa,handler:y.bind(null,z,ca)});ea.push(h.CANCEL);var fa=r[':fb:web-messenger:add-people-dialog'].build(),ga=new h().setTitle(aa).setBody(fa.getRoot()).setButtons(ea).showLoading();w.getThreadMeta(z,function(ha){ca.setFullWidthView(fa.getNode('participantsTypeahead'));ca.setExcludedParticipantsFromThreadMeta(ha);ca.build();i.appendContent(fa.getNode('participantsTypeahead'),ca.getElement());ga.show();ca.focus();},j.WEBMESSENGER);}};function y(z,aa){var ba=aa.getTokens(),ca=ba.map(function(da){return l.getParticipantIDFromUserID(da.getValue());});if(!ca.length)return false;v.send(u.constructLogMessageObject(n.TITAN_WEB,z,m.SUBSCRIBE,{added_participants:ca}),null,j.WEBMESSENGER);return true;}e.exports=x;},null);
__d("WebMessengerEditThreadDialog",["Event","Button","ContextualDialog","CSS","DOM","FileInput","FileInputUploader","Input","InputSelection","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","WebMessengerTemplates","URI","WebMessengerSubscriptionsHandler","csx","cx","MercuryMessageObject","MercuryMessageActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();var aa=b('MercuryMessageObject').get(),ba=b('MercuryMessageActions').get(),ca=b('MercuryThreads').get(),da=':fb:web-messenger:read-view:header:edit-multichat';function ea(){"use strict";var fa=v[da].build();this._dialog=new i({position:'below',addedBehaviors:[p,q,r]},fa.getRoot());this._saveButton=fa.getNode('saveButton');this._cancelButton=fa.getNode('cancelButton');this._pictureInput=fa.getNode('newPicture');this._uploadButton=fa.getNode('uploadButton');this._uploadingThrobber=fa.getNode('uploadingThrobber');this._uploadedFileDetails=fa.getNode('uploadedFileDetails');this._fileNameNode=fa.getNode('fileName');this._cancelImageButton=fa.getNode('cancelImage');this._threadID=null;var ga=fa.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var ha=k.scry(fa.getRoot(),"._8-9")[0];this._pictureInput=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new l(ha,this._uploadButton,this._pictureInput);}var ia=w('/ajax/mercury/upload.php').setSubdomain('upload').toString();this._uploader=new m(this._pictureInput).setURI(ia).setAllowCrossOrigin(true).setData({images_only:true});x.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),this._uploader.subscribe('failure',this._onFileUploadFailure.bind(this)),g.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),g.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));g.listen(this._saveButton,'click',function(){this.save(n.getValue(ga));this._dialog.hide();}.bind(this));g.listen(this._cancelButton,'click',function(){this._dialog.hide();}.bind(this));this._dialog.subscribe('show',function(){var ja=ca.getThreadMetaNow(this._threadID);n.setValue(ga,ja.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){o.set(ga,0,n.getValue(ga).length);}.bind(this));}ea.prototype.toggleShown=function(fa,ga){"use strict";if(!this._dialog.isShown()){this._dialog.setContext(fa);this._threadID=ga;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};ea.prototype.save=function(fa){"use strict";var ga=null,ha=ca.getThreadMetaNow(this._threadID);if(ha)ga=ha.name;if((fa||ga)&&(fa!=ga))ba.send(aa.constructLogMessageObject(u.CHAT_WEB,this._threadID,t.THREAD_NAME,{name:fa}),null,s.WEBMESSENGER);if(this._uploadedImage)ba.send(aa.constructLogMessageObject(u.CHAT_WEB,this._threadID,t.THREAD_IMAGE,{image:this._uploadedImage}));};ea.prototype._onFileUploadChange=function(event){"use strict";var fa=n.getValue(event.getTarget());if(fa){h.setEnabled(this._saveButton,false);j.hide(this._uploadButton);j.hide(this._uploadedFileDetails);j.show(this._uploadingThrobber);this._uploader.send();}};ea.prototype._onFileUploadSuccess=function(fa,ga){"use strict";var ha=ga.response.getPayload();this._uploadedImage=ha.metadata[0];k.setContent(this._fileNameNode,this._uploadedImage.filename);j.hide(this._uploadingThrobber);j.hide(this._uploadButton);j.show(this._uploadedFileDetails);h.setEnabled(this._saveButton,true);};ea.prototype._onFileUploadFailure=function(fa,ga){"use strict";h.setEnabled(this._saveButton,true);this._resetImageUpload();};ea.prototype._resetImageUpload=function(){"use strict";this._uploadedImage=null;this._pictureInput.value=null;j.hide(this._uploadingThrobber);j.hide(this._uploadedFileDetails);j.show(this._uploadButton);};e.exports=ea;},null);
__d("MercuryPresence",["Arbiter","AvailableListConstants","DOM","CSS","requireWeak","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m={},n={},o={updateOnPresenceChanges:function(u,v){n[v.tagName]=true;m[u]=true;j.addClass(v,'presenceListener_'+u);var w=p(u);q(v,w.classes);r(v,w.label);}};function p(u){var v=t(u),w={presenceActive:false,presenceMobile:false},x=null;switch(v){case h.ACTIVE:w.presenceActive=true;x=l._("Actif");break;case h.MOBILE:w.presenceMobile=true;x=l._("Mobile");break;default:break;}return {classes:w,label:x};}function q(u,v){for(var w in v)j.conditionClass(u,w,v[w]);}function r(u,v){if(u&&v){var w=i.create('span',{className:'accessible_elem'},v);i.setContent(u,w);}}function s(){for(var u in m){var v=p(u);for(var w in n){var x=i.scry(document,w+'.presenceListener_'+u);for(var y=0;y<x.length;y++){q(x[y],v.classes);r(x[y],v.label);}}}}var t=function(u){return h.OFFLINE;};k(['AvailableList'],function(u){t=u.get;s();});g.subscribe(h.ON_AVAILABILITY_CHANGED,s);e.exports=o;},null);
__d("WebMessengerStateConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet',SHARED_PHOTOS:'shared-photos'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete',REPORT_SPAM:'report_spam'}};e.exports=g;},null);
__d("MercuryFilters",["MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=[g.UNREAD],j={ALL:'all',getSupportedFilters:function(){return i.concat();},isSupportedFilter:function(k){return h(i,k);}};e.exports=j;},null);
__d("WebMessengerOldToNewPermalink",["WebMessengerPermalinkConstants","WebMessengerStateConstants"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(n){if(!j(n))return n;k(n);m(n);l(n);return n;}function j(n){var o=n.getQueryData();if(o.sk)switch(o.sk){case 'inbox':n.setPath(g.BASE_PATH);n.removeQueryData('sk');break;case 'other':n.setPath(g.OTHER_PATH);n.removeQueryData('sk');break;default:return false;}return true;}function k(n){var o=n.getQueryData();switch(o.action){case 'read':if(!o.tid){n.addQueryData({action:h.DETAIL.RECENT_MESSAGES});}else n.removeQueryData('action');break;}}function l(n){var o=n.getQueryData();if(o.tid){n.setPath(g.getURIPathForThreadID(o.tid,n.getPath()));n.removeQueryData('tid');}}function m(n){var o=n.getQueryData();if(!n.getPath().match(g.SEARCH_POSTFIX_PATH)&&o.action!=h.DETAIL.SEARCH_SNIPPET&&!o.mid){var p=o.query;if(o.query){var q=/\bis:(archived|spam)\b(.*)/,r=q.exec(o.query);if(r){switch(r[1]){case 'archived':n.setPath(g.ARCHIVED_PATH);break;case 'spam':n.setPath(g.SPAM_PATH);break;}var s=o.query.substr(0,o.query.length-r[0].length),t=r[2];p=(s.trim()+' '+t.trim()).trim();}}if(o.thread_query){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.setQueryData({query:o.thread_query});}else if(p){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.addQueryData({query:p});}else n.removeQueryData('query');}}e.exports=i;},null);
__d("WebMessengerStateStore",["MercuryAssert","PresenceState"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=null;function j(){var l=h.get();if(l&&l.wml)return l.wml;return {};}h.registerStateStorer(function(l){if(i)l.wml=i;i=null;});var k={getLastSeenThreadID:function(){var l=j();return l.thread_id||null;},getLastSeenFolder:function(){var l=j();return l.folder||null;},setLastSeen:function(l,m){m&&g.isThreadID(m);i={folder:l,thread_id:m||null};h.doSync();}};e.exports=k;},null);
__d("WebMessengerPermalinks",["MercuryAPIArgsSource","MercuryFilters","MercuryIDs","MercuryParticipants","MercuryParticipantTypes","MercuryTypeaheadConstants","MessagingTag","WebMessengerOldToNewPermalink","WebMessengerPermalinkConstants","WebMessengerStateConstants","WebMessengerStateStore","Token","URI","WebMessengerPreferences","WWWBase","MercuryUnreadState","isWebMessengerURI","goURI","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y=b('MercuryServerRequests').get(),z=b('MercuryThreads').get(),aa='(/|\\?|$)',ba={getDefaultURI:function(){var oa=new s(u.uri);oa.setPath(o.BASE_PATH);return oa;},goNextURI:function(oa,pa,qa,ra){if(ka(oa,pa,qa)){var sa=ba.getURI(oa,pa,qa);x(sa,false,ra);return true;}return false;},getURI:function(oa,pa,qa){var ra=ba.getDefaultURI();if(!oa||!pa||!qa)return ra;switch(qa.folder){case m.OTHER:ra.setPath(o.OTHER_PATH);break;case m.ACTION_ARCHIVED:ra.setPath(o.ARCHIVED_PATH);break;case m.SPAM:ra.setPath(o.SPAM_PATH);break;}if(qa.filter&&(qa.filter!=h.ALL))ra.addQueryData({filter:qa.filter});var sa;switch(oa){case p.MASTER.SEARCH:sa=false;ra.setPath(ra.getPath()+o.SEARCH_POSTFIX_PATH);break;}switch(pa){case p.DETAIL.COMPOSE_MAIN:case p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ra.setPath(ra.getPath()+o.COMPOSE_POSTFIX_PATH);sa=false;break;case p.DETAIL.RECENT_MESSAGES:sa=!qa.thread_id;break;case p.DETAIL.SEARCH_CONTEXT:case p.DETAIL.SHARED_PHOTOS:sa=false;break;default:sa=true;break;}if(sa)ra.addQueryData({action:pa});if(qa.thread_id){var ta=i.getUserIDFromThreadID(qa.thread_id),ua=ta&&j.getNow(i.getParticipantIDFromUserID(ta));if(ua&&ua.type!==k.EVENT){var va=(ua&&ua.vanity)||ta;ra.setPath(o.getURIPathForIDOrVanity(va,ra.getPath()));}else{var wa=y.getServerThreadIDNow(qa.thread_id),xa=wa?wa:qa.thread_id;ra.setPath(o.getURIPathForThreadID(xa,ra.getPath()));}}if(qa.query)ra.addQueryData({query:qa.query});if(qa.message_query)ra.addQueryData({mquery:qa.message_query});if(qa.message_id)ra.addQueryData({mid:qa.message_id});if(qa.reuse_composer)ra.addQueryData({rc:true});if(qa.isStandaloneMode)ra.addQueryData({standalone:true});return ra;},processURI:function(oa){oa=n(oa);if(!w(oa))return false;var pa,qa=la(oa),ra=(!qa.master_state||!qa.detail_state);if(ra){pa=ma(oa);}else{pa={data:{folder:ia(oa),filter:ja(oa)},redirect:false,master_state:qa.master_state,detail_state:qa.detail_state};if(oa.getQueryData().rc)pa.data.reuse_composer=true;pa=fa(oa,pa);}pa.data.isStandaloneMode=oa.getQueryData().standalone;if(ra)return pa;switch(qa.detail_state){case p.DETAIL.RECENT_MESSAGES:return ha(oa,pa);case p.DETAIL.COMPOSE_MAIN:return ca(oa,pa);case p.DETAIL.SEARCH_SNIPPET:pa=ga(oa,pa);return pa;case p.DETAIL.SEARCH_CONTEXT:pa=ha(oa,pa);pa=ga(oa,pa);return ea(oa,pa);}pa.redirect=true;pa.detail_state=null;return pa;}};function ca(oa,pa){var qa=null;if(oa.getQueryData().to)qa=[].concat(oa.getQueryData().to);return da(qa,pa);}function da(oa,pa){if(oa){pa.data.new_tokens=[];oa.forEach(function(qa){var ra=j.getNow(i.getParticipantIDFromUserID(qa));if(ra){var sa={uid:qa,text:ra.name,type:l.USER_TYPE};pa.data.new_tokens.push(new r(sa));}});}pa.data.start=true;return pa;}function ea(oa,pa){var qa=oa.getQueryData().mid;if(qa){pa.data.message_id=qa;}else pa.redirect=true;return pa;}function fa(oa,pa){var qa=oa.getQueryData().query;pa.data.query=qa;return pa;}function ga(oa,pa){var qa=oa.getQueryData().mquery;pa.data.message_query=qa;return pa;}function ha(oa,pa){var qa=o.getThreadIDFromURI(oa);if(qa){var ra=i.isValidThreadID(qa)?qa:y.getClientThreadIDNow(qa)||y.getClientThreadIDForPermalinks(qa);if(ra){pa.data.thread_id=ra;}else pa.redirect=true;}else{var sa=o.getUserIDOrVanity(oa.getPath());if(sa){var ta=j.getIDFromVanityOrFBID(sa),ua=ta&&z.getCanonicalThreadToParticipant(ta,null,g.WEBMESSENGER);if(ua){if(ua.timestamp){pa.data.thread_id=ua.thread_id;}else{pa.detail_state=p.DETAIL.COMPOSE_MAIN;pa=da([i.getUserIDFromParticipantID(ta)],pa);}}else pa.redirect=true;}}return pa;}function ia(oa,pa){var qa=oa.getPath();if(qa.match('^'+o.ARCHIVED_PATH+aa))return m.ACTION_ARCHIVED;if(qa.match('^'+o.OTHER_PATH+aa))return m.OTHER;if(qa.match('^'+o.SPAM_PATH+aa))return m.SPAM;if(pa!==(void 0))return pa;return m.INBOX;}function ja(oa){return oa.getQueryData().filter||h.ALL;}function ka(oa,pa,qa){if(pa===p.DETAIL.SEARCH_CONTEXT||pa===p.DETAIL.SEARCH_THREAD_SNIPPET||pa===p.DETAIL.SHARED_PHOTOS)return false;if(qa&&qa.no_uri===true){delete qa.no_uri;return false;}var ra=pa==p.DETAIL.COMPOSE_MAIN||pa==p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||pa==p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(ra&&(!qa.start||qa.new_tokens))return false;if(!oa||!pa||!qa)return true;if(qa.bug_reporting_enabled)return false;return !qa.message_action;}function la(oa){var pa={},qa=oa.getPath(),ra=oa.getQueryData(),sa=qa.match(o.BASE_PATH+'(/[^/]+)?'+o.SEARCH_POSTFIX_PATH+aa);pa.master_state=sa&&ra.query?p.MASTER.SEARCH:p.MASTER.RECENT_THREADS;if(ra.action){pa.detail_state=ra.action;return pa;}if(qa.match('(?:'+o.BASE_PATH+'|'+o.OTHER_PATH+')'+'(/[^/]+)?'+o.COMPOSE_POSTFIX_PATH+aa)){pa.detail_state=p.DETAIL.COMPOSE_MAIN;return pa;}if(qa.match(o.TID_POSTFIX_PARTIAL_PATH)||o.getUserIDOrVanity(qa)){if(ra.mid&&ra.mquery){pa.detail_state=p.DETAIL.SEARCH_CONTEXT;}else pa.detail_state=p.DETAIL.RECENT_MESSAGES;}else if(ra.mquery)pa.detail_state=p.DETAIL.SEARCH_SNIPPET;return pa;}function ma(oa){var pa=ia(oa,null)||q.getLastSeenFolder(),qa=q.getLastSeenThreadID()||na(pa||m.INBOX),ra=v.get();if(pa===m.OTHER&&ra.getUnreadCount(pa)===0){var sa=m.INBOX;if(ra.exceedsMaxCount(sa)||ra.getUnreadCount(sa)>0)pa=sa;}var ta={redirect:!!qa||!!pa,replace:true,master_state:p.MASTER.RECENT_THREADS,detail_state:p.DETAIL.RECENT_MESSAGES,data:{folder:pa||m.INBOX,filter:h.ALL,thread_id:qa}};return ta;}function na(oa){var pa=t.lastReadThreadForFolder[oa];if(pa){var qa=pa.canonical_fbid||pa.thread_fbid;return y.getClientThreadIDNow(qa)||null;}else return null;}e.exports=ba;},null);
__d("WebMessengerStateManager",["Arbiter","CurrentUser","Dialog","Focus","JSLogger","MercuryFilters","MessagingTag","WebMessengerPermalinks","WebMessengerStateConstants","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=k.create('wm_state_manager'),r=h.getID(),s=false,t=p(new g(),{getCurrentUserID:function(){return r;},getCurrentMasterState:function(){return w;},getCurrentDetailState:function(){return x;},getCurrentStateData:function(){return y;},getStandaloneMode:function(){return s;},setUserID:function(aa){r=aa||h.getID();},setStandaloneMode:function(aa){s=Boolean(aa);},updateMasterState:function(aa,ba){t.updateAllStates(aa,x,ba);},updateDetailState:function(aa,ba){t.updateAllStates(w,aa,ba);},updateAllStates:function(aa,ba,ca){for(var da=0;da<z.length;da++)if(z[da]){var ea=z[da](aa,ba,ca);if(ea){q.log('confirmation_dialog',{master_state:w,detail_state:x,data:y,new_master_state:aa,new_detail_state:ba,new_data:ca});ea.setHandler(u.bind(null,aa,ba,ca)).show();var fa=ea.getButtonElement(i.OK.label);fa&&j.set(fa);return;}}u(aa,ba,ca);},updateStateOnURI:function(aa,ba,ca){v(aa,ba,ca);},registerConfirmationBeforeStateUpdate:function(aa){var ba=z.length;z.push(aa);return ba;},unregisterConfirmationBeforeStateUpdate:function(aa){delete z[aa];}});function u(aa,ba,ca){if(!ca.folder)ca.folder=y.folder;if(!ca.filter)ca.filter=y.filter;ca.isStandaloneMode=t.getStandaloneMode();if(!n.goNextURI(aa,ba,ca))v(aa,ba,ca);}function v(aa,ba,ca){w=aa;x=ba;y=ca;var da=p({},y);da.new_tokens=[];(y.new_tokens||[]).forEach(function(ea){da.new_tokens.push(ea.getInfo());});da.new_tokens=[];q.log('state_updated',{master_state:w,detail_state:x,data:da});t.inform(o.STATE_CHANGE_EVENT);}var w=o.MASTER.RECENT_THREADS,x=o.DETAIL.RECENT_MESSAGES,y={thread_id:null,folder:m.INBOX,filter:l.ALL},z=[(void 0)];e.exports=t;},null);
__d("WebMessengerDetailViewHeaderControl",["WebMessengerAddPeopleToConversationDialog","Autosize","AvailableListConstants","Bootloader","ContextualDialog","CSS","DOM","WebMessengerEditThreadDialog","Event","HovercardLink","HoverFlyout","JSXDOM","LastMobileActiveTimes","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","MercuryAPIArgsSource","MercuryIDs","MercuryThreadInfo","MercuryViewer","MercuryParticipants","MercuryPresence","ScrollableArea","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","Tooltip","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","csx","cx","curry","fbt","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa){b.__markCompiled&&b.__markCompiled();var qa=b('MercuryThreadInformer').get(),ra=b('MercuryThreadMetadataRenderer').get(),sa=b('MercuryThreads').get(),ta=null;function ua(bb){"use strict";this._rootElement=bb;m.empty(this._rootElement);this._renderHeaderBar();}ua.prototype.hideView=function(){"use strict";l.hide(this._rootElement);};ua.prototype.updateView=function(){"use strict";l.removeClass(this._rootElement,'hasMultiChatThreadActions');l.show(this._rootElement);if(this._listener){qa.unsubscribe(this._listener);this._listener=null;}var bb=da;switch(ea.getCurrentDetailState()){case bb.DETAIL.RECENT_MESSAGES:case bb.DETAIL.SEARCH_CONTEXT:case bb.DETAIL.SEARCH_THREAD_SNIPPET:case bb.DETAIL.SHARED_PHOTOS:this.setThreadID(ea.getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}ja.detailDOMChanged();};ua.prototype.setThreadID=function(bb){"use strict";this._threadID=bb;if(this._threadID){this._listener=qa.listen(this._threadID,this.updateView.bind(this));ka.addSubscriptions(this._listener);}bb&&sa.getThreadMeta(bb,function(cb){if(this._threadID==bb)l.conditionClass(this._rootElement,'hasMultiChatThreadActions',!cb.is_canonical&&y.canReply(cb));}.bind(this));};ua.prototype._renderHeaderBar=function(){"use strict";this._headerBar=ga[':fb:web-messenger:read-view:header'].build();m.appendContent(this._rootElement,this._headerBar.getRoot());var bb=this._headerBar.getNode('editThreadName'),cb=this._headerBar.getNode('addPeopleToThread'),db=new n();this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');ka.addSubscriptions(o.listen(this._headerBar.getNode('closeButton'),'click',function(){var eb=la(ea.getCurrentStateData(),{all_people_query:(void 0)});ea.updateDetailState(da.DETAIL.COMPOSE_MAIN,eb);}),o.listen(bb,'click',function(event){this._threadID&&db.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),o.listen(cb,'click',function(event){this._threadID&&g.show(this._threadID);return true;}.bind(this)),ja.subscribe(ja.DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));};ua.prototype.updateHeaderBar=function(){"use strict";var bb=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var cb=r.span(null);m.setContent(this._title_node_wrapper,cb);var db=this._headerBar.getNode('webMessengerRecIndicator');db&&l.hide(db);var eb=ea.getCurrentDetailState(),fb=eb==da.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;l.conditionShow(this._headerBar.getNode('closeButton'),fb);l.conditionClass(this._title_node_wrapper,'allPeopleResults',fb);l.hide(this._relationship_status);l.removeClass(this._title_node_wrapper,"_50jz");var gb,hb;switch(eb){case da.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:hb=ea.getCurrentStateData().all_people_query;gb=pa._("Personnes correspondant \u00e0 {query}",[pa.param("query",m.create('strong',{},hb))]);break;case da.DETAIL.COMPOSE_MAIN:case da.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:gb=pa._("Nouveau message");break;case da.DETAIL.SEARCH_SNIPPET:hb=ea.getCurrentStateData().message_query;if(hb)gb=pa._("Messages contenant le mot\u00a0: {query}",[pa.param("query",hb)]);break;}var ib=!gb&&!this._threadID;if(ib)gb=pa._("Aucune s\u00e9lection");l.conditionClass(this._title_node_wrapper,"_3jd",ib);if(gb){m.setContent(cb,gb);ab(this._title_node_wrapper,this._threadID,bb,db);return;}ra.renderAndSeparatedParticipantList(this._threadID,cb,{check_length:false,names_renderer:function(jb){var kb=jb.map(function(mb){var nb=jb.length===1?mb.name:mb.short_name,ob=mb.id?x.getUserIDFromParticipantID(mb.id):null;if(ob&&mb.href){var pb=r.a({href:mb.href},nb);if(jb.length===1)pb.setAttribute('data-hovercard',p.constructEndpoint({id:ob}));if(ea.getStandaloneMode())pb.setAttribute('target','_blank');return pb;}else return nb;}.bind(this));if(jb.length===1&&jb[0].fbid!==null){var lb=r.span(null);m.setContent(lb,kb[0]);wa(jb[0],lb);kb[0]=lb;}return kb;}.bind(this)});if(db)sa.getThreadMeta(this._threadID,function(jb){xa(jb,db);});this.renderParticipantListFlyout(cb);this.renderNamedThreadParticipantCount(cb);ab(this._title_node_wrapper,this._threadID,bb,db);new h(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});};ua.prototype.renderNamedThreadParticipantCount=function(bb){"use strict";sa.getThreadMeta(this._threadID,function(cb){if(cb.name){var db=ra.renderParticipantCount(cb.thread_id,{count:cb.participants.length}),eb=m.create('span',{className:"_1us"},pa._("({participants})",[pa.param("participants",db)]));m.appendContent(bb,eb);}},w.WEBMESSENGER);};ua.prototype.renderParticipantListFlyout=function(bb){"use strict";this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var cb=this._threadID;sa.getThreadMeta(this._threadID,function(db){var eb=db.participants;if(!db.name){eb=eb.filter(function(fb){return fb!==z.getID();});if(eb.length<=1)return;}aa.getMulti(eb,function(fb){if(this._threadID!=cb)return;var gb=0,hb=ga[':fb:web-messenger:flyoutlist'].build();for(var ib in fb){var jb=fb[ib],kb=ga[':fb:web-messenger:flyoutlist-profile-item'].build();kb.getNode('profilePhoto').setAttribute('src',jb.image_src);var lb=kb.getNode('title');if(jb.href){var mb=r.a({href:jb.href});m.setContent(lb,mb);lb=mb;var nb=kb.getNode('profilePhoto'),ob=r.a({href:jb.href});m.replace(nb,ob);m.setContent(ob,nb);if(ea.getStandaloneMode()){mb.setAttribute('target','_blank');ob.setAttribute('target','_blank');}}m.setContent(lb,jb.name);wa(jb,kb.getNode('title'));m.setContent(kb.getNode('infoLine'),za(jb));gb++;m.appendContent(hb.getNode('list'),kb.getRoot());}var pb=hb.getRoot();this._dialog=new k({context:bb,position:'below',addedBehaviors:[t,u,v]},pb);this._flyout=new q();this._flyout.init(this._dialog);this._flyout.initNode(bb);ya(this._flyout,pb,gb);}.bind(this));}.bind(this),w.WEBMESSENGER);};ua.prototype.destroy=function(){"use strict";};function va(bb,cb,db){var eb=s.getShortDisplay(db);if(!eb||bb.get(db)!==i.MOBILE){ha.remove(cb);return;}ha.set(cb,pa._("Actif il y a {time}",[pa.param("time",eb)]),'right');}function wa(bb,cb){var db=x.getUserIDFromParticipantID(bb.id);if(!db)return;var eb=r.span(null);ba.updateOnPresenceChanges(db,eb);if(m.isNode(cb)){j.loadModules(["PresenceStatus","ChatOpenTab"],function(fb,gb){o.listen(eb,'mouseenter',oa(va,fb,eb,db));o.listen(eb,'click',gb.openUserTab.bind(null,db,'web messenger header'));});m.appendContent(cb,eb);}}function xa(bb,cb){if(cb)aa.getMulti(bb.participants,function(db){var eb=true;for(var fb in db)eb=eb&&db[fb].employee;l.conditionShow(cb,eb);});}function ya(bb,cb,db){if(db<=ia.MAX_VISIBLE_IN_FLYOUT)return;var eb=ca.fromNative(cb,{fade:true});cb.style.height=ia.PARTICIPANTS_FLYOUT_HEIGHT+'px';bb.subscribe('show',function(){eb.showScrollbar(false);});}function za(bb){var cb=bb.social_snippets||{},db=Object.keys(cb);if(db.length>0){var eb=db.slice(0,1).map(function(jb){return cb[jb];});return eb;}var fb=bb.networks||{},gb=Object.keys(fb),hb=gb.length>0,ib=2;if(hb){var eb=gb.slice(0,ib).map(function(jb){return fb[jb];});return eb.join(' \u00b7 ');}return '';}function ab(bb,cb,db,eb){var fb=db.offsetWidth;if(eb){ta=ta||eb.offsetWidth;fb+=ta;}var gb=m.scry(document.body,"div._2nd");if(gb.length)fb+=gb[0].offsetWidth;var hb=bb.parentNode.offsetWidth;if(hb>fb)fa.set(bb,'max-width',(hb-fb)+'px');}e.exports=ua;},null);
__d("WebMessengerFlexibleArea",["Event","ArbiterMixin","CSS","cx","DOM","Style","throttle","Vector","createArrayFromMixed","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=[];function r(){q.forEach(function(w){w.draw();});}g.listen(window,'resize',m(r,50));var s=p(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w){"use strict";this.minFlexAreaHeight=0;this.flexArea=w;this.container=null;this.padding=0;this.sizeToFit=false;q.push(this);}v.prototype.setContainer=function(w){"use strict";this.container=w;return this;};v.prototype.setPadding=function(w){"use strict";this.padding=w;return this;};v.prototype.setMinFlexAreaHeight=function(w){"use strict";this.minFlexAreaHeight=w;return this;};v.prototype.setSizeToFit=function(w){"use strict";this.sizeToFit=w;return this;};v.prototype.draw=function(){"use strict";if(this.flexArea){var w=this._flexHeight;this.inform('predraw',{old_height:w});var x=n.getViewportDimensions().y-this.padding;x-=n.getElementPosition(this.container||this.flexArea).y;if(this.container){o(this.container.childNodes).forEach(function(y){x-=n.getElementDimensions(y).y;});x+=n.getElementDimensions(this.flexArea).y;}if(this.sizeToFit)x=Math.min(x,this._getNaturalHeight());if(x<this.minFlexAreaHeight)x=this.minFlexAreaHeight;if(isNaN(x)||x<0)x=0;if(x!==w){l.set(this.flexArea,'height',x+'px');this._flexHeight=x;this.inform('height_changed',{height:x,old_height:w});}}return this;};v.prototype.destroy=function(){"use strict";var w=q.indexOf(this);w>=0&&q.splice(w,1);r();};v.prototype._getNaturalHeight=function(){"use strict";var w=this.flexArea.cloneNode(true);i.addClass(w,"_2ys");l.set(w,'height','auto');k.insertAfter(this.flexArea,w);var x=n.getElementDimensions(w).y;k.remove(w);return x;};v.prototype._getFlexHeight=function(){"use strict";if(isNaN(this._flexHeight))this._flexHeight=n.getElementDimensions(this.flexArea).y;return this._flexHeight;};e.exports=v;},null);
__d("WebMessengerFlexibleScrollArea",["CSS","DOMQuery","ScrollableArea","Style","WebMessengerFlexibleArea","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();for(var m in k)if(k.hasOwnProperty(m))o[m]=k[m];var n=k===null?null:k.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=k;function o(p,q){"use strict";this._scroll=i.fromNative(p,q);k.call(this,p);this._scrollBody=h.find(this.flexArea,'.uiScrollableAreaBody');var r=h.scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=r.length?r[0]:null;this._scrollContent=h.find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallbacks=[];this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',l(this._onScroll,50,this));this._nearTop=false;this._nearBottom=false;}o.prototype.showAtTop=function(p){"use strict";if(p){j.set(this._scrollContent,'top','0');j.set(this._scrollContent,'bottom','');}else{j.set(this._scrollContent,'top','');j.set(this._scrollContent,'bottom','0');}};o.prototype.setBottomAligned=function(p){"use strict";var q=p!==false;if(this._bottomEdgeBias===q)return;g.conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',q);this._bottomEdgeBias=q;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);setTimeout(this.poke.bind(this),0);return this;};o.prototype.setInfiniteScrollHandler=function(p,q){"use strict";if(q){this._infiniteUpwardScrollHandler=p;}else this._infiniteDownScrollHandler=p;return this;};o.prototype.addScrollCallback=function(p){"use strict";this._scrollCallbacks.push(p);return this;};o.prototype.setTabbable=function(p){"use strict";this._scroll._wrap.setAttribute('tabindex',p?'0':'-1');};o.prototype.poke=function(p,q){"use strict";var r=this._scrollHeight,s=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof r=='undefined'||(q&&!q.old_height)){this._bottomEdgeBias&&this._setShadowHeight();return;}var t=this._scrollHeight-r;if(this._bottomEdgeBias){var u=q?q.height-q.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=setTimeout(this.poke.bind(this),200);var v,w=t-u;if(this._scrollHeight>this._getFlexHeight()){v=s+w;v=v<0?0:v;}else v=0;w>0&&this._setShadowHeight();if(v!==s)this._scroll.setScrollTop(v,false);w<0&&this._setShadowHeight();}else if(t)this._scroll.setScrollTop(s,false);};o.prototype.setScrollTop=function(p,q){"use strict";this._scroll.setScrollTop(p,q);};o.prototype.getScrollableArea=function(){"use strict";return this._scroll;};o.prototype.isScrolledToBottom=function(){"use strict";return this._scroll.isScrolledToBottom();};o.prototype.scrollToBottom=function(p){"use strict";this._scroll.scrollToBottom(p);if(this._bottomEdgeBias)this._scrollBottom=0;};o.prototype.isScrolledToTop=function(){"use strict";return this._scroll.getScrollTop()===0;};o.prototype.scrollToTop=function(p){"use strict";this._scroll.scrollToTop(p);};o.prototype.scrollIntoView=function(p,q){"use strict";this._scroll.scrollIntoView(p,q);};o.prototype.destroy=function(){"use strict";this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);n.destroy.call(this);this._scroll.destroy();};o.prototype._getScrollHeight=function(){"use strict";if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();};o.prototype._setShadowHeight=function(){"use strict";var p=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==p)j.set(this._shadow,'height',this._shadowHeight+'px');};o.prototype._onScroll=function(){"use strict";var p=this._scroll.getScrollTop(),q=this._getScrollHeight();if(p<this._getFlexHeight()){if(!this._nearTop){this._nearTop=true;this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();}}else this._nearTop=false;if(p+2*this._getFlexHeight()>q){if(!this._nearBottom){this._nearBottom=true;this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();}}else this._nearBottom=false;this._scrollCallbacks.forEach(function(r){return r(this._scroll);}.bind(this));};e.exports=o;},null);
__d("ListInputTargetTracker",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){"use strict";this._index=(void 0);this._items=[];}g.prototype.getIndex=function(){"use strict";return this._index;};g.prototype.setIndex=function(h){"use strict";this._index=Math.max(0,Math.min(h,this._items.length-1));};g.prototype.getNumItems=function(){"use strict";return this._items.length;};g.prototype.getItem=function(){"use strict";if(this._index!==(void 0))return this._items[this._index];};g.prototype.setTargetItem=function(h){"use strict";this.updateIndex(this._items,h);};g.prototype.addItem=function(h){"use strict";this._items.push(h);};g.prototype.removeItemAtIndex=function(h){"use strict";this._items.splice(h,1);};g.prototype.removeItemByValue=function(h){"use strict";var i=this._items.indexOf(h);this.removeItemAtIndex(i);};g.prototype.moveUp=function(){"use strict";if(this._index===(void 0)||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;};g.prototype.moveDown=function(){"use strict";if(this._index===(void 0)||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;};g.prototype.updateIndex=function(h,i){"use strict";this._items=h||[];if(i){var j=this._items.indexOf(i);if(j>=0){this._index=j;}else if(this._index!==(void 0))if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=(void 0);}else this._index=(void 0);return this._index;};e.exports=g;},null);
__d("WebMessengerShortcuts",["DialogX","DOM","KeyEventController","LayerHideOnEscape","ListInputTargetTracker","MercuryAPIArgsSource","MessagingTag","Parent","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","UserAgent_DEPRECATED","WebMessengerEvents","BanzaiODS","arrayContains","csx","cx","fbt","ge","shield","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();var aa=b('MercuryThreadActions').get(),ba=b('MercuryThreads').get(),ca=null,da=null,ea=null,fa={g:{callback:la,description:x._("Rechercher (dans) des conversations"),section:'searchAndHelp',uses_meta:true},m:{callback:ka,description:x._("Commencer un nouveau message"),section:'navigation',uses_meta:true},i:{callback:ta.bind(null,m.INBOX),description:x._("Acc\u00e9der \u00e0 la bo\u00eete aux lettres"),section:'navigation',uses_meta:true},u:{callback:ta.bind(null,m.OTHER),description:x._("Acc\u00e9der \u00e0 Autres"),section:'navigation',uses_meta:true},z:{callback:na,description:x._("Archiver\/annuler l\u2019archive de la conversation"),otherKeys:['y'],section:'conversation',uses_meta:true},r:{callback:oa,description:x._("Identifier le message comme lu\/non lu"),section:'conversation',uses_meta:true},UP:{callback:pa,description:x._("S\u00e9lectionner la conversation suivante"),section:'navigation',uses_meta:false},DOWN:{callback:qa,description:x._("S\u00e9lectionner la conversation pr\u00e9c\u00e9dente"),section:'navigation',uses_meta:false},q:{callback:z(va),description:x._("Afficher\/masquer les raccourcis clavier"),section:'searchAndHelp',uses_meta:true}},ga={registerGeneralShortcuts:function(){da=new k();for(var wa in fa){var xa=fa[wa],ya=[wa];if(xa.otherKeys)ya=xa.otherKeys.concat(ya);for(var za=0;za<ya.length;za++)i.registerKey(ya[za],xa.callback,ja.bind(null,xa.uses_meta));}},updateThreadlistIndex:function(wa,xa,ya){ca=wa;if(da){if(!u(xa,ya))ya=null;da.updateIndex(xa,ya);}},openSearchThread:function(){var wa=sa(),xa=p.getCurrentMasterState();if(wa&&xa==o.MASTER.SEARCH)ca.openSearchThread(wa);},showOrHideShortcuts:va};function ha(){return r.osx()?'CTRL':'ALT';}function ia(wa){function xa(){if(!ea){var ya=h.find(document.body,"._ksg");ea=[];do{ya=ya.parentNode;ea.push(ya);}while(ya&&ya!==document.body);}return ea;}if(!n.byClass(wa,"_ksg"))if(!u(xa(),wa))if(!h.scry(wa,"._5hu2").length)return false;return true;}function ja(wa,event,xa){if(!i.filterEventTypes(event,xa))return false;if(!ia(event.getTarget()))return false;var ya;if(wa)switch(ha()){case 'CTRL':ya='ctrlKey';break;case 'ALT':ya='altKey';break;}var za=['ctrlKey','metaKey','altKey','shiftKey'];for(var ab=0;ab<za.length;ab++)if(za[ab]!==ya&&event[za[ab]])return false;return !wa||event[ya];}function ka(){t.bumpEntityKey('kbshorts_messenger','kbshorts.compose');p.updateDetailState(o.DETAIL.COMPOSE_MAIN,{start:true});return false;}function la(){t.bumpEntityKey('kbshorts_messenger','kbshorts.search');s.focusAndSelectSearch();return false;}function ma(wa){var xa;if(da.getNumItems()>1){var ya=da.getIndex();da.setIndex(ya===0?1:ya-1);xa=sa();}wa();p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{folder:p.getCurrentStateData().folder,thread_id:xa});if(xa)ca._manager.scrollIntoView(y(da.getItem()),false);}function na(){t.bumpEntityKey('kbshorts_messenger','kbshorts.toggle_archive');var wa=sa();if(wa){ba.getThreadMeta(wa,function(xa){if(xa.folder==m.SPAM)return;ma(function(){if(xa.is_archived){aa.unarchive(xa.thread_id);}else aa.archive(xa.thread_id);});},l.WEBMESSENGER);return false;}}function oa(){var wa=sa();t.bumpEntityKey('kbshorts_messenger','kbshorts.toggle_read_status');if(wa){ba.getThreadMeta(wa,function(xa){var ya=!xa.unread_count;ya?aa.markUnread(wa):aa.markRead(wa);},l.WEBMESSENGER);return false;}}function pa(){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_next');if(da)if(da.getIndex()===0){switch(p.getCurrentMasterState()){case o.MASTER.SEARCH:da.moveUp();ra();ca._manager.scrollToBottom(false);break;default:ca._manager.scrollToTop(false);s.focusSearch();}}else{if(da.getItem()){da.moveUp();}else da.moveDown();ra();}return false;}function qa(){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_previous');var wa=p.getCurrentMasterState();if(da&&(wa!==o.MASTER.RECENT_THREADS||da.getIndex()<da.getNumItems()-1)){da.moveDown();ra();}return false;}function ra(){var wa=sa();if(wa){var xa=p.getCurrentMasterState();if(xa==o.MASTER.SEARCH){ca.updateKeyboardSelection(wa);s.focusSearch();}else p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{thread_id:wa});if(da)if(da.getIndex()===0){ca._manager.scrollToTop(false);}else ca._manager.scrollIntoView(y(da.getItem()),false);}}function sa(){var wa=da&&da.getItem();if(typeof wa==='string'&&wa.indexOf(':')!==-1)return wa.substr(wa.indexOf(':')+1);return null;}function ta(wa){if(wa===m.INBOX){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_inbox');}else if(wa===m.OTHER)t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_other');var xa=p.getCurrentMasterState(),ya=xa==o.MASTER.SEARCH?null:p.getCurrentStateData().thread_id;p.updateMasterState(o.MASTER.RECENT_THREADS,{thread_id:ya,folder:wa});}var ua;function va(wa){t.bumpEntityKey('kbshorts_messenger','kbshorts.show_or_hide_shortcuts');if(!ua){var xa={};for(var ya in fa){var za=fa[ya];if(!za.uses_meta)continue;var ab=q[':fb:web-messenger:shortcuts-dialog:row'].build(),bb=[ya],cb=[];if(za.otherKeys)bb=za.otherKeys.concat(bb);for(var db=0;db<bb.length;db++){var eb=q[':fb:web-messenger:shortcuts-dialog:key'].build();eb.setNodeContent('meta',ha());eb.setNodeContent('key',bb[db]);cb.push(eb.getRoot());}ab.setNodeContent('keys',cb);ab.setNodeContent('description',za.description);if(!xa[za.section])xa[za.section]=[];xa[za.section].push(ab.getRoot());}var fb=q[':fb:web-messenger:shortcuts-dialog'].build();for(var gb in xa)fb.setNodeContent(gb,xa[gb]);var hb=h.scry(fb.getRoot(),"._1yw")[0],ib=null;if(hb)ib=h.getID(hb);ua=new g({modal:true,titleID:ib,width:565},fb.getRoot());ua.enableBehavior(j);}if(ua.isShown()){ua.hide();}else{ua.show();if(typeof wa==='function')ua.subscribeOnce('hide',wa);}return false;}e.exports=ga;},null);
__d("WebMessengerActionsMenuItem",["CSS","MenuItem","WebMessengerStateManager"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();for(var j in h)if(h.hasOwnProperty(j))l[j]=h[j];var k=h===null?null:h.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=h;function l(m){"use strict";m.href=m.href||'#';h.call(this,m);this.setOnClickHandler(this.handleMenuItemClick);this.showFn=this._data.should_show_fn;}l.prototype.handleMenuItemClick=function(){"use strict";var m=i.getCurrentStateData().thread_id;m&&this._data.onclick(m);};l.prototype.updateShownState=function(m){"use strict";if(this.showFn){this._isHidden=!this.showFn(m);if(this._root)g.conditionShow(this._root,!this._isHidden);}};l.prototype.isShown=function(m){"use strict";var n=this.showFn?this.showFn(m):true;return n;};l.prototype.render=function(){"use strict";var m=k.render.call(this);if(this._isHidden)g.hide(m);return m;};e.exports=l;},null);
__d("XMessagingLeaveConversationDialogController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/leave_conversation\/",{__asyncDialog:{type:"Int"}});},null);
__d("XNFXStartForMessageThreadController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/nfx\/start_message_thread\/",{thread_fbid:{type:"String",required:true},responsible_fbid:{type:"Int"},__asyncDialog:{type:"Int"}});},null);
__d("WebMessengerDetailViewActionsMenuControl",["WebMessengerAddPeopleToConversationDialog","AsyncDialog","AsyncRequest","BanzaiLogger","ChatOpenTab","ContextualDialogArrow","CSS","CurrentUser","WebMessengerDeleteThreadDialog","Dialog","DOM","WebMessengerEditThreadDialog","Event","FBRTCCore","FBRTCLogger","Input","Keys","Menu","MenuSeparator","MercuryAPIArgsSource","MercuryConfig","MercuryIDs","MercuryLogMessageType","MercurySourceType","MercuryThreadInfo","MercuryThreadMuter","MercuryViewer","MessagingTag","MercuryParticipants","Popover","PopoverMenu","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","Toggler","Tooltip","URI","WebMessengerActionsMenuItem","WebMessengerSubscriptionsHandler","XMessagingLeaveConversationDialogController","XUIMenuTheme","XNFXStartForMessageThreadController","copyProperties","emptyFunction","fbt","goURI","invariant","MercuryMessageObject","MercuryMessageActions","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb){b.__markCompiled&&b.__markCompiled();var cb=b('MercuryMessageObject').get(),db=b('MercuryMessageActions').get(),eb=b('MercuryServerRequests').get(),fb=b('MercuryThreadActions').get(),gb=b('MercuryThreadInformer').get(),hb=b('MercuryThreads').get();function ib(zc,ad){"use strict";this._rootElement=zc;this._headerControl=ad;this._menuTemplate=oa[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton');this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton');this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton');this._videoCallButton=this._menuTemplate.getNode('videoCallButton');var bd=this._menuTemplate.getNode('actionsButton'),cd=function(event){if(!this._searchMode){kb(this,true);}else{var dd=v.getValue(this._searchThreadInput);if(dd){var ed=xa({},na.getCurrentStateData());xa(ed,{message_query:dd});na.updateDetailState(ma.DETAIL.SEARCH_THREAD_SNIPPET,ed);this._searchThreadInput.focus();}else kb(this,false);}event.kill();}.bind(this);ta.addSubscriptions(gb.subscribe('threads-updated',function(dd,ed){ed[this._threadID]&&this.updateView();}.bind(this)),s.listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){na.updateDetailState(ma.DETAIL.COMPOSE_MAIN,xa(na.getCurrentStateData(),{start:true,thread_id:(void 0)}));}),s.listen(this._actionsMenu,'keydown',function(event){if(event.keyCode===w.ESC){bd.focus();event.preventDefault();}}),s.listen(this._searchThreadButton,'mousedown',cd),s.listen(this._searchThreadButton,'keydown',function(event){if(event.keyCode===w.RETURN||event.keyCode===w.SPACE)cd(event);}),s.listen(this._searchThreadButton,'click',ya.thatReturnsFalse),s.listen(this._searchCloseButton,'keydown',function(event){if(event.keyCode===w.RETURN||event.keyCode===w.SPACE){mb(this);this._menuTemplate.getNode('searchThreadButton').focus();}}.bind(this)),s.listen(this._searchCloseButton,'mousedown',function(event){mb(this);}.bind(this)),s.listen(this._searchThreadInput,'blur',function(event){var dd=v.getValue(this._searchThreadInput);if(!dd)kb(this,false);}.bind(this)),s.listen(this._searchThreadInput,'keyup',function(event){var dd=v.getValue(this._searchThreadInput),ed=xa({},na.getCurrentStateData());xa(ed,{message_query:dd});if(event.keyCode==w.RETURN&&dd)na.updateDetailState(ma.DETAIL.SEARCH_THREAD_SNIPPET,ed);if(event.keyCode==w.ESC)v.reset(this._searchThreadInput);}.bind(this)));if(this._videoCallButton){ta.addSubscriptions(s.listen(this._videoCallButton,'click',function(){lc(this._threadID);}.bind(this)));t.addListener('callabilityChanged',function(){yc(this._videoCallButton,this._threadID);}.bind(this));}this.initItems();q.setContent(this._rootElement,this._menuTemplate.getRoot());}ib.prototype.initItems=function(){"use strict";var zc=this._menuTemplate.getNode('actionsButton'),ad=this._menuTemplate.getNode('newMessageButton'),bd=function(){zc.focus();},cd=function(){ad.focus();};this.menuItems=[];this.menuItems.push({ctor:sa,label:za._("Inviter des personnes..."),onclick:gc,should_show_fn:ob},{ctor:sa,label:za._("Modifier les participants..."),onclick:hc,should_show_fn:ob},{ctor:sa,label:za._("Changer le nom de la conversation"),onclick:jc.bind(null,this),should_show_fn:ob},{ctor:sa,label:za._("Changer l\u2019image de la conversation"),onclick:jc.bind(null,this),should_show_fn:ob},{ctor:sa,label:za._("Quitter la conversation..."),onclick:ic,should_show_fn:ob},{ctor:y,should_show_fn:ob});this.menuItems.push({ctor:sa,label:za._("Ouvrir dans la discussion instantan\u00e9e"),onclick:pb,should_show_fn:k.canOpenTab},{ctor:sa,label:za._("Afficher les photos dans la discussion"),onclick:ec},{ctor:sa,label:za._("Marquer comme lu(s)"),onclick:sc.bind(null,bd),should_show_fn:ac},{ctor:sa,label:za._("Marquer comme non lu(s)"),onclick:rc.bind(null,bd),should_show_fn:xb(ac)});this.menuItems.push({ctor:y},{ctor:sa,label:za._("D\u00e9placer vers le compte professionnel"),onclick:vb,should_show_fn:ub},{ctor:sa,label:za._("Archiver"),onclick:mc.bind(null,cd),should_show_fn:xb(zb)},{ctor:sa,label:za._("Retirer de l\u2019archive"),onclick:nc.bind(null,cd),should_show_fn:zb},{ctor:sa,label:za._("Masquer la conversation..."),onclick:function(dd){fa.showMuteChangeDialog(dd,zc);},should_show_fn:xb(ea.isMuted)},{ctor:sa,label:za._("Reprendre la conversation"),onclick:lb.bind(null,bd),should_show_fn:ea.isMuted},{ctor:sa,label:za._("D\u00e9placer vers la bo\u00eete de r\u00e9ception"),onclick:rb.bind(null,cd,ha.INBOX),should_show_fn:qb.bind(null,ha.OTHER)},{ctor:sa,label:za._("Supprimer la conversation..."),onclick:wb},{ctor:sa,label:za._("Supprimer les messages..."),onclick:tc});this.menuItems.push({ctor:y},{ctor:sa,label:za._("Cr\u00e9er un groupe..."),onclick:pc,should_show_fn:sb},{ctor:sa,label:za._("Cr\u00e9er un \u00e9v\u00e8nement..."),onclick:qc,should_show_fn:tb},{ctor:sa,label:za._("Signaler du contenu ind\u00e9sirable ou un abus..."),onclick:cc.bind(null,bd),should_show_fn:xb(yb)},{ctor:sa,label:za._("Non ind\u00e9sirable"),onclick:fc.bind(null,cd),should_show_fn:yb},{ctor:sa,label:za._("Raccourcis clavier"),onclick:la.showOrHideShortcuts.bind(la,bd)},{ctor:sa,label:za._("Feedback"),onclick:ab.bind(null,'/help/?page=134259426717336')});if(nb())this.menuItems.push({ctor:y},{ctor:sa,label:'Enable bug reporting',onclick:uc.bind(null,bd),should_show_fn:xb(bc)},{ctor:sa,label:'Disable bug reporting',onclick:vc.bind(null,bd),should_show_fn:bc});this._menu=new x(this.menuItems,{theme:va});new ka(new ja(zc.parentNode,zc,[l],{alignh:'right'}),zc,this._menu);};ib.prototype.hideView=function(){"use strict";m.hide(this._rootElement);};ib.prototype.updateView=function(){"use strict";this.hideView();var zc=na.getCurrentDetailState(),ad=false,bd=false,cd=false,dd=false,ed=false,fd=false;switch(zc){case ma.DETAIL.COMPOSE_MAIN:case ma.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case ma.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:jb(this);this._threadID=null;break;case ma.DETAIL.RECENT_MESSAGES:case ma.DETAIL.SEARCH_CONTEXT:if(this._state!==zc)jb(this);var gd=na.getCurrentStateData().thread_id;ad=true;if(this._searchMode&&this._threadID===gd){dd=true;}else{jb(this);bd=true;cd=true;}this._threadID=gd;if(this._threadID)ed=true;break;case ma.DETAIL.SEARCH_THREAD_SNIPPET:var hd=na.getCurrentStateData();v.setValue(this._searchThreadInput,hd.message_query);this._threadID=hd.thread_id;ad=true;dd=true;fd=true;break;case ma.DETAIL.SHARED_PHOTOS:var id=na.getCurrentStateData();this._threadID=id.thread_id;ad=true;bd=true;cd=true;ed=true;break;default:jb(this);ad=true;bd=true;this._threadID=null;break;}this._state=zc;m.conditionShow(this._searchThreadInput,dd);m.conditionShow(this._searchThreadButton,ed);m.conditionShow(this._searchCloseButton,fd);m.conditionShow(this._newMessageButton,bd);m.conditionShow(this._rootElement,ad);if(this._videoCallButton){yc(this._videoCallButton,this._threadID);m.conditionShow(this._videoCallButton,xc(this._threadID)&&!this._searchMode&&t.shouldEnableVideoCalling());}this._threadSubscription&&hb.unsubscribe(this._threadSubscription);if(cd&&this._threadID){this._threadSubscription=hb.getThreadMeta(this._threadID,function(jd){this._menu.forEachItem(function(kd){return kd.updateShownState&&kd.updateShownState(jd);});m.show(this._menuTemplate.getNode('menu'));m.show(this._rootElement);}.bind(this),z.WEBMESSENGER);}else m.hide(this._menuTemplate.getNode('menu'));};ib.prototype.destroy=function(){"use strict";};function jb(zc){zc._searchMode=false;v.reset(zc._searchThreadInput);}function kb(zc,ad){if(ad){zc._searchMode=true;}else jb(zc);m.conditionShow(zc._newMessageButton,!ad);if(zc._videoCallButton)m.conditionShow(zc._videoCallButton,!ad&&xc(zc._threadID));m.conditionShow(zc._actionsMenu,!ad);m.conditionShow(zc._searchThreadInput,ad);if(ad){zc._searchThreadInput.focus();pa.hide(this._actionsMenu);}}function lb(zc,ad){fb.unmute(ad);pa.hide();zc();}function mb(zc){kb(zc,false);m.conditionShow(zc._searchThreadButton,true);m.conditionShow(zc._searchCloseButton,false);var ad=na.getCurrentDetailState();if(ad!==ma.DETAIL.RECENT_MESSAGES)na.updateDetailState(ma.DETAIL.RECENT_MESSAGES,{thread_id:na.getCurrentStateData().thread_id});}function nb(){var zc=ia.getNow(ga.getID());return zc&&zc.employee;}function ob(zc){return !zc.is_canonical&&zc.is_subscribed&&!zc.has_email_participant&&!zc.read_only;}function pb(zc){k.openThread(zc,'WebMessengerDetailViewActionsMenuControl');}function qb(zc,ad){return !ad.is_archived&&ad.folder==zc;}function rb(zc,ad,bd){fb.changeFolder(bd,ad);wc();zc();}function sb(zc){var ad=oc(zc.participants);return ad.length>2;}function tb(zc){var ad=oc(zc.participants);return ad.length>2;}function ub(zc){if(!n.isEmployee()||!n.hasWorkUser()||!ba.isMultichat(zc.thread_id))return false;var ad=zc.participants;for(var bd=0;bd<ad.length;++bd)if(!ia.getNow(ad[bd]).employee)return false;return true;}function vb(zc){if(!hb.isEmptyLocalThread(zc)){var ad=cb.constructLogMessageObject(da.MESSENGER_WEB,zc,ca.SWITCH_TO_WORK,{removed_participants:[ga.getID()]});db.send(ad,null,z.WEBMESSENGER);wc();}return true;}function wb(zc){na.updateDetailState(ma.DETAIL.RECENT_MESSAGES,na.getCurrentStateData());o.show(zc);}function xb(zc){return function(){return !zc.apply(this,arguments);};}function yb(zc){return zc.folder===ha.SPAM;}function zb(zc){return zc.is_archived;}function ac(zc){return zc.unread_count>0;}function bc(){return na.getCurrentStateData().bug_reporting_enabled;}function cc(zc,ad){if(!aa.MercuryNFXReportGK){var bd=hb.getThreadMetaNow(ad),cd;if(bd&&bd.message_count==1){cd=oa[':fb:web-messenger:report-dialog-single-message'].build();}else cd=oa[':fb:web-messenger:report-dialog'].build();var dd=cd.getRoot(),ed=[p.OK,p.CANCEL];new p().setTitle(za._("Signaler du contenu ind\u00e9sirable ou un abus")).setBody(dd).setButtons(ed).setHandler(dc.bind(null,ad,dd)).setCancelHandler(zc).show();}else eb.getThreadFBID(ad,function(fd){var gd=wa.getURIBuilder().setString('thread_fbid',fd).getURI();h.send(new i(gd));});}function dc(zc,ad){var bd=q.find(ad,'.markSpam'),cd=q.scry(ad,'.markSpamMessages')[0];if(bd.checked){fb.markSpam(zc);wc();}else if(cd&&cd.checked){var dd=xa({},na.getCurrentStateData());xa(dd,{message_action:ma.MESSAGE_ACTION.REPORT_SPAM});na.updateDetailState(na.getCurrentDetailState(),dd);}else{var ed=q.find(ad,'.reportUsers');if(ed.checked){eb.getServerThreadID(zc,function(fd){p.bootstrap('/ajax/messaging/report/',{tid:fd});});}else return false;}}function ec(zc){var ad=xa({},na.getCurrentStateData());na.updateDetailState(ma.DETAIL.SHARED_PHOTOS,ad);}function fc(zc,ad){fb.unmarkSpam(ad);wc();zc();}function gc(zc){g.show(zc);}function hc(zc){eb.getServerThreadID(zc,function(ad){h.send(new i(ra('/ajax/browser/dialog/multichat_members/').addQueryData({id:ad})));});}function ic(zc){var ad=ua.getURIBuilder().getURI();h.send(new i(ad),function(bd){bd.subscribe('confirm',function(){kc(zc);bd.hide();});});}function jc(zc,ad){var bd=new r();bd.toggleShown(zc._headerControl?zc._headerControl._headerBar.getNode('headerName'):zc._rootElement,ad);}function kc(zc){db.send(cb.constructLogMessageObject(da.TITAN_WEB,zc,ca.UNSUBSCRIBE,{removed_participants:[ga.getID()]}),null,z.WEBMESSENGER);return true;}function lc(zc){j.log('VideoCallLoggerConfig',{event:'web_messenger_call_click'});var ad=ba.getUserIDFromThreadID(zc);bb(ad);t.startOutgoingCall(ad,u.Trigger.WEB_MESSENGER,false);}function mc(zc,ad){fb.archive(ad);wc();zc();}function nc(zc,ad){fb.unarchive(ad);wc();zc();}function oc(zc){var ad=[];for(var bd=0;bd<zc.length;bd++){var cd=zc[bd];if(/^fbid:\d+$/.test(cd))ad.push(cd.substr(5));}return ad;}function pc(zc){hb.getThreadMeta(zc,function(ad){var bd=oc(ad.participants),cd=ra('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:bd,parent_id:'0'});h.send(new i(cd));},z.WEBMESSENGER);}function qc(zc){hb.getThreadMeta(zc,function(ad){var bd=oc(ad.participants),cd=ra('/ajax/plans/create/dialog.php').addQueryData({invite_ids:bd,eventname:ad.name,group_chat:true});h.send(new i(cd));},z.WEBMESSENGER);}function rc(zc,ad){fb.markUnread(ad);pa.hide();zc();}function sc(zc,ad){fb.markRead(ad);pa.hide();zc();}function tc(){var zc=xa({},na.getCurrentStateData());xa(zc,{message_action:ma.MESSAGE_ACTION.DELETE});na.updateDetailState(na.getCurrentDetailState(),zc);}function uc(zc){var ad=xa({},na.getCurrentStateData());ad.bug_reporting_enabled=true;pa.hide();na.updateDetailState(na.getCurrentDetailState(),ad);zc();}function vc(zc){var ad=xa({},na.getCurrentStateData());ad.bug_reporting_enabled=false;pa.hide();na.updateDetailState(na.getCurrentDetailState(),ad);zc();}function wc(){na.updateDetailState(ma.DETAIL.RECENT_MESSAGES,{folder:na.getCurrentStateData().folder});}function xc(zc){if(zc){var ad=ba.getUserIDFromThreadID(zc);if(ad&&ad!==n.getID())return true;}return false;}function yc(zc,ad){if(!ad||!xc(ad))return;var bd=ba.getUserIDFromThreadID(ad);bb(bd);var cd=t.callabilityForUser(bd),dd=ba.getParticipantIDFromUserID(bd);if(cd!=t.CallabilityStatus.AVAILABLE){zc.disabled=true;}else zc.disabled=false;ia.get(dd,function(ed){qa.set(zc,t.generateCallButtonTooltip(ed.short_name,cd));}.bind(this));}e.exports=ib;},null);
__d("ExpandableDataSource",["DataSource"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";this._initialLimit=l;this._moreResultsLimit=m;this._states={};k=k||{};k.maxResults=this._initialLimit;g.call(this,k);}j.prototype.query=function(k,l,m){"use strict";this.setQueryData({offset:0,limit:this._initialLimit});i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){"use strict";var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){"use strict";if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){"use strict";return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){"use strict";var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){"use strict";return this._states;};j.prototype.getState=function(k){"use strict";var l=this.getStates();if(!l[k])l[k]={};return l[k];};j.prototype.getQueryCache=function(){"use strict";return this.getState('query_cache');};e.exports=j;},null);
__d("WebMessengerDetailViewAllPeopleResultsControl",["Event","CSS","DataStore","DOM","ExpandableDataSource","MercuryIDs","Parent","WebMessengerStateConstants","WebMessengerStateManager","Token","WebMessengerEvents","cx","WebMessengerSubscriptionsHandler","copyProperties","WebMessengerTemplates"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=5,w=5;function x(ca){"use strict";this._rootElement=ca;j.empty(this._rootElement);var da=u[':fb:web-messenger:all-people-results'].build();j.setContent(this._rootElement,da.getRoot());this._loadingSpinner=da.getNode('loadingSpinner');this._peopleResults=da.getNode('results');this._loadMoreButton=da.getNode('loadMoreButton');this._loadMoreLink=da.getNode('loadMoreLink');s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));}x.prototype.hideView=function(){"use strict";h.hide(this._rootElement);};x.prototype.updateView=function(){"use strict";var ca=o.getCurrentDetailState();if(ca==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){h.show(this._rootElement);y(this);q.detailDOMChanged();}};x.prototype.destroy=function(){"use strict";};function y(ca){h.show(ca._loadingSpinner);h.hide(ca._peopleResults);h.hide(ca._loadMoreButton);var da=o.getCurrentStateData(),ea=da.all_people_query||'';z(ca);var fa=(da.participants||[]).map(function(ga){return l.tokenize(ga).value;});ca._peopleDataSource.setExclusions(fa);ca._peopleDataSource.query(ea);}function z(ca){if(!ca._peopleDataSource){ca._peopleDataSource=new k({queryEndpoint:'/ajax/mercury/search_people.php'},v,w);ca._peopleDataSource.init();s.addSubscriptions(ca._peopleDataSource.subscribe('respond',aa.bind(null,ca)),g.listen(ca._rootElement,'click',function(event){var da=event.getTarget().parentNode;if(h.hasClass(da,"_4wt"))ba(event.getTarget(),ca._peopleDataSource);}));}}function aa(ca,da,ea){var fa=o.getCurrentDetailState(),ga=o.getCurrentStateData();if(fa==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&ga.all_people_query==ea.value){j.empty(ca._peopleResults);h.show(ca._peopleResults);ea.results.forEach(function(ha){var ia=j.create('div',{className:'personResult'},ha.detail_markup);i.set(ia,'uid',ha.uid);j.appendContent(ca._peopleResults,ia);});if(ea.results.length){h.hide(ca._loadingSpinner);h.conditionShow(ca._loadMoreButton,!ca._peopleDataSource.hasLoadedAllResults());h.conditionClass(ca._loadMoreButton,'async_saving',ca._peopleDataSource.isLoadingMore());}}}function ba(ca,da){var ea=m.byClass(ca,'personResult'),fa=da.getEntry(i.get(ea,'uid')),ga=t(o.getCurrentStateData(),{new_tokens:[new p(fa)],start:false});o.updateDetailState(n.DETAIL.COMPOSE_MAIN,ga);}e.exports=x;},null);
__d("WebMessengerComposerTypeaheadView",["BucketedTypeaheadView","CSS","DataStore","MercuryTypeaheadConstants","WebMessengerStateConstants","WebMessengerStateManager","copyProperties","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();for(var p in g)if(g.hasOwnProperty(p))r[p]=g[p];var q=g===null?null:g.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=g;function r(v,w){"use strict";g.call(this,v,w);this.typeObjects={};this.typeObjects[j.FRIEND_TYPE]={disabled:true,uid:j.FRIEND_TYPE,type:j.HEADER_TYPE};this.typeObjects[j.THREAD_TYPE]={uid:j.THREAD_TYPE,text:o._("Conversations de groupe"),type:j.HEADER_TYPE,linkText:o._("Afficher plus"),getLinkHandler:u.bind(null,this)};this.typeObjects[j.PAGE_TYPE]={uid:j.PAGE_TYPE,text:o._("Pages"),type:j.HEADER_TYPE};this.typeObjects[j.FB4C_TYPE]={uid:j.THREAD_TYPE,text:o._("Coll\u00e8gues"),type:j.HEADER_TYPE};this.typeObjects[j.NON_FRIEND_TYPE]={uid:j.NON_FRIEND_TYPE,text:o._("Autres personnes"),type:j.HEADER_TYPE,linkText:o._("Afficher tout"),getLinkHandler:function(){return function(){t(this.value);}.bind(this);}.bind(this)};}r.prototype.setTypeahead=function(v){"use strict";q.setTypeahead.call(this,v);var w=i.get(v,'Typeahead');w.subscribe('loading',function(x,y){var z=w.getData();if(this._threadHeader)h.conditionClass(this._threadHeader,"_355",z.isLoadingMore(this.value));}.bind(this));};r.prototype.setNewHeader=function(v,w){"use strict";if(w.uid===j.THREAD_TYPE)this._threadHeader=v;};r.prototype.mouseover=function(event){"use strict";if(!s(this,event))q.mouseover.call(this,event);};r.prototype.mouseup=function(event){"use strict";if(!s(this,event))q.mouseup.call(this,event);};r.prototype.clearSelected=function(){"use strict";this.index=-1;this.highlight(-1);};function s(v,event){var w=v.getIndex(event);return w>=0&&w<v.results.length&&v.results[w].type==j.HEADER_TYPE;}function t(v){var w=m(l.getCurrentStateData(),{all_people_query:v,start:false});l.updateDetailState(k.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,w);}function u(v){var w=i.get(v.typeahead,'Typeahead'),x=w.getData();if(x.hasLoadedInitialResults(v.value)&&!x.hasLoadedAllResults(v.value))return x.loadMore.bind(x);}e.exports=r;},null);
__d("MercuryDataSourceHelper",["MercuryPayloadSource","MercuryTypeaheadConstants","MercuryThreadMetadataRawRenderer","MercuryServerRequests","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryServerRequests').get(),k=b('MercuryThreadMetadataRenderer').get(),l={updateMercuryOnFetchComplete:function(m){m.subscribe('fetchComplete',function(n,o){var p={participants:[],threads:[],pages:[],payload_source:g.SERVER_SEARCH};o.response.getPayload().entries.forEach(function(q){if(q.type==h.THREAD_TYPE){p.threads=p.threads.concat(q.mercury_thread);p.participants=p.participants.concat(q.participants_to_render);}else if(q.type==h.PAGE_TYPE)p.pages=p.pages.concat(q);});if(p.threads.length){j.handleUpdate(p);o.response.getPayload().entries.forEach(function(q){if(q.mercury_thread)q.text=k.renderThreadNameAndParticipantList(q.mercury_thread.thread_id,q.participants_to_render,q.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:i.renderShortNames});});}});}};e.exports=l;},null);
__d("WebMessengerTypeaheadRenderer",["CurrentUser","DOM","ImmutableObject","MercuryAPIArgsSource","MercuryThreadImage.react","MercuryTypeaheadConstants","MercuryTypeaheadRenderer","React","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryServerRequests","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=b('MercuryServerRequests').get(),r=b('MercuryThreadMetadataRenderer').get(),s=b('MercuryThreads').get(),t=50;function u(w,x){var y;switch(w.type){case l.HEADER_TYPE:y=o[':fb:web-messenger:typeahead-header'].build();m.renderHeader(y,w);if(this.setNewHeader)this.setNewHeader(y.getRoot(),w);break;case l.USER_TYPE:case l.PAGE_TYPE:y=o[':fb:web-messenger:threadlist-row'].build();m.renderPersonWithBigPhoto(y,w);break;case l.THREAD_TYPE:y=o[':fb:web-messenger:threadlist-row'].build();v(y,w);break;default:return h.create('div');}return y.getRoot();}function v(w,x){var y=q.getClientThreadIDNow(x.uid),z=n.createElement(k,{size:t,thread:new i(x.mercury_thread),viewer:g.getID()});n.render(z,w.getNode('image'));var aa=r.renderThreadNameAndParticipantList(y,x.participants_to_render,x.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:p.renderShortNames});h.setContent(w.getNode('name'),aa);w.getRoot().setAttribute('aria-label',aa);s.getThreadMeta(y,function(ba){r.renderSnippet(ba,w.getNode('snippet'));r.renderTimestamp(w.getNode('timestamp'),ba.timestamp_absolute,ba.timestamp_relative,ba.timestamp);},j.WEBMESSENGER);}e.exports=u;},null);
__d("WebMessengerDetailViewComposeTypeaheadControl",["Event","WebMessengerComposerTypeaheadView","CSS","WebMessengerDataSources","DOM","MercuryFolders","Keys","MercuryDataSourceHelper","MercuryIDs","MercuryTypeahead","MercuryTypeaheadConstants","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTypeaheadRenderer","copyProperties","fbt","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=b('MercuryThreads').get();function aa(ea,fa){"use strict";this._typeaheadRoot=ea;this._resultsRoot=fa;k.empty(this._typeaheadRoot);k.empty(this._resultsRoot);}aa.prototype.hideView=function(){"use strict";i.hide(this._typeaheadRoot);i.hide(this._resultsRoot);};aa.prototype.updateView=function(){"use strict";var ea=r;switch(s.getCurrentDetailState()){case ea.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();i.hide(this._resultsRoot);break;case ea.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();i.show(this._resultsRoot);break;}u.detailDOMChanged();};aa.prototype.renderComposeTypeahead=function(){"use strict";var ea=s.getCurrentStateData();i.show(this._typeaheadRoot);i.show(this._resultsRoot);if(!this._initiated){var fa=t[':fb:web-messenger:read-view:compose:typeahead'].build();k.setContent(this._typeaheadRoot,fa.getRoot());var ga=t[':fb:web-messenger:read-view:compose:typeahead:results'].build();k.setContent(this._resultsRoot,ga.getRoot());this._initialResultsLoadingSpinner=ga.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=ga.getNode('typeaheadFooter');this._moreResultsLink=ga.getNode('moreResultsLink');this._typeaheadCaption=ga.getNode('caption');this.buildTypeahead(ga.getNode('results'));k.appendContent(fa.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(ea.start){if(!ea.participants)this._typeahead.reset();this._typeahead.focus();var ha=this._typeahead.getTypeahead().getCore();ha.getElement().removeAttribute('disabled');}ca(this);if(ea.start)s.updateDetailState(s.getCurrentDetailState(),x({},s.getCurrentStateData(),{start:false,new_tokens:(void 0)}));};aa.prototype.buildTypeahead=function(ea){"use strict";if(this._typeahead)return;var fa=j.WebMessengerComposerDataSource;n.updateMercuryOnFetchComplete(fa);var ga=new p(fa,h);ga.setPlaceholder(y._("Nom"));ga.setViewNodeID(ea);ga.setViewOption('renderer',w);v.addSubscriptions(ga.subscribe('tokens-changed',this.onTokensChanged.bind(this)));ga.build();v.addSubscriptions(ga.getTypeahead().subscribe(['respond','focus'],function(){ba(!!ga.getTypeahead().getCore().getValue());}),ga.getTypeahead().subscribe(['reset','blur'],function(){ba(false);}),ga.getTypeahead().subscribe('render',function(ha,ia){da(this,ia.length);}.bind(this)),ga.getTypeahead().subscribe('reset',function(){da(this,false);}.bind(this)),ga.getTypeahead().subscribe('query',function(ha,ia){k.setContent(this._moreResultsLink,y._("Voir plus de r\u00e9sultats pour {query}",[y.param("query",ia.value)]));}.bind(this)),g.listen(ga.getElement(),'keydown',function(ha){if(ha.keyCode===m.TAB&&!ha.getModifiers().any){u.focusComposer();return false;}}),g.listen(this._typeaheadFooter,'mousedown',function(){return false;}),g.listen(this._moreResultsLink,'click',function(){var ha=this._typeahead.getTypeahead().getCore().getValue(),ia=x(s.getCurrentStateData(),{all_people_query:ha,start:false});s.updateDetailState(r.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,ia);}.bind(this)),g.listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=ga;};aa.prototype.onTokensChanged=function(){"use strict";var ea=s.getCurrentDetailState();if(ea==r.DETAIL.COMPOSE_MAIN||ea==r.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||ea==r.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var fa=this._typeahead,ga=fa.getTokens(),ha=ga[ga.length-1];if(ha&&ha.getInfo().mercury_thread){var ia=ha.getInfo().mercury_thread.thread_id,ja=l.getFromMeta(z.getThreadMetaNow(ia));s.updateDetailState(r.DETAIL.RECENT_MESSAGES,{thread_id:ia,folder:ja,reuse_composer:true});}else{var ka=ga.map(function(ma){if(ma.getInfo().type===q.PAGE_TYPE){var na=fa.getTypeahead().getCore();na.getElement().setAttribute('disabled','disabled');}return o.getParticipantIDFromUserID(ma.getValue());}),la=s.getCurrentStateData();if(!la.start||(ka||[]).length)s.updateDetailState(r.DETAIL.COMPOSE_MAIN,x({},la,{participants:ka}));}}};aa.prototype.destroy=function(){"use strict";};function ba(ea){var fa=s.getCurrentDetailState(),ga=r;if(fa!=ga.DETAIL.COMPOSE_MAIN&&fa!=ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var ha;if(ea){ha=ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(fa==ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){ha=ga.DETAIL.COMPOSE_MAIN;}else ha=fa;if(ha!=fa){var ia=x(s.getCurrentStateData(),{start:false,new_tokens:(void 0)});s.updateDetailState(ha,ia);}}function ca(ea){var fa=s.getCurrentStateData();if(fa.new_tokens){var ga=ea._typeahead.getTypeahead().getCore();ga.reset();fa.new_tokens.forEach(function(ha){ea._typeahead.getTokenizer().addToken(ha);});}}function da(ea,fa){var ga=ea._typeahead.getTypeahead(),ha=ga.getCore().getValue(),ia=ga.getData().hasLoadedInitialResults(ha);i.conditionShow(ea._initialResultsLoadingSpinner,!ia);i.conditionShow(ea._moreResultsLink,ia&&fa);if(!fa&&ia){k.setContent(ea._typeaheadCaption,y._("La recherche n\u2019a donn\u00e9 aucun r\u00e9sultat."));}else k.setContent(ea._typeaheadCaption,y._("Affichage des principaux r\u00e9sultats"));}e.exports=aa;},null);
__d("WebMessengerUnseenMessageNoticeRenderer",["JSXDOM","ContextualLayer","LayerFadeOnHide","cx","fbt","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m={renderNoticeTooltip:function(o,p){var q=g.div({className:"_40p"},n(o),g.i({className:"_40q"})),r=new h(p||{},q).enableBehavior(i);return r;}};function n(o){var p=g.div({className:"_40r"},k._("Vous avez de nouveaux messages"));l.listen(p,'click',o);return p;}e.exports=m;},null);
__d("WebMessengerMessagesNotice",["LayerDestroyOnHide","MercuryViewer","WebMessengerUnseenMessageNoticeRenderer"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(){"use strict";this._notice=null;this._noticeContextNode=null;this._active=false;}j.prototype.getActive=function(){"use strict";return this._active;};j.prototype.showMessageNotice=function(k,l){"use strict";if(!this._active)return;if(!this._notice)this._notice=i.renderNoticeTooltip(k,{context:this._noticeContextNode,offsetY:2,position:l,alignment:'center'});this._notice.show();};j.prototype.hideMessageNotice=function(){"use strict";this._notice&&this._notice.hide();};j.prototype.removeMessageNotice=function(){"use strict";if(this._notice){this._notice.enableBehavior(g).hide();this._notice=null;}};j.prototype.setNoticeContextNode=function(k){"use strict";this._noticeContextNode=k;};j.prototype.hideView=function(){"use strict";this._active=false;this.hideMessageNotice();};j.prototype.updateView=function(){"use strict";this._active=true;};j.prototype.destroy=function(){"use strict";this._active=false;this.removeMessageNotice();};j.prototype.onlyReceivedFromSelf=function(k){"use strict";for(var l in k){if(!k.hasOwnProperty(l))continue;for(var m=0,n=k[l].length;m<n;m++)if(k[l][m].author!==h.getID())return false;}return true;};e.exports=j;},null);
__d("WebMessengerDetailViewUnreadMessagesNotice",["MercuryThreadlistConstants","WebMessengerStateManager","throttle","UserActivity","WebMessengerMessagesNotice","WebMessengerSubscriptionsHandler","MercuryThreadInformer","MercuryThreadActions"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryThreadInformer').get(),n=b('MercuryThreadActions').get(),o=g.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var p in k)if(k.hasOwnProperty(p))r[p]=k[p];var q=k===null?null:k.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=k;function r(s){"use strict";k.call(this);this._manager=s;l.addSubscriptions(m.subscribe('thread-read-changed',this._updateReadStatus.bind(this)));this._manager.addScrollCallback(i.withBlocking(function(t){if(this._shouldMarkAsRead(t)){this.removeMessageNotice();if(j.isActive(5000)){var u=h.getCurrentStateData().thread_id;n.markRead(u);}else j.subscribeOnce(function(){if(this._shouldMarkAsRead(t)){var v=h.getCurrentStateData().thread_id;n.markRead(v);}}.bind(this));}}.bind(this),100,null));}r.prototype.updateOnMessagesReceived=function(s,t,u,v){"use strict";var w=!j.isActive(o);if(!q.getActive.call(this))return;if(w||q.onlyReceivedFromSelf.call(this,v)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var x=u-(t-s);this._manager.setScrollTop(x,false);this.showMessageNotice();}};r.prototype.showMessageNotice=function(){"use strict";var s=function(){this._manager.scrollToBottom();}.bind(this);q.showMessageNotice.call(this,s,'above');};r.prototype._shouldMarkAsRead=function(s){"use strict";var t=h.getCurrentStateData().thread_id;return t&&q.getActive.call(this)&&s.isScrolledToBottom();};r.prototype._updateReadStatus=function(s,t){"use strict";var u=h.getCurrentStateData().thread_id;if(u&&t[u]&&t[u].mark_as_read)this.removeMessageNotice();};e.exports=r;},null);
__d("MercuryListUpdateRenderer",["DOM","ge"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={updateList:function(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=h(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}g.setContent(j,o);}};e.exports=i;},null);
__d("MercuryMessageGroup",["MercuryActionType","MercuryAttachment","MercuryShareAttachmentRenderLocations","MercuryThreadlistConstants","toIterator"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l={calculateMessageGroups:function(o,p){var q=[],r=null,s={value:null},t=k(o),u;while(!(u=t.next()).done){var v=l.canAppendMessageToLastGroup(s.value,u.value,p);if(!v){r=[];q.push(r);}r.push(u.value);s=u;}return q;},canAppendMessageToLastGroup:function(o,p,q){var r=j.GROUPING_THRESHOLD;if(!o||m(o,q)||m(p,q)||o.author!=p.author||o.timestamp<p.timestamp-r||o.is_spoof_warning!==p.is_spoof_warning)return false;return true;}};function m(o,p){var q=o.has_attachment;if(p===i.MESSENGER)q=n(o);return !!(o.action_type==g.LOG_MESSAGE||q||o.forward_count||o.html_body||(o.body&&o.body.length>j.MAX_CHARS_BEFORE_BREAK));}function n(o){var p=o.attachments;if(p&&p.length===1){var q=p[0];return (!q.metadata||!h.isVoiceMessage(q.metadata.type));}return !!o.has_attachment;}e.exports=l;},null);
__d("WebMessengerMessageIDFinder",["DataStore","DOM","csx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={find:function(k,l){var m=l?h.find(k,l):k,n=g.get(m,'MessageRenderer:messageID');return n;},findAll:function(k){var l=h.scry(k,"._53"),m=[];if(l.length){var n=l[0];for(var o=0;o<n.childNodes.length;o++)m.push(g.get(n.childNodes[o],'MessageRenderer:messageID'));}return m;}};e.exports=j;},null);
__d("WebMessengerMessagesSelection",["CSS","csx","DOM","getObjectValues","WebMessengerMessageIDFinder"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={};function m(p,q){var r=p,s=q;if(r==s)return 0;while(true){r=r.nextSibling;s=s.nextSibling;if(!r||s==p){return 1;}else if(!s||r==q)return -1;}}function n(p,q){var r=p.id,s=i.scry(p,"._yh input")[0];if(q){l[r]=p;g.addClass(p,'selected');s.checked=true;}else{delete l[r];g.removeClass(p,'selected');s.checked=false;}}var o={clear:function(){for(var p in l)n(l[p],false);},selectClick:function(p){n(p,!(p.id in l));},getSelectedMessageIDs:function(){var p=j(l);p.sort(m);var q=[];p.forEach(function(r){q=q.concat(k.findAll(r));});return q;}};e.exports=o;},null);
__d("MessagingConst",["copyProperties"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={APP_ID:313785040330,XD_MESSAGE:{SANDBOX_READY:'sandbox_ready',SET_CONTENT:'set_content',HTML_SIZE:'html_size',REFRESH_SIZE:'refresh_size'},SHINGLE_SCROLL_TRIGGER:5,EVENTS:{MESSAGE_SENT:'messaging/message_sent'},initConstants:function(i){g(h,i);}};e.exports=h;},null);
__d("MessagingXD",["Event","DOM","MercuryConstants","MessagingConst","URI","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n){this._listeners=[g.listen(window,'message',this._onPostMessage.bind(this))];this._iframes={};this._contentWindows={};this._messageHandler=n;}l(m.prototype,{unload:function(){this._listeners.forEach(function(n){n.remove();});},createIframe:function(n,o,p){var q=new k(p);this._iframes[o]=h.create('iframe',{name:o,frameBorder:0,src:q.toString()});h.appendContent(n,this._iframes[o]);this._contentWindows[o]=this._iframes[o].contentWindow;return this._iframes[o];},sendMessage:function(n,o){var p=Array.prototype.slice.apply(arguments);p[0]=j.APP_ID;var q=this._iframes[n].contentWindow||this._contentWindows[n];q.postMessage(p.join(','),i.Sandbox.ORIGIN);},_onPostMessage:function(event){if(event.origin!==i.Sandbox.ORIGIN||!event.data.split)return;var n=event.data.split(','),o=unescape(n[1]);this._contentWindows[o]=event.source;this._messageHandler(o,n);}});e.exports=m;},null);
__d("HTMLEmailRenderer",["CSS","MessagingConst","MessagingXD","copyProperties","emptyFunction","fbt","MercuryConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(o,p){this._resizeContent=o.resizeContent||k;this._richMap={};this._useFBStyle=p;this._xdc=new i(this.onXDMessage.bind(this));this._maxWidth=0;}j(n.prototype,{onXDMessage:function(o,p){if(p[0]!=h.APP_ID.toString())return;if(this._richMap&&this._richMap[o])if(p[2]==h.XD_MESSAGE.SANDBOX_READY){return this.setIframeContent(o);}else if(p[2]==h.XD_MESSAGE.HTML_SIZE)return this._resizeContent(o,parseInt(p[3],10),parseInt(p[4],10),p[5]=='true',p[6]=='true');},setIframeContent:function(o,p){this._xdc.sendMessage(o,h.XD_MESSAGE.SET_CONTENT,escape(this._richMap[o]),this._useFBStyle?'useFBStyle':'',p?'forceDialogOnWide':'',escape(l._("Afficher le texte masqu\u00e9")),escape(l._("Masquer")),this._maxWidth);},makeRich:function(o,p,q,r){var s=this._xdc.createIframe(p,o,m.Sandbox.PAGE_URL);g.addClass(s,'xdIframe');this._richMap[o]=q;this._maxWidth=r||0;},updateRichMap:function(o,p){this._richMap[o]=p;},unload:function(){this._xdc.unload();}});e.exports=n;},null);
__d("DOMHyperlink",["Env","JSXDOM","TransformTextToDOMMixin","UntrustedLink","URI","URLScraper","isFacebookURI","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p={MAX_ITEMS:40,match:function(q,r){var s=l.match(q);if(!s)return false;var t=q.indexOf(s),u=t+s.length;return {startIndex:t,endIndex:u,element:this._element(s,r)};},_element:function(q,r){var s=q,t=s.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(q)))t='http://'+t;if(!k.isValidURI(t))return s;var u=h.a({className:"_553k",href:t,target:"_blank",rel:"nofollow"},s);if(r&&!m(k(t)))u.onmousedown=function(v){j.bootstrap(this,g.lhsh,v);};return u;}};e.exports=n(p,i);},null);
__d("MercuryMessageRenderer",["DOM","DOMEmoji","DOMEmote","DOMHyperlink","isFacebookURI","JSXDOM","URI","transformTextToDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o={formatMessageBody:function(s,t,u){var v=(s||'').replace(/\s+$/,'');if(!t)return r(v,false,u);var w=Object.keys(t).map(function(z){return window.parseInt(z);}).sort(function(z,aa){return z-aa;}),x=[],y=0;w.forEach(function(z){var aa=v.slice(y,z);if(aa)x.push(r(aa,false,u));y=z+t[z].length;var ba=v.slice(z,y);if(ba)x.push(r(ba,true,u));});if(y<v.length)x.push(r(v.slice(y),false,u));return x.length===0?null:x.length===1?x[0]:g.create('span',{},x);}};function p(s,t){var u=t(s);if(Array.isArray(u))u.forEach(function(v){if(v.href){var w=new m(v.href);if(k(w))v.href=w.addQueryData({__mref:'message'}).toString();}});return u;}function q(s,t){var u=s.replace(/\r\n?/g,'\n').split(/\n{2,}/);return u.filter(function(v){return v.length;}).map(function(v){return l.p(null,p(v,t));});}function r(s,t,u){if(s.length===0&&!t)return null;var v=function(w){return n(w,[j.params(true),h,i]);};return (l.span({className:t?'highlight':null},u?q(s,v):p(s,v)));}e.exports=o;},null);
__d("WebMessengerThreadMessagesRenderer",["AsyncRequest","MercuryAttachment","MercuryAttachmentRenderer","CSS","DataStore","DOM","Event","HovercardLink","HTMLEmailRenderer","Image.react","ImmutableObject","LinkController","MercuryLogMessageRenderer","MercuryActionType","MercuryAttachmentType","MercuryErrorInfo","MercuryIDs","MercuryMessageError.react","MercuryMessageGroup","MercuryTimePassed","MercuryViewer","MercuryMessageRenderer","WebMessengerMessagesSelection","Parent","MercuryParticipants","MercuryParticipantsConstants","React","WebMessengerStateManager","MercuryStatusTemplates","Style","WebMessengerTemplates","Vector","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","csx","cx","formatDate","ge","isRTL","fbt","MercuryMessages","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua){b.__markCompiled&&b.__markCompiled();'use strict';var va=b('MercuryMessages').get(),wa=b('MercuryThreadMetadataRenderer').get(),xa={updateSelection:function(za){var ab=ha.getCurrentStateData().message_action;j.conditionClass(za,'selectionEnabled',ab);},setupSelectionListener:function(za){r.registerHandler(function(ab){var bb=ha.getCurrentStateData().message_action;if(bb&&da.byClass(ab,'webMessengerMessageGroup'))return false;});oa.addSubscriptions(m.listen(za,'click',function(event){var ab=ha.getCurrentStateData().message_action;if(ab){var bb=null;for(var cb=event.getTarget();cb;cb=cb.parentNode)if(j.hasClass(cb,'webMessengerMessageGroup'))bb=cb;bb&&ca.selectClick(bb);}}));},renderForwardedMessages:function(za,ab){var bb=y.calculateMessageGroups(ab),cb=null;bb.forEach(function(db){var eb=xa.renderMessageGroup(db,true);l.appendContent(za,eb.getRoot());cb=db[db.length-1];});},renderMessageGroup:function(za,ab,bb){var cb=za[0],db=cb.action_type==t.LOG_MESSAGE,eb=db?ka[':fb:web-messenger:read-view:log-message'].build():ka[':fb:web-messenger:read-view:message-group'].build();eb.getRoot().setAttribute('id',(bb||'wm:')+cb.message_id);if(db){xa.renderSingleLogMessage(eb,cb);}else ea.get(cb.author,function(fb){xa.renderSingleMessage(eb,cb,fb,ab);for(var gb=1;gb<za.length;gb++)xa.appendMessageToGroup(eb,za[gb]);});return eb;},appendMessageToGroup:function(za,ab){var bb=ka[':fb:web-messenger:read-view:message'].build();if(ab.is_filtered_content){var cb=ia[':fb:mercury:filtered-message'].build();bb.setNodeContent('message',cb.getRoot());}else bb.setNodeContent('message',ba.formatMessageBody(ab.body,null,true));ga.render(ga.createElement(x,{message:new q(ab)}),bb.getNode('status'));var db=bb.getRoot();k.set(db,'MessageRenderer:messageID',ab.message_id);j.addClass(bb.getNode('message'),ta(ab.body)?'direction_rtl':'direction_ltr');l.appendContent(za.getNode('bodyDiv'),db);ea.get(aa.getID(),function(eb){if(eb.employee){var fb=ka[':fb:web-messenger:bug-reporting'].build();fb.getNode('fbtrace').setAttribute('data-timestamp',ab.timestamp);fb.getNode('brokenheart').setAttribute('data-timestamp',ab.timestamp);l.setContent(bb.getNode('bugReporting'),fb.getRoot());}});},renderSingleLogMessage:function(za,ab){var bb=za.getNode('attachment');s.renderLegacy(za.getNode('icon'),za.getNode('message'),bb,ab);xa.renderStatus(za,ab);if(ab.log_message_data.image)j.addClass(bb.firstChild,"_1_vi");wa.renderTimestamp(za.getNode('timestamp'),ab.timestamp_absolute,ab.timestamp_relative,ab.timestamp);},renderMessageSeparator:function(za){var ab=ka[':fb:mercury:timestamp'].render();ab.removeAttribute('title');var bb=za.timestamp_absolute;if(!bb)bb=ra(new Date(za.timestamp),{withinWeek:'l',withinYear:'F jS',older:'F jS, Y'});if(va.isFirstMessage(za))if(za.timestamp_time_passed===z.TODAY){bb=ua._("Conversation d\u00e9marr\u00e9e aujourd\u2019hui");}else bb=ua._("Conversation d\u00e9marr\u00e9e {timestamp}",[ua.param("timestamp",bb)]);l.setContent(ab,bb);j.show(ab);return l.create('li',{className:"_2n3"},ab);},renderMessageSeparatorForIndex:function(za,ab){var bb=za[ab][0];if(ab){var cb=bb.timestamp,db=za[ab-1],eb=db[db.length-1].timestamp,fb=ma.READ_VIEW_SEPARATOR_TIME_LIMIT;if(cb-eb<fb)return false;}return xa.renderMessageSeparator(bb);},renderRawAttachments:function(za,ab){var bb=h.convertRaw(ab.raw_attachments||[]),cb=(ab.photo_fbids?ab.photo_fbids.length:0)+(ab.image_ids?ab.image_ids.length:0);for(var db=0;db<cb;db++)bb.push({preview_loading:true,attach_type:u.PHOTO,preview_width:206,preview_height:206});if(ab.sticker_id)bb.push({attach_type:u.STICKER});xa.renderAttachments(za,bb,ab);},renderAttachments:function(za,ab,bb){var cb=i.sortAttachmentsStablyByType(ab),db=i.renderPhotoAttachments(ab.filter(i.isPhotoAttachment),bb,468,16,false);if(db)l.appendContent(za,db);for(var eb=0;eb<cb.length;eb++){if(i.isPhotoAttachment(cb[eb]))continue;var fb=i.renderAttachment(false,cb[eb],bb,null,null,na.stickerClicked.bind(na));fb.error&&l.appendContent(za,fb.error);fb.content&&l.appendContent(za,fb.content);}},renderStatus:function(za,ab){if(v.hasErrorStatus(ab)){var bb=ga.createElement(x,{message:new q(ab)}),cb=za.getNode('statusContainer');if(cb&&bb){ga.render(bb,cb);j.show(cb);}}},renderSingleMessage:function(za,ab,bb,cb){if(ab.html_body){var db=za.getNode('fbml');m.listen(db,'click',function(){new g().setURI('/ajax/messaging/async.php').setReadOnly(true).setMethod('GET').setData({action:'htmlDialog',mid:ab.message_id}).send();return false;});j.show(db);var eb=za.getNode('bodyDiv'),fb=l.create('div',{className:"_5xl"}),gb=l.create('div',{className:"_5xm"},fb);l.setContent(eb,gb);k.set(gb,'MessageRenderer:messageID',ab.message_id);var hb=new o({resizeContent:ya}),ib=function(){hb.makeRich(ab.message_id,fb,ab.html_body);};setTimeout(ib,0);xa.renderStatus(za,ab);}else xa.appendMessageToGroup(za,ab);var jb;if(bb.href){jb=l.create('a',{href:bb.href},bb.name);if(ha.getStandaloneMode())jb.setAttribute('target','_blank');var kb=w.getUserIDFromParticipantID(bb.id);if(kb)jb.setAttribute('data-hovercard',n.constructEndpoint({id:kb}));}else jb=bb.name;za.setNodeContent('authorName',jb);var lb=za.getNode('image');j.removeClass(lb,'MercuryThreadImage');var mb=ga.createElement(p,{alt:bb.name,width:fa.IMAGE_SIZE,height:fa.IMAGE_SIZE,src:bb.image_src,className:"_50dv"});if(bb.href)mb=ga.createElement("a",{href:bb.href},mb);mb=ga.render(mb,lb);var nb;if(ab.timestamp_time_passed===z.TODAY){nb='g:ia';}else nb='n/j, g:ia';var ob=ra(new Date(ab.timestamp),nb);wa.renderTimestamp(za.getNode('timestamp'),ab.timestamp_absolute,ob,ab.timestamp);za.getNode('mapHovercard').removeAttribute('href');if(ab.coordinates){j.hide(za.getNode('tooltipForSource'));wa.renderMessageLocation(za.getNode('mapHovercard'),za.getNode('locationIcon'),ab.coordinates);}else{za.getNode('mapHovercard').removeAttribute('data-hovercard');wa.renderMessageSourceTags(za.getNode('tooltipForSource'),za.getNode('sourceIcon'),ab.source_tags||[],ab.author_email);wa.renderSpoofWarning(za.getNode('spoofWarning'),ab.is_spoof_warning,bb);}if(ab.subject)za.setNodeContent('subject',ab.subject);if(ab.has_attachment){var pb=za.getNode('attachments');if(ab.attachments&&ab.attachments.length===0){xa.renderRawAttachments(pb,ab);}else if(ab.attachments!==null&&ab.attachments.length>0){xa.renderAttachments(pb,ab.attachments,ab);}else if(ab.raw_attachments!=null&&ab.raw_attachments.length>0)xa.renderRawAttachments(pb,ab.raw_attachments);}var qb=za.getNode('forwards'),rb=ab.forward_count&&va.getMessagesFromIDs(ab.forward_message_ids);if(rb)xa.renderForwardedMessages(qb,rb);j.conditionShow(qb,rb);}};function ya(za,ab,bb){var cb=sa(za),db=l.find(cb,'iframe'),eb=l.find(db,"^._5xm"),fb=eb.firstChild;ja.set(db,'width',ab+'px');ja.set(db,'height',(bb+1)+'px');db.setAttribute('scrolling','no');var gb=cb&&la.getElementDimensions(cb).x/ab;if(gb&&gb<1){ja.set(eb,'height',Math.round(gb*(bb+1))+'px');var hb=db.style,ib=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],jb;while(jb=ib.shift())if(typeof hb[jb]!=='undefined'){ja.set(db,jb,'scale('+gb+','+gb+')');return;}ja.set(fb,'zoom',gb);}}e.exports=xa;},null);
__d("WebMessengerInfoBoxRenderer",["Event","cx","DOM","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={render:function(l,m){var n=i.create('div',{className:"_4rk"},l),o=i.create('div',{}),p=true;m.forEach(function(q){if(!p){var r=i.create('span',{className:"_4rl"},'\u00b7');i.appendContent(o,r);}p=false;var s=i.create('a',{},q.text);if(q.handler)j.addSubscriptions(g.listen(s,'click',q.handler));i.appendContent(o,s);});return i.create('div',{className:"_4rh"},[n,o]);}};e.exports=k;},null);
__d("WebMessengerDetailViewRecentMessagesControl",["Event","Animation","CSS","WebMessengerDetailViewUnreadMessagesNotice","DOM","Arbiter","MercuryLastMessageIndicator.react","MercuryListUpdateRenderer","MercuryAPIArgsSource","MercuryThreadlistConstants","MercuryViewer","MercuryMessageGroup","WebMessengerMessagesSelection","MessagingTag","React","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","UserActivity","WebMessengerConstants","WebMessengerInfoBoxRenderer","WebMessengerMessageIDFinder","WebMessengerSubscriptionsHandler","copyProperties","cx","debounce","formatDate","ge","fbt","MercuryMessages","MercuryThreadInformer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka){b.__markCompiled&&b.__markCompiled();var la=b('MercuryMessages').get(),ma=b('MercuryThreadInformer').get(),na=b('MercuryThreadActions').get(),oa=b('MercuryThreads').get();function pa(ib,jb,kb,lb,mb,nb,ob){"use strict";this._manager=ib;this._rootElement=jb;this._loadingSpinner=kb;this._noSelectedConversation=lb;this._newMessageLink=mb;this._showUnreadLink=nb;k.empty(this._rootElement);this._pagerExponent=-1;var pb=y[':fb:web-messenger:read-view:recent-messages'].build();k.setContent(this._rootElement,pb.getRoot());this._selectedConversationView=pb.getRoot();this._messageList=pb.getNode('messagelist');this._loadMoreButton=pb.getNode('loadMoreButton');this._loadMoreLink=pb.getNode('loadMoreLink');this._loadMoreCount=pb.getNode('loadMoreCount');this._loadingMoreCount=pb.getNode('loadingMoreCount');this._indicatorNode=pb.getNode('lastMessageIndicator');this._unseenMessagesNotice=new j(this._manager);this._unseenMessagesNotice.setNoticeContextNode(ob);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};z.setupSelectionListener(this._messageList);this._manager.addScrollCallback(ha(hb.bind(null,this),500));ea.addSubscriptions(g.listen(this._loadMoreLink,'click',za.bind(null,this)),ma.subscribe('messages-reordered',function(qb,rb){var sb=this._threadID&&rb[this._threadID];if(sb)va(this);}.bind(this)),ma.subscribe('messages-updated',function(qb,rb){var sb=this._threadID&&rb[this._threadID];if(sb)var tb=Object.keys(sb),ub=tb.length&&sb[tb[0]];if(sb&&ub)va(this,rb[this._threadID]);}.bind(this)),ma.subscribe('messages-updated',hb.bind(null,this)),ma.subscribe('messages-received',function(qb,rb){if(this._threadID&&rb[this._threadID])ya(this,rb);}.bind(this)),ma.subscribe('thread-read-changed',function(qb,rb){if(rb[this._threadID])eb(this,rb[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&za(this);}.bind(this)));}pa.prototype.hideView=function(){"use strict";this._active=false;i.hide(this._rootElement);i.hide(this._loadingSpinner);i.hide(this._noSelectedConversation);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};pa.prototype.updateView=function(){"use strict";this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);i.show(this._rootElement);var ib=ra(this);sa(this);s.clear();if(ib){ta(this);}else cb(this);};pa.prototype.destroy=function(){"use strict";qa(this);this._unseenMessagesNotice.destroy();u.unmountComponentAtNode(this._indicatorNode);};function qa(ib){ib._messagesSubscription&&la.unsubscribe(ib._messagesSubscription.subscriber_id,ib._messagesSubscription.thread_id);ib._messagesSubscription=null;}function ra(ib){var jb=w.getCurrentStateData();if(!ib._threadID||ib._threadID!=jb.thread_id)return true;return false;}function sa(ib){var jb=w.getCurrentStateData();ib._state=w.getCurrentDetailState();ib._threadID=jb.thread_id;ib._selectionEnabled=!!jb.message_action;ib._bugReportingEnabled=jb.bug_reporting_enabled;z.updateSelection(ib._messageList);i.conditionClass(ib._messageList,'bugReportingEnabled',ib._bugReportingEnabled);}function ta(ib){k.scry(ib._rootElement,'.stickerContainer').forEach(function(jb){return u.unmountComponentAtNode(jb);});k.empty(ib._messageList);i.show(ib._loadingSpinner);i.hide(ib._loadMoreButton);qa(ib);ib._pagerExponent=-1;u.unmountComponentAtNode(ib._indicatorNode);delete ib._lastMessageIndicator;if(ib._threadID){i.show(ib._selectedConversationView);i.hide(ib._noSelectedConversation);ib._manager._flexArea.showAtTop(false);if(!ib._olderMessageID[ib._threadID]){ua(ib);}else va(ib);ib._manager.scrollToBottom(false);}else{gb(ib);i.hide(ib._selectedConversationView);i.show(ib._noSelectedConversation);i.hide(ib._loadingSpinner);ib._manager._flexArea.showAtTop(true);}}function ua(ib){ib._loadMessagesInFlight[ib._threadID]=true;ib._currentCountMap[ib._threadID]=ba.INITIAL_MESSAGES_LIMIT+1;i.hide(ib._loadMoreButton);var jb=la.getThreadMessagesRange(ib._threadID,0,ib._currentCountMap[ib._threadID],wa.bind(null,ib),null,o.WEBMESSENGER);if(jb){ib._messagesSubscription={subscriber_id:jb,thread_id:ib._threadID};}else va(ib);}function va(ib,jb){if(!ib._threadID||!ib._olderMessageID[ib._threadID])return;var kb=la.getThreadMessagesSinceTimestamp(ib._threadID,fb(ib._olderMessageID[ib._threadID]));if(kb.length>ib._currentCountMap[ib._threadID])ib._currentCountMap[ib._threadID]=kb.length;xa(ib,kb,jb);}function wa(ib,jb){ib._loadMessagesInFlight[ib._threadID]=false;if(jb&&jb.length){var kb=jb[0].timestamp,lb=ib._olderMessageID[ib._threadID]?fb(ib._olderMessageID[ib._threadID]):null;if(!lb||kb<lb)ib._olderMessageID[ib._threadID]=jb[0].message_id;}}function xa(ib,jb,kb){i.hide(ib._loadingSpinner);i.conditionShow(ib._loadMoreButton,!la.hasLoadedAllMessages(ib._threadID));var lb=oa.getThreadMetaNow(ib._threadID);if(lb){var mb=lb.message_count-jb.length;mb=(mb<0)?0:mb;k.setContent(ib._loadMoreCount,mb);k.setContent(ib._loadingMoreCount,mb);}var nb=function(vb){var wb,xb=ja('wm:'+vb);if(xb)wb=da.findAll(xb);return wb||[];},ob=[],pb=r.calculateMessageGroups(jb),qb={},rb=[];pb.forEach(function(vb){var wb=vb[0].message_id,xb=false;if(kb){xb=vb.some(function(zb){return zb.message_id in kb;});if(!xb){ob=nb(wb);xb=ob.some(function(zb){return zb in kb;});}}if(!xb){ob=nb(wb);if(vb.length==ob.length){for(var yb=0;yb<vb.length;yb++)if(vb[yb].message_id!=ob[yb]){xb=true;break;}}else xb=true;}if(xb)qb[wb]=1;rb.push('wm:'+wb);});var sb=function(vb){return !qb[pb[vb][0].message_id];},tb=function(vb){var wb=pb[vb],xb=z.renderMessageGroup(wb);if(vb==rb.length-1)ib._messageGroup=xb;return xb.getRoot();},ub=function(vb){return z.renderMessageSeparatorForIndex(pb,vb);};n.updateList(ib._messageList,rb,sb,tb,ub);ib._lastMessage=jb[jb.length-1];bb(ib);cb(ib);ib._manager.poke();}function ya(ib,jb){var kb=jb[ib._threadID],lb=ib._manager._flexArea.getScrollableArea(),mb=lb.getScrollHeight();kb.forEach(function(pb){pb.timestamp_relative=ia(new Date(pb.timestamp),'g:ia');var qb=r.canAppendMessageToLastGroup(ib._lastMessage,pb);if(!qb){ib._messageGroup=z.renderMessageGroup([pb]);var rb=pb.timestamp,sb=ib._lastMessage?ib._lastMessage.timestamp:0,tb=ba.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!sb||rb-sb>=tb){var ub=z.renderMessageSeparator(pb);k.appendContent(ib._messageList,ub);}k.appendContent(ib._messageList,ib._messageGroup.getRoot());}else z.appendMessageToGroup(ib._messageGroup,pb);if(pb.author!=q.getID())i.addClass(ib._messageGroup.getRoot(),'unreadHighlight');ib._lastMessage=pb;});ib._manager._flexArea.poke();var nb=lb.getScrollHeight(),ob=lb.getScrollTop();ib._unseenMessagesNotice.updateOnMessagesReceived(mb,nb,ob,jb);bb(ib);if(ib._manager.isScrolledToBottom())cb(ib);}function za(ib){i.addClass(ib._loadMoreButton,'async_saving');if(ib._loadMessagesInFlight[ib._threadID])return;ib._loadMessagesInFlight[ib._threadID]=true;ib._pagerExponent=Math.min(ib._pagerExponent+1,ba.EXPONENTIAL_PAGER_MAX_CYCLES);var jb=Math.pow(2,ib._pagerExponent),kb=ib._currentCountMap[ib._threadID]+(jb*p.WEBMESSENGER_MORE_MESSAGES_COUNT);qa(ib);var lb=la.getThreadMessagesRange(ib._threadID,0,kb,function(mb){i.removeClass(ib._loadMoreButton,'async_saving');ib._currentCountMap[ib._threadID]=kb;wa(ib,mb);ib._loadMessagesInFlight[ib._threadID]=false;},null,o.WEBMESSENGER);if(lb){ib._messagesSubscription={subscriber_id:lb,thread_id:ib._threadID};}else va(ib);}function ab(ib){if(!ib._lastMessageIndicator){var jb;ib._lastMessageIndicator=u.render(u.createElement(m,{threadID:ib._threadID,className:"_510o",indicatorWillShow:function(){return jb=ib._manager.isScrolledToBottom();},indicatorDidShow:function(){return jb&&ib._manager.scrollToBottom(true);}}),ib._indicatorNode);}return ib._lastMessageIndicator;}function bb(ib,jb){ab(ib).setProps({lastMessage:ib._lastMessage});}function cb(ib){if(aa.isActive(5000)){db(ib);}else aa.subscribeOnce(db.bind(null,ib));}function db(ib){if(!ib._threadID||!ib._active)return;na.markRead(ib._threadID);var jb=k.scry(ib._messageList,'.unreadHighlight');jb.forEach(function(kb){i.removeClass(kb,'unreadHighlight');i.addClass(kb,'unreadFading');new h(kb).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(h.ease.both).duration(1500).ondone(function(){i.removeClass(kb,'unreadFading');x.set(kb,'background','');x.set(kb,'borderColor','');}).go();});}function eb(ib,jb){if(!jb.mark_as_read)return;var kb=k.scry(ib._messageList,'.unreadHighlight');for(var lb=0;lb<kb.length;lb++){var mb=kb[lb],nb=da.findAll(mb),ob=la.getMessagesFromIDs(nb);if(ob[ob.length-1].timestamp<jb.timestamp)i.removeClass(mb,'unreadHighlight');}}function fb(ib){var jb=la.getMessagesFromIDs([ib])[0];return jb?jb.timestamp:0;}function gb(ib){if(ib._builtNoSelectionBox)return;var jb=function(){var lb=w.getCurrentStateData(),mb=fa({},lb);w.updateDetailState(v.DETAIL.COMPOSE_MAIN,fa(mb,{start:true,thread_id:(void 0)}));},kb=function(){var lb=w.getCurrentStateData(),mb=fa({},lb);w.updateMasterState(v.MASTER.RECENT_THREADS,fa(mb,{folder:t.INBOX,filter:t.UNREAD}));};k.setContent(ib._noSelectedConversation,ca.render(ka._("Aucune conversation s\u00e9lectionn\u00e9e"),[{text:ka._("Nouveau message"),handler:jb},{text:ka._("Afficher les messages non lus"),handler:kb}]));ib._builtNoSelectionBox=true;}function hb(ib){var jb=ib._manager._flexArea.getScrollableArea(),kb=ib._manager.getFlexAreaBoundingClientRect();l.inform('messengerScrolled/'+ib._threadID,{scrollTop:jb.getScrollTop(),top:kb.y,viewHeight:kb.height});}e.exports=pa;},null);
__d("MercurySearchContextResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryIDs","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","WebMessengerConstants","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=b('MercuryServerRequests').get(),o=new g(),p=j.WEBMESSENGER_SEARCH_SNIPPET_COUNT,q=m.MORE_SEARCH_CONTEXT_COUNT,r={getSearchContext:function(v,w,x){if(v){var y=o.executeOrEnqueue(v,function(da){var ea=t(da,v);x(ea);}),z=o.getUnavailableResources(y);if(z.length){var aa={message_id:v,limit:p+1},ba=n.getServerThreadIDNow(w),ca=i.tokenize(w);if(ca.type=='user'){aa.other_user_fbid=ba;}else aa.thread_fbid=ba;u(aa);}return y;}},getMoreSearchContext:function(v,w,x,y){if(v){var z=o.getResource(v);if(z){var aa=x==m.MORE_SEARCH_CONTEXT_UP?z.up_message_ids:z.down_message_ids,ba=aa.getCurrentArraySize()+q,ca=aa.executeOrEnqueue(0,ba,function(){var ha=t(z,v);y(ha);}),da=aa.getUnavailableResources(ca);if(da.length){var ea={message_id:v,limit:ba,direction:x},fa=n.getServerThreadIDNow(w),ga=i.tokenize(w);if(ga.type=='user'){ea.other_user_fbid=fa;}else ea.thread_fbid=fa;u(ea);}return ca;}}},handleUpdate:function(v){if(v.mercury_payload)n.handleUpdate(v.mercury_payload);var w=v.search_context||{};for(var x in w){var y=w[x],z=y.other_user_fbid||y.thread_fbid,aa=n.getClientThreadIDNow(z),ba=!o.getResource(x),ca=ba?{thread_id:aa,up_message_ids:new k(),down_message_ids:new k()}:o.getResource(x),da=ba?p+1:q;if(y.up_message_ids&&(ca.up_message_ids.getCurrentArraySize()===0||y.up_message_ids.length>=ca.up_message_ids.getCurrentArraySize()))s(ca.up_message_ids,y.up_message_ids,da);if(y.down_message_ids&&(ca.down_message_ids.getCurrentArraySize()===0||y.down_message_ids.length>=ca.down_message_ids.getCurrentArraySize()))s(ca.down_message_ids,y.down_message_ids,da);if(ba)o.setResource(x,ca);}},unsubscribe:function(v,w,x){if(w){var y=o.getResource(w);if(y){if(x==m.MORE_SEARCH_CONTEXT_UP){y.up_message_ids.unsubscribe(v);}else y.down_message_ids.unsubscribe(v);}else o.unsubscribe(v);}}};function s(v,w,x){var y=v.getCurrentArraySize(),z=w.length<y+x;if(w.length){v.removeAllResources();v.addResourcesWithoutSorting(w,0);}if(z)v.setReachedEndOfArray();}function t(v,w){var x=v.up_message_ids.hasReachedEndOfArray(),y=v.up_message_ids.getAllResources();if(!x)y.shift();var z=v.down_message_ids.hasReachedEndOfArray(),aa=v.down_message_ids.getAllResources();if(!z)aa.pop();return {thread_id:v.thread_id,message_id:w,up_message_ids:y,up_exhausted:x,down_message_ids:aa,down_exhausted:z};}function u(v){v.client=h.WEBMESSENGER;l.trySend('/ajax/mercury/search_context.php',v);}l.registerEndpoints({'/ajax/mercury/search_context.php':{mode:l.IMMEDIATE,handler:r.handleUpdate}});e.exports=r;},null);
__d("MercurySearchSnippetResults",["MercuryAPIArgsSource","MercuryIDs","MercurySingletonMixin","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n={},o={},p=null,q=j.WEBMESSENGER_SEARCH_SNIPPET_COUNT,r=j.WEBMESSENGER_SEARCH_SNIPPET_LIMIT,s=j.WEBMESSENGER_SEARCH_SNIPPET_MORE;function t(da){"use strict";this.$MercurySearchSnippetResults0=da;this.$MercurySearchSnippetResults1=m.getForFBID(da);l.registerEndpoints({'/ajax/mercury/search_snippets.php':{request_user_id:da,mode:l.IMMEDIATE,handler:function(ea){this.handleUpdate(ea);}.bind(this)}});}t.prototype.getFBID=function(){"use strict";return this.$MercurySearchSnippetResults0;};t.prototype.getServerRequests=function(){"use strict";return this.$MercurySearchSnippetResults1;};t.prototype.getAllThreadSearchResults=function(da,ea){"use strict";if(da)u(this.$MercurySearchSnippetResults0,da,r,0,ea);};t.prototype.getAllThreadSearchMoreResults=function(da,ea){"use strict";if(da){var fa=n[da];if(fa){var ga=fa.getCurrentArraySize();u(this.$MercurySearchSnippetResults0,da,s,ga,ea);}}};t.prototype.getSingleThreadSearchResults=function(da,ea,fa){"use strict";if(!da||!ea)return;v.call(this,da,ea,q,0,fa);};t.prototype.getSingleThreadSearchMoreResults=function(da,ea,fa){"use strict";if(!da||!ea)return;if(!o[ea])return;var ga=o[ea][da];if(ga){var ha=ga.num_total_snippets,ia=ga.snippets_cbm.getCurrentArraySize(),ja=ha-ia;if(ja>0){var ka=ja>s?s:ja;v.call(this,da,ea,ka,ia,fa);}}};t.prototype.countSnippetsMatchingQueryInThread=function(da,ea){"use strict";var fa=o[ea][da];if(fa)return fa.num_total_snippets;};t.prototype.findIndexOfSnippet=function(da,ea,fa,ga){"use strict";var ha=ba(da,ea),ia=ha.getAllResources();for(var ja=0;ja<ia.length;ja++)if(fa===ia[ja].message_id)return ja;};t.prototype.findSnippetAtIndex=function(da,ea,fa,ga){"use strict";y(da,ea,fa);z.call(this,da,ea,fa,ga);};t.prototype.handleUpdate=function(da){"use strict";if(da.mercury_payload)this.$MercurySearchSnippetResults1.handleUpdate(da.mercury_payload);var ea=da.search_snippets||{};Object.keys(ea).filter(function(ta){return !!ea[ta];}).forEach(function(ta){Object.keys(ea[ta]).forEach(function(ua){ea[ta][ua].snippets.forEach(function(va){va.matched_keywords=w(va.matched_keywords);});});});var fa=da.offset,ga=[];for(var ha in ea){var ia=ea[ha];for(var ja in ia){var ka=ia[ja],la=da.other_user_fbid||da.thread_fbid,ma=this.$MercurySearchSnippetResults1.getClientThreadIDNow(ja),na=ka.snippets,oa=ba(ha,ma),pa=oa.getCurrentArraySize();if(!la){ga.push(ma);if(pa)continue;}else if(fa!=pa)continue;var qa=o[ma][ha];qa.num_total_snippets=ka.num_total_snippets;oa.addResourcesWithoutSorting(na,pa);if(!la||da.limit>na.length)if(oa.getCurrentArraySize()==qa.num_total_snippets)oa.setReachedEndOfArray();}if(!la){var ra=aa(ha),sa=ra.getCurrentArraySize();if(fa==sa){ra.addResourcesWithoutSorting(ga,sa);if(da.limit>ga.length)ra.setReachedEndOfArray();}}}};function u(da,ea,fa,ga,ha){x();var ia=aa(ea),ja=ga+fa,ka=ia.executeOrEnqueue(0,ja,function(na){var oa={};for(var pa=0;pa<na.length;pa++){var qa=na[pa],ra=o[qa][ea];oa[qa]={num_total_snippets:ra.num_total_snippets,snippets:ra.snippets_cbm.getAllResources()};}var sa=ia.hasReachedEndOfArray();ha(oa,sa);}),la=ia.getUnavailableResources(ka);if(la.length){p={query:ea,thread_id:null,subscriber_id:ka};var ma={query:ea,offset:ga,limit:fa+1,snippetLimit:q};ma.identifier='thread_fbid';ca(ma,da);}}function v(da,ea,fa,ga,ha){x();var ia=ba(da,ea),ja=ga+fa,ka=ia.executeOrEnqueue(0,ja,function(){var qa=ia.getAllResources(),ra=o[ea][da].num_total_snippets;ha(qa,ra);}),la=ia.getUnavailableResources(ka);if(la.length){p={query:da,thread_id:ea,subscriber_id:ka};var ma={query:da,snippetOffset:ga,snippetLimit:fa},na=this.getServerRequests().getServerThreadIDNow(ea),oa=h.tokenize(ea),pa=oa.type;if(pa=='user'){ma.other_user_fbid=na;}else ma.thread_fbid=na;ma.identifier='thread_fbid';ca(ma,this.getFBID());}}function w(da){if(da instanceof Array){var ea={};for(var fa=0;fa<da.length;fa++)ea[fa.toString()]=da[fa];return ea;}else return da;}function x(){if(p){if(p.thread_id){var da=ba(p.query,p.thread_id);da.unsubscribe(p.subscriber_id);}else{var ea=aa(p.query);ea.unsubscribe(p.subscriber_id);}p=null;}}function y(da,ea,fa){}function z(da,ea,fa,ga){var ha=o[ea][da],ia=ha.snippets_cbm.getAllResources(),ja=ha.num_total_snippets,ka=ia.length;if(fa<ka){ga(ia[fa].message_id);return;}var la=ja-ka,ma=la>s?s:la;v.call(this,da,ea,ma,ka,function(na,oa){z.call(this,da,ea,fa,ga);});}function aa(da){if(!n[da])n[da]=new k();return n[da];}function ba(da,ea){if(!o[ea])o[ea]={};var fa=o[ea][da];if(!fa){fa={num_total_snippets:-1,snippets_cbm:new k()};o[ea][da]=fa;}return fa.snippets_cbm;}function ca(da,ea){da.client=g.WEBMESSENGER;l.trySend('/ajax/mercury/search_snippets.php',da,null,ea);}Object.assign(t,i);e.exports=t;},null);
__d("WebMessengerDetailViewSearchContextControl",["Event","CSS","DOM","MercuryMessageGroup","WebMessengerMessagesSelection","MercurySearchContextResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","WebMessengerConstants","fbt","WebMessengerSubscriptionsHandler","MercuryMessages","MercurySearchSnippetResults"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=b('MercuryMessages').get(),u=b('MercurySearchSnippetResults').get();function v(fa,ga,ha){"use strict";this._manager=fa;this._rootElement=ga;this._paginationBox=ha;i.empty(this._rootElement);var ia=o[':fb:web-messenger:read-view:search-context'].build(),ja=o[':fb:web-messenger:read-view:search-pagination-box'].build();i.setContent(this._rootElement,ia.getRoot());i.setContent(this._paginationBox,ja.getRoot());this._messagelistRoot=ia.getRoot();this._loadingSpinner=ia.getNode('loadingSpinner');this._messageList=ia.getNode('messagelist');this._loadMoreButton=ia.getNode('loadMoreButton');this._loadMoreLink=ia.getNode('loadMoreLink');this._downMoreButton=ia.getNode('downMoreButton');this._downMoreLink=ia.getNode('downMoreLink');this._nextSnippet=ja.getNode('nextSnippet');this._previousSnippet=ja.getNode('previousSnippet');this._backToSnippetsButton=ja.getNode('backToSnippetsButton');this._snippetCountDescription=ja.getNode('snippetCountDescription');this._paginationBoxCloseButton=ja.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;p.setupSelectionListener(this._messageList);s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');da(this,q.MORE_SEARCH_CONTEXT_UP);}.bind(this)),g.listen(this._downMoreLink,'click',function(){h.addClass(this._downMoreButton,'async_saving');da(this,q.MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),g.listen(this._nextSnippet,'click',w.bind(null,this,1)),g.listen(this._previousSnippet,'click',w.bind(null,this,-1)),g.listen(this._backToSnippetsButton,'click',function(){var ka=n.getCurrentStateData(),la=ka.single_thread_search?m.DETAIL.SEARCH_THREAD_SNIPPET:m.DETAIL.SEARCH_SNIPPET,ma={folder:ka.folder,message_query:ka.message_query,query:ka.query};if(ka.single_thread_search)ma.thread_id=ka.thread_id;n.updateDetailState(la,ma);}),g.listen(this._paginationBoxCloseButton,'click',function(){n.updateDetailState(m.DETAIL.RECENT_MESSAGES,{thread_id:n.getCurrentStateData().thread_id});}.bind(this)));}v.prototype.hideView=function(){"use strict";h.hide(this._rootElement);h.hide(this._paginationBox);};v.prototype.updateView=function(){"use strict";h.show(this._rootElement);h.show(this._paginationBox);var fa=z(this);aa(this);k.clear();if(fa)ca(this);};v.prototype.destroy=function(){"use strict";y(this);};function w(fa,ga){var ha=n.getCurrentStateData(),ia=u.findIndexOfSnippet(fa._messageQuery,ha.thread_id,ha.message_id),ja=ia+ga;h.hide(fa._messageList);h.hide(fa._loadMoreButton);h.hide(fa._downMoreButton);h.show(fa._loadingSpinner);u.findSnippetAtIndex(fa._messageQuery,ha.thread_id,ja,function(ka){h.show(fa._messageList);x(ha,ka);});}function x(fa,ga){var ha={folder:fa.folder,message_id:ga,message_query:fa.message_query,query:fa.query,single_thread_search:fa.single_thread_search,thread_id:fa.thread_id};n.updateDetailState(n.getCurrentDetailState(),ha);}function y(fa){fa._searchContextSubscription&&l.unsubscribe(fa._searchContextSubscription.subscriber_id,fa._searchContextSubscription.message_id,fa._searchContextSubscription.direction);fa._searchThreadsSubscription=null;}function z(fa){var ga=n.getCurrentStateData();if(fa._threadID!=ga.thread_id)return true;if(fa._messageQuery!=ga.message_query)return true;if(fa._messageID!=ga.message_id)return true;return false;}function aa(fa){var ga=n.getCurrentStateData();fa._state=n.getCurrentDetailState();fa._threadID=ga.thread_id;fa._messageQuery=ga.message_query;fa._messageID=ga.message_id;fa._selectionEnabled=!!ga.message_action;p.updateSelection(fa._messageList);h.conditionClass(fa._messageList,'bugReportingEnabled',ga.bug_reporting_enabled);}function ba(fa,ga){i.setAttributes(fa,{disabled:ga});var ha=i.find(fa,'^label');h.conditionClass(ha,'uiButtonDisabled',ga);}function ca(fa){var ga=i.create('strong',{},fa._messageQuery),ha=u.countSnippetsMatchingQueryInThread(fa._messageQuery,fa._threadID),ia=u.findIndexOfSnippet(fa._messageQuery,fa._threadID,fa._messageID),ja=ia+1,ka=r._({"*":"{index}\/{count} r\u00e9sultats pour {query}"},[r.param("index",ja),r.param("count",ha,[0]),r.param("query",ga)]);i.setContent(fa._snippetCountDescription,ka);ba(fa._previousSnippet,ia===0);ba(fa._nextSnippet,ia===ha-1);i.empty(fa._messageList);h.show(fa._loadingSpinner);h.hide(fa._loadMoreButton);h.hide(fa._downMoreButton);y(fa);if(fa._threadID&&fa._messageID){var la=l.getSearchContext(fa._messageID,fa._threadID,function(ma){h.hide(fa._loadingSpinner);ea(fa,ma);});if(la)fa._searchContextSubscription={subscriber_id:la,message_id:fa._messageID};}}function da(fa,ga){y(fa);if(fa._threadID&&fa._messageID){var ha=l.getMoreSearchContext(fa._messageID,fa._threadID,ga,function(ia){if(ga==q.MORE_SEARCH_CONTEXT_UP){h.removeClass(fa._loadMoreButton,'async_saving');}else h.removeClass(fa._downMoreButton,'async_saving');ea(fa,ia);});if(ha)fa._searchContextSubscription={subscriber_id:ha,message_id:fa._messageID,direction:ga};}}function ea(fa,ga){h.conditionShow(fa._loadMoreButton,!ga.up_exhausted);h.conditionShow(fa._downMoreButton,!ga.down_exhausted);var ha=ga.up_message_ids.concat([ga.message_id],ga.down_message_ids),ia=t.getMessagesFromIDs(ha);i.empty(fa._messageList);var ja=j.calculateMessageGroups(ia);ja.forEach(function(ka,la){var ma=p.renderMessageSeparatorForIndex(ja,la);if(ma)i.appendContent(fa._messageList,ma);var na=p.renderMessageGroup(ka,false,'context:').getRoot(),oa=ka.some(function(pa){return pa.message_id==ga.message_id;});if(oa)h.addClass(na,'selectedHighlight');i.appendContent(fa._messageList,na);});}e.exports=v;},null);
__d("WebMessengerSearchSnippetsRenderer",["Event","CSS","DOM","Image.react","MercuryMessageRenderer","MercuryParticipants","MercuryParticipantsConstants","React","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","cx","fbt","MercurySearchSnippetResults","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=b('MercurySearchSnippetResults').get(),u=b('MercuryThreadMetadataRenderer').get(),v={renderMultipleSnippetBlocks:function(ba,ca,da){da=da||{};var ea=true;for(var fa in da){ea=false;var ga=q[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());v.renderSingleSnippetBlock(ga,ca,fa,da[fa]);}if(ea)aa(ba);},renderThreadSnippetBlock:function(ba,ca,da,ea,fa){if(!ea||!ea.length){aa(ba);return;}var ga=q[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());h.hide(ga.getNode('searchThreadName'));w(ga,ca,da,ea,fa);},renderSingleSnippetBlock:function(ba,ca,da,ea){var fa=ba.getNode('searchThreadName'),ga=i.create('h3');i.setContent(fa,ga);u.renderAndSeparatedParticipantList(da,ga);w(ba,ca,da,ea.snippets,ea.num_total_snippets);},renderMultipleSnippets:function(ba,ca,da,ea){(ea||[]).forEach(function(fa){var ga=q[':fb:web-messenger:read-view:search-snippet'].build();i.appendContent(ba,ga.getRoot());l.get(fa.author,function(ha){v.renderSingleSnippet(ga,ca,da,fa,ha);});});},renderSingleSnippet:function(ba,ca,da,ea,fa){ba.setNodeProperty('bodyDiv','id','snippet:'+ea.message_id);var ga=ea.matched_keywords||(void 0),ha=k.formatMessageBody(ea.body,ga);ba.setNodeContent('body',ha);var ia=ba.getNode('image');h.removeClass(ia,'MercuryThreadImage');h.addClass(ia,'MercuryMediumThreadImage');var ja=n.createElement(j,{width:m.IMAGE_SIZE,height:m.IMAGE_SIZE,src:fa.image_src});if(fa.href)ja=n.createElement("a",{href:fa.href},ja);n.render(ja,ia);var ka=fa.short_name;ba.setNodeContent('shortName',s._("{name}\u00a0:",[s.param("name",ka)])+' ');u.renderTimestamp(ba.getNode('timestamp'),ea.timestamp_absolute,ea.timestamp_relative,ea.timestamp);var la=ba.getNode('seeContext');g.listen(la,'click',function(){var ma=p.getCurrentStateData(),na={message_query:ca,query:ma.query,thread_id:da,message_id:ea.message_id},oa=p.getCurrentDetailState();if(oa===o.DETAIL.SEARCH_THREAD_SNIPPET)na.single_thread_search=true;p.updateDetailState(o.DETAIL.SEARCH_CONTEXT,na);return false;});}};function w(ba,ca,da,ea,fa){var ga=ba.getNode('snippetList');v.renderMultipleSnippets(ga,ca,da,ea);var ha=fa-ea.length;x(ba,ca,da,fa,ha);}function x(ba,ca,da,ea,fa){var ga=ba.getNode('totalSnippetsCount'),ha=ba.getNode('moreSnippetsLink');h.conditionShow(ha,fa>0);if(fa>0){var ia=z(fa);i.setContent(ha,ia);}i.setContent(ga,y(ea));if(fa>0)g.listen(ha,'click',function(){t.getSingleThreadSearchMoreResults(ca,da,function(ja){i.empty(ba.getNode('snippetList'));w(ba,ca,da,ja,ea);});});}function y(ba){if(ba==1){return s._("1 r\u00e9sultat");}else return s._({"*":"{count} r\u00e9sultats"},[s.param("count",ba,[0])]);}function z(ba){if(ba==1){return s._("Afficher 1 r\u00e9sultat de plus");}else return s._({"*":"Afficher {count} r\u00e9sultats de plus"},[s.param("count",ba,[0])]);}function aa(ba){var ca=s._("Aucun r\u00e9sultat"),da=i.create('div',{className:"_2n4"},ca);i.setContent(ba,da);}e.exports=v;},null);
__d("WebMessengerDetailViewSearchSnippetsControl",["JSXDOM","Event","CSS","DOM","WebMessengerSearchSnippetsRenderer","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerPermalinks","WebMessengerSubscriptionsHandler","cx","fbt","MercurySearchSnippetResults"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercurySearchSnippetResults').get();function t(y,z){"use strict";this._manager=y;this._rootElement=z;j.empty(this._rootElement);var aa=n[':fb:web-messenger:read-view:search-snippets'].build();j.setContent(this._rootElement,aa.getRoot());this._loadingSpinner=aa.getNode('loadingSpinner');this._messageList=aa.getNode('messagelist');this._downMoreButton=aa.getNode('downMoreButton');this._downMoreLink=aa.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;i.hide(this._downMoreButton);p.addSubscriptions(h.listen(this._downMoreLink,'click',function(){i.addClass(this._downMoreButton,'async_saving');x(this);}.bind(this)));}t.prototype.hideView=function(){"use strict";i.hide(this._rootElement);};t.prototype.updateView=function(){"use strict";i.show(this._rootElement);var y=u(this);v(this);if(y)w(this);};t.prototype.destroy=function(){"use strict";};function u(y){var z=m.getCurrentDetailState();if(y._state!=z)return true;var aa=m.getCurrentStateData();if(y._messageQuery!=aa.message_query)return true;if(z==l.DETAIL.SEARCH_THREAD_SNIPPET)if(y._threadID!=aa.thread_id)return true;return false;}function v(y){y._state=m.getCurrentDetailState();var z=m.getCurrentStateData();y._threadID=z.thread_id;y._messageQuery=z.message_query;}function w(y){i.hide(y._downMoreButton);j.empty(y._messageList);if(y._messageQuery){i.show(y._loadingSpinner);if(y._state===l.DETAIL.SEARCH_THREAD_SNIPPET&&y._threadID){s.getSingleThreadSearchResults(y._messageQuery,y._threadID,function(z,aa){i.hide(y._loadingSpinner);k.renderThreadSnippetBlock(y._messageList,y._messageQuery,y._threadID,z,aa);var ba=g.a({className:"_4-ii"},r._("Rechercher {query} dans toutes les conversations",[r.param("query",y._messageQuery)])),ca=o.getURI(l.MASTER.SEARCH,l.DETAIL.SEARCH_SNIPPET,{query:y._messageQuery,message_query:y._messageQuery});ba.setAttribute('href',ca);j.prependContent(y._messageList,g.div({className:"_4-ij"},ba));});}else s.getAllThreadSearchResults(y._messageQuery,function(z,aa){i.hide(y._loadingSpinner);k.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}}function x(y){if(y._messageQuery)s.getAllThreadSearchMoreResults(y._messageQuery,function(z,aa){i.removeClass(y._downMoreButton,'async_saving');j.empty(y._messageList);k.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}e.exports=t;},null);
__d("Ellipsizer",["CSS","Style","UserAgent_DEPRECATED","cx","getElementText"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l=1;function m(n){this.elements=[];this.descend=true;n.forEach(function(o){g.addClass(o,"_6qy");this.elements.push({node:o});},this);return this;}m.prototype.setDescend=function(n){this.descend=n;return this;};m.prototype.$Ellipsizer0=function(){var n;this.elements.forEach(function(o){n=o.node;if(this.descend)while(n.children.length===1)n=n.children[0];if(n===o.node)h.set(n,'width','');i.ie()&&h.set(n,'position','absolute');o.width=n.offsetWidth;i.ie()&&h.set(n,'position','');},this);this.elements.sort(function(o,p){return o.width-p.width;});};m.prototype.confineWithin=function(n,o){o=o||l;this.$Ellipsizer0();var p=n;this.elements.forEach(function(q,r){var s=Math.floor(p/(this.elements.length-r));if(q.width<=s||q.width<=0||s<=0||(q.width<=s*o&&p>=s*o)){g.removeClass(q.node,"_6s5");h.set(q.node,'width','');p-=q.width;if(q.titleSet){q.node.setAttribute('title','');q.titleSet=false;}}else{g.addClass(q.node,"_6s5");h.set(q.node,'width',s+'px');p-=s;if(!q.titleSet&&!q.node.getAttribute('title')){q.node.setAttribute('title',k(q.node));q.titleSet=true;}}},this);};e.exports=m;},null);
__d("MessagesEmoticonView",["DOM","EmoticonsList","Event","Focus","InputSelection","Keys","Parent","SubscriptionsHandler","TextAreaControl","Toggler","UserAgent_DEPRECATED","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=h.symbols;function u(x){return m.byClass(x,"_5r8h");}function v(x,y,z,aa){var ba=m.byClass(x,'emoticon');if(!ba)return;var ca='emoticon_',da=null;ba.className.split(' ').forEach(function(ka){if(ka.startsWith(ca))da=ka.substring(ca.length);});if(!t[da])return;if(!aa)return true;var ea=o.getInstance(y),fa=ea.getValue(),ga=t[da],ha=fa.substring(0,z.start),ia=fa.substring(z.end);if(z.start>0&&!ha.endsWith(' '))ga=' '+ga;if(!ia.startsWith(' '))ga+=' ';var ja=ha+ga+ia;z.start+=ga.length;z.end=z.start;ea.setValue(ja);k.set(y,z.start,z.end);return true;}function w(x,y){var z={start:0,end:0};function aa(){z=k.get(y);}var ba=g.find(x,'.uiToggleFlyout');this._subscriptions=new n();this._subscriptions.addSubscriptions(p.subscribe('show',function(ca,da){if(da.active&&g.contains(x,da.active)){k.set(y,z.start,z.end);var ea=g.scry(ba,'a.emoticon')[0];ea&&j.setWithoutOutline(ea);}}),i.listen(ba,'click',function(event){v(event.getTarget(),y,z,true);}),i.listen(ba,'keyup',function(event){if(event.keyCode===l.ESC){p.hide(x);k.set(y,z.start,z.end);}}),i.listen(y,'keyup',aa),i.listen(y,'click',aa));if(q.chrome()||q.ie()||q.opera())this._subscriptions.addSubscriptions(i.listen(ba,'mousedown',function(event){var ca=i.listen(document.documentElement,'click',function(event){var da=event.getTarget(),ea=v(da,y,z,false),fa=u(da);!ea&&!fa&&p.show(x);ca.remove();});}.bind(this)));}r(w.prototype,{destroy:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;}});r(w,{create:function(x,y){return new w(x,y);}});e.exports=w;},null);
__d("TabIndexDelegator",["CSS","DOM","Event","Focus","JSXDOM"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(m,n){"use strict";this._placeholder=n||k.button(null);this._placeholder.setAttribute('aria-hidden',true);g.addClass(this._placeholder,'accessible_elem');this._listener=i.listen(this._placeholder,'click',function(){m.click();});j.relocate(this._placeholder,m);this.enable();}l.prototype.enable=function(){"use strict";g.show(this._placeholder);};l.prototype.disable=function(){"use strict";g.hide(this._placeholder);};l.prototype.getPlaceholder=function(){"use strict";return this._placeholder;};l.prototype.destroy=function(){"use strict";this._listener.remove();h.remove(this._placeholder);};e.exports=l;},null);
__d("UnsentMessageDialog",["Dialog","WebMessengerEvents","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={get:function(){var k=[{label:i._("Ne pas envoyer"),name:g.OK.name},{label:i._("Rester sur le message"),name:g.CANCEL.name,className:g.CANCEL.className}];return new g().setTitle(i._("Ne pas envoyer le message\u00a0?")).setBody(i._("Si vous quittez cette page, votre message ne sera pas envoy\u00e9.")).setButtons(k).setCloseHandler(h.inform.bind(h,h.FOCUS_COMPOSER)).setModal(true);}};e.exports=j;},null);
__d("XMessagingSetPreferencesController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/messaging\/preferences\/",{send_on_enter:{type:"Bool",defaultValue:false}});},null);
__d("WebMessengerDetailViewBottomShelfControl",["ARIA","Arbiter","AsyncDialog","AsyncRequest","BanzaiLogger","Button","CSS","MercuryConstants","DOM","Ellipsizer","Event","Focus","MercuryFolders","Input","Keys","Locale","MercuryAPIArgsSource","MercuryIDs","MercuryFileUploader","MercuryPhotoUploader","MercuryReadOnlyReason","MercuryShareLinkUploader","MercurySourceType","MercuryThreadInfo","MessagesEmoticonView","PUWMethods","PhotosUploadWaterfall","WebMessengerPreferences","React","Run","WebMessengerStateConstants","WebMessengerStateManager","StickerActions","StickersFlyout.react","StickerState","StickerStoreController","Style","TabIndexDelegator","WebMessengerTemplates","TextAreaControl","Toggler","UnsentMessageDialog","URI","UserAgent_DEPRECATED","VaultBoxURI","Vector","WebMessengerEvents","WebMessengerSubscriptionsHandler","XMessagingSetPreferencesController","arrayContains","copyProperties","csx","csx","fbt","isWebMessengerURI","MercuryDraftsController","MercuryServerRequests","MercuryMessageObject","MercuryMessageActions","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib){b.__markCompiled&&b.__markCompiled();var jb=b('MercuryDraftsController').get(),kb=b('MercuryServerRequests').get(),lb=b('MercuryMessageObject').get(),mb=b('MercuryMessageActions').get(),nb=b('MercuryThreadInformer').get(),ob=b('MercuryThreads').get(),pb="_1rh";function qb(uc,vc){"use strict";this._manager=uc;this._rootElement=vc;this._sendOnEnterDefault=ha.sendOnEnter;o.empty(this._rootElement);var wc=sa[':fb:web-messenger:read-view:bottom-shelf'].build();o.setContent(this._rootElement,wc.getRoot());this._bottomShelfToolbar=wc.getNode('toolbar');this._bottomShelfComposer=wc.getNode('composer');this._bottomShelfButtons=wc.getNode('buttons');this._autogrowContainer=wc.getNode('autogrowContainer');this._composerBox=wc.getNode('composerTextarea');this._composerGrid=wc.getNode('composerGrid');this._sendContainer=wc.getNode('sendContainer');this._replyButton=wc.getNode('replyButton');this._uploadingWarning=wc.getNode('uploadingWarning');this._replyButtonLabel=o.find(this._sendContainer,"._1ri");this._sendOnEnterButton=wc.getNode('sendOnEnterButton');this._loadingIndicator=wc.getNode('loadingIndicator');this._cannotReplyAlert=wc.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');bb.addSubscriptions(q.listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),ab.subscribe(ab.UPDATE_SELECTION,tc.bind(null,this)),ab.subscribe(ab.FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=wc.getNode('emoteWrapper');this._stickersFlyoutToggler=wc.getNode('emoticons');this._emoticonsPanel=new ea(this._stickersFlyoutToggler,this._composerBox);var xc=wc.getNode('stickers');if(xc){this._stickersFlyout=ia.render(ia.createElement(na,{onStickerSelect:function(ad){fc(this,ad);}.bind(this)}),xc);bb.addSubscriptions(ab.subscribe(ab.STICKER_CLICKED,this._onStickerClick.bind(this)));bb.addSubscriptions(oa.addListener(oa.PACK_SELECTED,function(ad){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:ad});}.bind(this)));}this._messageSent=false;this._fileUploader=new y(wc.getNode('attachmentShelf'),wc.getNode('attachButtonForm'),wc.getNode('fileInput'),wc.getNode('attachID'));this._shareLinkUploader=new ba(wc.getNode('shareStage'),wc.getNode('shareStageContent'),wc.getNode('shareStageLoadingIndicator'),wc.getNode('shareStageCloseButton'),this._composerBox);r.relocate(this._replyButton,this._replyButtonLabel);this._delegator=new ra(this._replyButtonLabel);o.prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());d(['TypingDetectorController'],function(ad){this._typingDetector=new ad(null,this._composerBox,'web-messenger',null,null);sc(this);}.bind(this));this._photoUploader=new z(this._composerGrid,wc.getNode('photoButton'),bb,wc.getNode('composer'));var yc=false;bb.addSubscriptions(this._photoUploader.subscribe('dom-updated',ab.detailDOMChanged.bind(ab)),this._photoUploader.subscribe('menu-show',function(ad,bd){if(!yc){this.waterfallStep(ga.BEGIN,bd);yc=true;}}.bind(this)),this._photoUploader.subscribe('selection-start',function(ad,bd){this.waterfallStep(ga.SELECT_START,bd);}.bind(this)),this._photoUploader.subscribe('upload-started',function(ad,bd){this.waterfallStep(ga.IMAGES_SELECTED,{method:bd.method||this._photoUploader.getCurrentMethod()});this.waterfallStep(ga.UPLOAD_START,{count:bd.imageCount});}.bind(this)),this._photoUploader.subscribe('upload-completed',function(ad,bd){var cd=this._photoUploader.getCurrentMethod();if(cd!==fa.FILE_SELECTOR)this.waterfallStep(ga.IMAGES_SELECTED,{method:cd});for(var dd=0;dd<bd.fbids.length;++dd)this.waterfallStep(ga.ONE_UPLOAD_DONE);this._composerBox.focus();var ed=hb._("Une photo a \u00e9t\u00e9 jointe \u00e0 votre message.");g.notify(ed);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(ad,bd){if(this._blockedOnUpload){ic(this,false);gc(this);}this.waterfallStep(ga.ALL_UPLOADS_DONE,bd);}.bind(this)));var zc=o.scry(this._bottomShelfToolbar,"._6q-");zc.push(wc.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new p(zc);bb.addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){ic(this,false);gc(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',ic.bind(null,this,false)),this._fileUploader.subscribe('dom-updated',ab.detailDOMChanged.bind(ab)));this._confirmationSubscription=la.registerConfirmationBeforeStateUpdate(function(ad,bd,cd){if(!jb.canSaveDrafts(this._threadID)&&oc(this)&&rb(this,bd,cd))return va.get();return false;}.bind(this));pc(this);bb.addSubscriptions(h.subscribe('page_transition',function(ad,bd){if(ib(bd.uri))pc(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',ab.detailDOMChanged.bind(ab)),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)));ta.getInstance(this._composerBox).subscribe('resize',function(){ab.detailDOMChanged();}.bind(this));rc(this);bb.addSubscriptions(q.listen(this._replyButtonLabel,'click',gc.bind(null,this)),q.listen(this._replyButton,'keydown',ub.bind(null,this)),q.listen(this._composerBox,'keydown',ub.bind(null,this)),q.listen(this._composerBox,'paste',vb.bind(null,this)),q.listen(this._sendOnEnterButton,'click',xb.bind(null,this)),q.listen(wc.getNode('cancelButton'),'click',jc),q.listen(wc.getNode('deleteButton'),'click',kc.bind(null,this)),q.listen(wc.getNode('reportSpamButton'),'click',mc.bind(null,this)),ab.subscribe(ab.DETAIL_DOM_CHANGED,wb.bind(null,this)));bb.addSubscriptions(nb.subscribe('threads-updated',function(ad,bd){bd[this._threadID]&&this.updateView();}.bind(this)));}qb.prototype._onStickerClick=function(uc,vc){"use strict";if(!vc||!vc.packID)return;var wc=vc.packID,xc=vc.stickerID;k.log('StickersLoggerConfig',{event:'click_sticker',packid:wc,stickerid:xc});oa.onTrayDataReady(function(){if(db(oa.getPackIDsInTray(),wc)){var yc=oa.getPack(wc);if(yc&&yc.isPromoted)ma.addPack(wc);var zc=this._stickersFlyout,ad=this._stickersFlyoutToggler;if(!ad||!zc||!zc.isMounted())return;ma.selectPack(wc);ua.show(ad);}else pa.showStore(wc);}.bind(this));};qb.prototype.waterfallStep=function(uc,vc){"use strict";var wc=this._photoUploader.getWaterfallID();if(!wc)return;ga.sendSignal(eb({qn:wc,step:uc,uploader:ga.APP_MESSENGER},vc||{}));};qb.prototype.hideView=function(){"use strict";m.hide(this._rootElement);};qb.prototype.updateView=function(){"use strict";var uc=la.getCurrentDetailState();m.show(this._rootElement);var vc=la.getCurrentStateData();rb(this,uc,vc)&&hc(this);m.hide(this._bottomShelfComposer);m.removeClass(this._bottomShelfComposer,'invisible_elem');m.hide(this._bottomShelfButtons);m.show(this._sendOnEnterButton);m.hide(this._cannotReplyAlert);zb(this,this._sendOnEnterDefault);switch(uc){case ka.DETAIL.RECENT_MESSAGES:case ka.DETAIL.SEARCH_CONTEXT:this._threadID=vc.thread_id;if(vc.message_action==ka.MESSAGE_ACTION.DELETE||vc.message_action==ka.MESSAGE_ACTION.REPORT_SPAM){qc(this,vc.message_action);}else if(this._threadID)ob.getThreadMeta(this._threadID,function(wc){if(da.canReply(wc)){m.show(this._bottomShelfComposer);rc(this);jb.loadDraft(this._threadID,this._composerBox,this._fileUploader,this._shareLinkUploader,this._photoUploader);this._shareLinkUploader.check();}else{ia.render(ia.createElement("span",null,aa.getReason(wc)),this._cannotReplyAlert);m.show(this._cannotReplyAlert);}tb(this,wc);}.bind(this));break;case ka.DETAIL.COMPOSE_MAIN:this._threadID=null;m.show(this._bottomShelfComposer);rc(this);tb(this,null);break;default:this._threadID=null;break;}sb(this,uc,vc);sc(this);ab.detailDOMChanged();this._state=uc;};qb.prototype.focusComposer=function(){"use strict";this._composerBox.focus();};qb.prototype.submitReply=function(){"use strict";gc(this);};qb.prototype.destroy=function(){"use strict";this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader.destroy();la.unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);};qb.prototype.getStickersFlyoutToggler=function(){"use strict";return this._stickersFlyoutToggler;};function rb(uc,vc,wc){switch(vc){case ka.DETAIL.RECENT_MESSAGES:case ka.DETAIL.SEARCH_CONTEXT:return !wc.reuse_composer&&(uc._threadID!=wc.thread_id||uc._state!=vc);case ka.DETAIL.COMPOSE_MAIN:return wc.start;case ka.DETAIL.SEARCH_SNIPPET:case ka.DETAIL.SEARCH_THREAD_SNIPPET:case ka.DETAIL.SHARED_PHOTOS:return true;}return false;}function sb(uc,vc,wc){var xc=wc.participants&&wc.participants.length>0;m.conditionClass(uc._replyButtonLabel,'uiButtonDisabled',vc==ka.DETAIL.COMPOSE_MAIN&&!xc);}function tb(uc,vc){var wc,xc;if(!vc){wc=hb._("Envoyer");xc=hb._("Votre message...");}else if(vc.participants&&vc.participants.length<=2){wc=hb._("R\u00e9pondre");xc=hb._("Votre r\u00e9ponse...");}else{wc=hb._("R\u00e9pondre \u00e0 tous");xc=hb._("Votre r\u00e9ponse...");}if(uc._composerBox.getAttribute('placeholder')!=xc)t.setPlaceholder(uc._composerBox,xc);l.setLabel(uc._replyButton,wc);cc(uc);}function ub(uc,event){var vc=event.getModifiers();if(vc.any&&event.keyCode!==u.RETURN)return;var wc=false;switch(event.keyCode){case u.ESC:var xc=uc.getStickersFlyoutToggler();ua.hide(xc);return;case u.SPACE:wc=event.getTarget()===uc._replyButton;break;case u.RETURN:var yc=!m.hasClass(uc._bottomShelfComposer,pb),zc=event.getTarget()===uc._replyButton,ad=false;if(!yc){if(xa.windows()){ad=vc.control;}else if(xa.osx()){ad=vc.meta;}else ad=vc.control||vc.meta;}else if(event.getModifiers().any)return;wc=zc||yc||ad;break;case u.UP:case u.DOWN:var bd=la.getCurrentDetailState();if(uc._composerBox.value||bd!=ka.DETAIL.RECENT_MESSAGES)event.stop();break;}if(wc){gc(uc);uc.focusComposer();return false;}}function vb(uc,event){if(xa.chrome()){var vc=event.clipboardData||event.originalEvent.clipboardData;if(!vc||!vc.items||vc.items.length<1)return;var wc=vc.items[0].type;if(wc!=='image/png')return;if(vc.items[0].getAsFile){var xc=vc.items[0].getAsFile();uc._photoUploader.uploadPastedFile(xc);}}}function wb(uc){rc(uc);ac(uc);}function xb(uc){yb(uc);var vc=!uc._sendOnEnterDefault;uc.focusComposer();uc._sendOnEnterDefault=vc;ha.sendOnEnter=vc;var wc=cb.getURIBuilder().setBool('send_on_enter',vc).getURI();new j(wc).send();}function yb(uc){m.toggleClass(uc._bottomShelfComposer,pb);if(m.hasClass(uc._bottomShelfComposer,pb)){uc._sendOnEnterButton.setAttribute('aria-checked','false');}else uc._sendOnEnterButton.setAttribute('aria-checked','true');cc(uc,true);ab.detailDOMChanged();}function zb(uc,vc){if(vc==m.hasClass(uc._bottomShelfComposer,pb))yb(uc);}function ac(uc){var vc;if(m.hasClass(uc._bottomShelfComposer,pb)){vc=bc(uc);}else vc=0;var wc=za.getElementDimensions(uc._bottomShelfToolbar).x;uc._ellipsizer.confineWithin(wc-vc-120,1.3);}function bc(uc){return za.getElementDimensions(uc._replyButtonLabel).x+20;}function cc(uc,vc){var wc='',xc='';if(!m.hasClass(uc._bottomShelfComposer,pb)){xc=bc(uc)+'px';wc='-1';uc._delegator.disable();}else uc._delegator.enable();m.conditionClass(uc._sendContainer,'transition',vc);uc._replyButton.setAttribute('tabindex',wc);qa.set(uc._sendContainer,v.isRTL()?'right':'left',xc);}function dc(uc){var vc=la.getCurrentStateData(),wc=lb.constructUserGeneratedMessageObject(t.getValue(uc._composerBox),ca.TITAN_WEB,vc.thread_id,vc.participants),xc=uc._fileUploader.getAttachments();if(xc&&xc.length){wc.has_attachment=true;wc.raw_attachments=xc;}var yc=uc._photoUploader.getSelectedFBIDs();if(yc.length>0){wc.has_attachment=true;wc.photo_fbids=yc;}var zc=uc._fileUploader.getImageFiles();if(zc.length>0){wc.has_attachment=true;wc.image_ids=zc;}var ad=uc._fileUploader.getAnimatedImageFiles();if(ad.length>0){wc.has_attachment=true;wc.gif_ids=ad;}var bd=uc._fileUploader.getVideoFiles();if(bd.length>0){wc.has_attachment=true;wc.video_ids=bd;}var cd=uc._fileUploader.getAudioFiles();if(cd.length>0){wc.has_attachment=true;wc.audio_ids=cd;}var dd=uc._fileUploader.getFiles();if(dd.length>0){wc.has_attachment=true;wc.file_ids=dd;}if(uc._shareLinkUploader.getAttachData()){wc.has_attachment=true;wc.content_attachment=uc._shareLinkUploader.getAttachData();}wc.force_sms=true;wc.ui_push_phase=n.UIPushPhase;return wc;}function ec(uc,vc,wc){uc.waterfallStep(ga.SESSION_POSTED);uc._sendSubscription=mb.send(vc,function(xc){uc.waterfallStep(ga.POST_PUBLISHED);if(!wc){jb.clearDraft(xc);hc(uc);}uc._messageSent=true;var yc=uc.getStickersFlyoutToggler(),zc=false;if(yc)zc=ua.isShown(yc);var ad=s.getFromMeta(ob.getThreadMetaNow(xc)),bd=ka.DETAIL.RECENT_MESSAGES;if(la.getCurrentDetailState()!==bd)la.updateDetailState(bd,{thread_id:xc,folder:ad,reuse_composer:wc});uc._messageSent=false;if(yc&&zc)ua.show(yc);},w.WEBMESSENGER);uc.focusComposer();}function fc(uc,vc){var wc=la.getCurrentStateData(),xc=lb.constructUserGeneratedMessageObject('',ca.TITAN_WEB,wc.thread_id,wc.participants);if(!xc.thread_id&&!xc.specific_to_list.length)return;xc.has_attachment=true;xc.sticker_id=vc;ec(uc,xc,true);}function gc(uc){if(uc._fileUploader.isUploading()||uc._photoUploader.isUploading()){ic(uc,true);return;}var vc=dc(uc),wc=t.isEmpty(uc._composerBox);if((wc&&!vc.has_attachment)||(!vc.thread_id&&!vc.specific_to_list.length))return;if(m.hasClass(uc._bottomShelfComposer,pb)){m.show(uc._loadingIndicator);m.hide(uc._replyButtonLabel);uc._composerBox.setAttribute('disabled','disabled');}ec(uc,vc);}function hc(uc){t.reset(uc._composerBox);rc(uc);uc._typingDetector&&uc._typingDetector.resetState();uc._fileUploader.removeAttachments();uc._shareLinkUploader.clear();if(uc._photoUploader.getSelectedFBIDs().length>0)uc._photoUploader.clear();m.hide(uc._loadingIndicator);m.show(uc._replyButtonLabel);uc._composerBox.removeAttribute('disabled');if(uc._sendSubscription)uc._sendSubscription=null;ic(uc,false);}function ic(uc,vc){m.conditionShow(uc._uploadingWarning,vc);uc._blockedOnUpload=vc;}function jc(){var uc=la.getCurrentDetailState(),vc=la.getCurrentStateData();delete vc.message_action;la.updateDetailState(uc,vc);}function kc(uc){var vc=uc._manager.getSelectedMessageIDs().length;i.send(new j('/ajax/mercury/delete_messages_dialog.php').setData({count:vc}),function(wc){wc.subscribe('confirm',lc.bind(null,uc,wc));});}function lc(uc,vc){var wc=uc._manager.getSelectedMessageIDs();mb["delete"](uc._threadID,wc);vc.hide();var xc=la.getCurrentStateData();if(xc.message_action){var yc=eb({},xc);delete yc.message_action;la.updateDetailState(la.getCurrentDetailState(),yc);}}function mc(uc){var vc=uc._manager.getSelectedMessageIDs().length;i.send(new j('/ajax/mercury/mark_spam_messages_dialog.php').setData({count:vc}),function(wc){wc.subscribe('confirm',nc.bind(null,uc,wc));});}function nc(uc,vc){var wc=uc._manager.getSelectedMessageIDs();mb.markSpam(uc._threadID,wc);vc.hide();var xc=la.getCurrentStateData();if(xc.message_action){var yc=eb({},xc);delete yc.message_action;la.updateDetailState(la.getCurrentDetailState(),yc);}}function oc(uc){if(uc._messageSent)return false;if(!t.isEmpty(uc._composerBox))return true;var vc=uc._fileUploader.getAttachments();if((vc&&vc.length)||uc._fileUploader.getImageFiles().length>0||uc._fileUploader.getAnimatedImageFiles().length>0||uc._fileUploader.getVideoFiles().length>0||uc._fileUploader.getAudioFiles().length>0||uc._fileUploader.getFiles().length>0||uc._shareLinkUploader.getAttachData()||uc._photoUploader.getSelectedFBIDs().length>0)return true;var wc=la.getCurrentStateData(),xc=la.getCurrentDetailState(),yc=xc==ka.DETAIL.COMPOSE_MAIN||xc==ka.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||xc==ka.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(yc&&!wc.start&&(wc.participants||[]).length)return true;return false;}function pc(uc){ja.onBeforeUnload(function(){var vc=wa.getNextURI();if(!vc.getQueryData().hasOwnProperty('theater')&&!ya.isVaultBoxURI(vc))jb.saveDraft(uc._threadID,uc._composerBox,uc._fileUploader,uc._shareLinkUploader,uc._photoUploader);if(!ib(vc)&&!vc.getQueryData().hasOwnProperty('theater')&&!ya.isVaultBoxURI(vc)&&oc(uc))return hb._("Vous n\u2019avez pas envoy\u00e9 votre message.");},true);ja.onBeforeUnload(function(){if(ib(wa.getNextURI())&&oc(uc))return hb._("Vous n\u2019avez pas envoy\u00e9 votre message.");},false);ja.onUnload(function(){jb.saveDraft(uc._threadID,uc._composerBox,uc._fileUploader,uc._shareLinkUploader,uc._photoUploader);});}function qc(uc,vc){m.show(uc._bottomShelfComposer);m.addClass(uc._bottomShelfComposer,'invisible_elem');m.conditionClass(uc._bottomShelfButtons,'delete',vc==ka.MESSAGE_ACTION.DELETE);m.conditionClass(uc._bottomShelfButtons,'report_spam',vc==ka.MESSAGE_ACTION.REPORT_SPAM);m.show(uc._bottomShelfButtons);}function rc(uc){qa.set(uc._emoteWrapper,v.isRTL()?'right':'left',(uc._composerBox.clientWidth+22)+'px');}function sc(uc){if(uc._typingDetector){var vc=uc._threadID,wc=null;if(vc){wc=x.getUserIDFromThreadID(vc);var xc=ob.getThreadMetaNow(vc);if((!xc||xc.is_canonical)&&!wc)vc=null;}if(!vc){uc._typingDetector.setUserAndThread(wc,vc);return;}kb.getServerThreadID(vc,function(yc){uc._typingDetector.setUserAndThread(wc,yc);});}}function tc(uc,vc,wc){if(o.contains(uc._ariaOwns,wc))uc._composerBox.setAttribute('aria-activedescendant',wc);}e.exports=qb;},null);
__d("WebMessengerSharedPhotos.react",["AsyncRequest","Bootloader","cx","copyProperties","fbt","glyph","Grid.react","LoadingIndicator.react","Pixelz.react","React","Image.react","WebMessengerStateConstants","WebMessengerStateManager","URI","XUIButton.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=p,w=v.PropTypes,x=m.GridItem,y=k._("Revenir \u00e0 la conversation"),z=42,aa=p.createClass({displayName:"WebMessengerSharedPhotos",propTypes:{threadID:w.string.isRequired,totalWidth:w.number.isRequired},getInitialState:function(){return {isLoadingMore:true,moreImages:true,imagesData:{}};},componentDidMount:function(){this.requestImages();},componentDidUpdate:function(){if(!this.isVisible())this.requestImages();},componentWillReceiveProps:function(ba){if(ba.threadID&&ba.threadID!==this.props.threadID)this.setState({isLoadingMore:true,moreImages:true,imagesData:{}});},isVisible:function(){return !(this.state.isLoadingMore&&this.state.moreImages&&Object.keys(this.state.imagesData).length===0);},loadMoreImages:function(){if(this.state.moreImages&&!this.state.isLoadingMore){this.setState({isLoadingMore:true});this.requestImages();}},renderImages:function(){var ba=Math.floor((this.props.totalWidth-z)/3),ca=Object.keys(this.state.imagesData).map(function(da){return (p.createElement(x,null,p.createElement("div",{className:"_5dq3",onClick:this.viewFullImage.bind(null,da)},p.createElement(o,{upscale:true,width:ba,height:ba,resizeMode:'cover',src:this.state.imagesData[da].URI,borderRadius:1,insetBorderColor:"rgba(0, 0, 0, 0.1)"}))));}.bind(this));return ca;},viewFullImage:function(ba){var ca=t('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:this.props.threadID,image_id:ba});h.loadModules(["MessagesViewer","MessagesViewerSetID"],function(da,ea){da.bootstrapWithConfig({fbid:ba,dimensions:this.state.imagesData[ba].dim,src:this.state.imagesData[ba].URI,disablePaging:Object.keys(this.state.imagesData).length===1,endpoint:ca,setID:ea.MESSAGES_VIEW_ALL_IN_THREAD});}.bind(this));},requestImages:function(){new g().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod("POST").setData({thread_id:this.props.threadID,offset:Object.keys(this.state.imagesData).length,limit:30}).setHandler(function(ba){this.setState({isLoadingMore:false,moreImages:ba.payload.moreImagesToLoad,imagesData:j({},this.state.imagesData,ba.payload.imagesData)});}.bind(this)).send();},returnToThread:function(){var ba=j({},s.getCurrentStateData());s.updateDetailState(r.DETAIL.RECENT_MESSAGES,ba);},render:function(){var ba=(p.createElement("div",{className:((this.isVisible()?"_5dq2":'')+(!this.isVisible()?' '+"_5dq1":'')+(!this.isVisible()?' '+"_5dpz":''))},p.createElement(n,{color:"white",size:"large"})));if(!this.isVisible()){return ba;}else if(!this.state.isLoadingMore)ba=null;return (p.createElement("div",{className:"_5dpz"},p.createElement("div",{className:"_5dp-"},p.createElement(u,{image:p.createElement(q,{src:l('back')}),label:y,size:"medium",onClick:this.returnToThread})),p.createElement("div",{className:"_5dq0"},p.createElement(m,{cols:3,fixed:false},this.renderImages()),ba)));}});e.exports=aa;},null);
__d("WebMessengerDetailViewSharedPhotosControl",["CSS","DOM","React","WebMessengerSharedPhotos.react","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerEvents","WebMessengerSubscriptionsHandler","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=b('MercuryServerRequests').get();function p(q,r){"use strict";this.manager=q;this.rootElement=r;this.component=null;this.serverID=null;this.state=null;this.threadID=null;h.empty(this.rootElement);n.addSubscriptions(this.manager.subscribe('scrolledNearBottom',this.notifyImageRequest.bind(this)),m.subscribe(m.DETAIL_DOM_CHANGED,this.render.bind(this)));}p.prototype.hideView=function(){"use strict";g.hide(this.rootElement);};p.prototype.updateView=function(){"use strict";g.show(this.rootElement);this.updateStateAndData();this.render();};p.prototype.destroy=function(){"use strict";n.release();};p.prototype.updateStateAndData=function(){"use strict";this.state=l.getCurrentDetailState();var q=l.getCurrentStateData();this.threadID=q.thread_id;};p.prototype.render=function(){"use strict";this.serverID=o.getServerThreadIDNow(this.threadID);if(!this.serverID)return;if(!this.component){this.component=i.createElement(j,{threadID:this.serverID,totalWidth:this.rootElement.clientWidth});this.component=i.render(this.component,this.rootElement);}else this.component.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});};p.prototype.notifyImageRequest=function(){"use strict";var q=l.getCurrentDetailState();if(q===k.DETAIL.SHARED_PHOTOS&&this.manager.isScrolledToBottom()&&this.component)this.component.loadMoreImages();};e.exports=p;},null);
__d("WebMessengerEmployeeAwaySheet",["ArbiterMixin","DOM","mixin","WebMessengerTemplates"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i(g);for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o,p,q){"use strict";this.$WebMessengerEmployeeAwaySheet0=o;this.$WebMessengerEmployeeAwaySheet1=p;this.$WebMessengerEmployeeAwaySheet2=q;}n.prototype.render=function(){"use strict";var o=j[':fb:mercury:employee-away-sheet'].build();h.setContent(this.$WebMessengerEmployeeAwaySheet1,o.getRoot());};n.prototype.isPermanent=function(){"use strict";return true;};n.prototype.getType=function(){"use strict";return 'employee-away';};n.prototype.open=function(){"use strict";this.$WebMessengerEmployeeAwaySheet2.open(this);};n.prototype.close=function(){"use strict";this.$WebMessengerEmployeeAwaySheet2.close(this);};e.exports=n;},null);
__d("WebMessengerThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","WebMessengerTemplates","fbt","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=l(h);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r){"use strict";this._rootElement=q;this._sheetView=r;}p.prototype.render=function(){"use strict";var q=j[':fb:web-messenger:read-view:message-mute-sheet'].build();i.setContent(q.getNode('text'),k._("Cette conversation est mise en sourdine. Les onglets de conversation n\u2019appara\u00eetront pas et les notifications push sont d\u00e9sactiv\u00e9es."));i.setContent(this._rootElement,q.getRoot());g.listen(q.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));};p.prototype.isPermanent=function(){"use strict";return false;};p.prototype.getType=function(){"use strict";return 'wb-thread-is-muted';};p.prototype.open=function(){"use strict";this._sheetView.open(this);};p.prototype.close=function(){"use strict";this._sheetView.close(this);};e.exports=p;},null);
__d("WebMessengerDetailViewSheetControl",["DOM","ArbiterMixin","WebMessengerStateManager","MercurySheetView","MercuryThreadInfo","WebMessengerTemplates","WebMessengerEmployeeAwaySheet","ChatEmployeeAwayWarning","WebMessengerThreadIsMutedTabSheet","WebMessengerSubscriptionsHandler","mixin","MercuryThreadInformer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=b('MercuryThreadInformer').get(),s=b('MercuryThreadActions').get(),t=b('MercuryThreads').get(),u=q(h);for(var v in u)if(u.hasOwnProperty(v))x[v]=u[v];var w=u===null?null:u.prototype;x.prototype=Object.create(w);x.prototype.constructor=x;x.__superConstructor__=u;function x(y){"use strict";this._template=l[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=i.getCurrentStateData().thread_id;this._sheetView=new j(this._threadID,this._rootElement,y);this._employeeAwaySheet=new m(this._threadID,this._rootElement,this._sheetView);this._threadIsMutedTabSheet=new o(this._rootElement,this._sheetView);this._muteSetting=(void 0);g.setContent(y,this._template.getRoot());this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){s.unmute(this._threadID);}.bind(this));p.addSubscriptions(this._sheetView.subscribe('resize',this.inform.bind(this,'resize')),r.subscribe('threads-updated',function(z,aa){if(this._threadID&&aa[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);}x.prototype.updateView=function(){"use strict";var y=i.getCurrentStateData().thread_id;if(this._threadID!=y){this._threadID=y;this.updateTabSheet(true);}};x.prototype.updateTabSheet=function(y){"use strict";if(!this._threadID)return;t.getThreadMeta(this._threadID,function(z){var aa=k.getMuteSetting(z);if(aa!=this._muteSetting||y){if(aa){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=aa;}n.updateEmployeeAwayWarning(z,function(){this._employeeAwaySheet.open();}.bind(this),function(){this._employeeAwaySheet.close();}.bind(this));}.bind(this));};x.prototype.destroy=function(){"use strict";this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();this._employeeAwaySheet&&this._employeeAwaySheet.close();};e.exports=x;},null);
__d("WebMessengerDetailViewControlManager",["Event","ArbiterMixin","CSS","WebMessengerDetailViewHeaderControl","DOM","WebMessengerFlexibleScrollArea","WebMessengerDetailViewActionsMenuControl","WebMessengerDetailViewAllPeopleResultsControl","WebMessengerDetailViewComposeTypeaheadControl","WebMessengerDetailViewRecentMessagesControl","WebMessengerDetailViewSearchContextControl","WebMessengerDetailViewSearchSnippetsControl","WebMessengerDetailViewBottomShelfControl","WebMessengerDetailViewSharedPhotosControl","WebMessengerMessagesSelection","Parent","WebMessengerDetailViewSheetControl","WebMessengerStateManager","WebMessengerStateConstants","Style","UserAgent_DEPRECATED","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTemplates","mixin","getElementPosition"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){b.__markCompiled&&b.__markCompiled();var ga=ea(h);for(var ha in ga)if(ga.hasOwnProperty(ha))ja[ha]=ga[ha];var ia=ga===null?null:ga.prototype;ja.prototype=Object.create(ia);ja.prototype.constructor=ja;ja.__superConstructor__=ga;function ja(ka){"use strict";this._rootElement=ka;k.empty(this._rootElement);var la=da[':fb:web-messenger:read-view'].build();k.setContent(this._rootElement,la.getRoot());this._readContainer=la.getNode('readContainer');this._headerControl=new j(la.getNode('detailViewHeader'));this._actionsMenuControl=new m(la.getNode('detailViewActionsMenu'),this._headerControl);this._allPeopleResultsControl=new n(la.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new o(la.getNode('detailViewComposeTypeahead'),la.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new q(this,la.getNode('detailViewSearchContext'),la.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new r(this,la.getNode('detailViewSearchSnippets'));this._sharedPhotosControl=new t(this,la.getNode('detailViewSharedPhotos'));this._sheetControl=new w(la.getNode('detailViewSheetTab'));var ma=la.getNode('detailViewBottomShelf');this._bottomShelfControl=new s(this,ma);this._detailViewScroller=la.getNode('readMessagesScroller');ca.addSubscriptions(g.listen(this._detailViewScroller,'click',function(oa){if(v.byTag(oa.getTarget(),'a')||k.getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var na={fade:!!aa.osx(),persistent:true};this._flexArea=new l(this._detailViewScroller,na).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();ca.addSubscriptions(ba.subscribe(ba.DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),ba.subscribe(ba.SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),x.subscribe(y.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));ca.addSubscriptions(this._sheetControl.subscribe('resize',this._flexArea.draw.bind(this._flexArea)));this._recentMessagesControl=new p(this,la.getNode('detailViewRecentMessages'),la.getNode('loadingSpinner'),la.getNode('noSelectedConversation'),la.getNode('newMessageLink'),la.getNode('showUnreadLink'),ma);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,k.find(this._detailViewScroller,'div.uiScrollableAreaBody')];}ja.prototype.updateOnStateChange=function(){"use strict";var ka=x.getCurrentDetailState(),la=this._stateData;this._stateData=x.getCurrentStateData();this._flexArea.setTabbable(ka!==y.DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();i.removeClass(this._readContainer,'blankComposeState');i.conditionClass(this._readContainer,'blankComposeState',ka===y.DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(ka){case y.DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case y.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();case y.DETAIL.COMPOSE_MAIN:case y.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case y.DETAIL.SHARED_PHOTOS:this._sharedPhotosControl.updateView();break;case y.DETAIL.SEARCH_SNIPPET:case y.DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case y.DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(ka){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:if(la.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}};ja.prototype.hideAll=function(){"use strict";this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();this._bottomShelfControl.hideView();};ja.prototype.getSelectedMessageIDs=function(){"use strict";var ka=x.getCurrentDetailState();switch(ka){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:return u.getSelectedMessageIDs();}return [];};ja.prototype.scrollIntoView=function(ka){"use strict";this._flexArea&&this._flexArea.scrollIntoView(ka);};ja.prototype.setScrollTop=function(ka,la){"use strict";this._flexArea&&this._flexArea.setScrollTop(ka,la);};ja.prototype.isScrolledToBottom=function(){"use strict";return this._flexArea&&this._flexArea.isScrolledToBottom();};ja.prototype.scrollToBottom=function(ka){"use strict";this._flexArea&&this._flexArea.scrollToBottom(ka);};ja.prototype.draw=function(){"use strict";this._flexArea&&this._flexArea.draw();};ja.prototype.poke=function(){"use strict";this._flexArea&&this._flexArea.poke();};ja.prototype.addScrollCallback=function(ka){"use strict";this._flexArea&&this._flexArea.addScrollCallback(ka);};ja.prototype.getFlexAreaBoundingClientRect=function(){"use strict";return fa(this._flexArea.flexArea);};ja.prototype.resizeTo=function(ka){"use strict";if(ka!==null){ka=ka.toString();if(!ka.endsWith('%')||ka.endsWith('px'))ka=ka+'px';}this._resizeNodes.forEach(function(la){z.set(la,'width',ka);});ba.detailDOMChanged();};ja.prototype.destroy=function(){"use strict";this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._sharedPhotosControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();};e.exports=ja;},null);
__d("WebMessengerAuxMenu",["SelectableMenu","MenuSelectableItem","MenuTheme","PopoverMenuOverlappingBorder","Popover","PopoverMenu"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o){"use strict";this._menu=new g([],{className:o,theme:i});var p=new k(n.parentNode,n,null,{alignh:'right'});new l(p,n,this._menu,[j]);}m.prototype.addOption=function(n,o){"use strict";var p=new h({markup:n,title:''});p.setOnClickHandler(o);this._menu.addItem(p);return p;};m.prototype.destroy=function(){"use strict";};e.exports=m;},null);
__d("WebMessengerMenuFolderControl",["WebMessengerAuxMenu","CSS","Parent","WebMessengerTemplates","Toggler","cx","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n,o;function p(r){return i.byClass(r,"_282");}function q(r,s,t){"use strict";var u=!n||n!=s;n=s;this._template=j[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',r);if(!o||u){o=new g(n,"_1j");h.show(p(n));m.addSubscriptions(k.subscribe(['show','hide'],function(v,w){var x=w.getActive(),y=x&&i.byClass(x,"_282");if(y)h.conditionClass(y,"_50p_",v==='show');}));}this._menuItem=o.addOption(this._template.getRoot(),t);this._menuItem.getRoot();}q.prototype.getCountBadge=function(){"use strict";return this._template.getNode('count');};q.prototype.setSelected=function(r){"use strict";h.conditionClass(p(n),'selectedFolder',r);if(r){this._menuItem.select();}else this._menuItem.deselect();};q.prototype.destroy=function(){"use strict";o&&o.destroy();};e.exports=q;},null);
__d("MessagingFilteringNux",["Arbiter","AsyncRequest","LayerDestroyOnHide","LayerHideOnTransition","MercuryConfig","isWebMessengerURI"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=null,n,o={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function(p){g.subscribe(o.DIALOG_REGISTERED_EVENT,function(){if(!m)return;m.setContext(p);m.show();m=null;},g.SUBSCRIBE_ALL);},registerDialog:function(p){m=p.disableBehavior(i).disableBehavior(j);n=g.subscribe('page_transition',function(q,r){if(!l(r.uri)){p&&p.destroy();n.unsubscribe();}},g.SUBSCRIBE_NEW);if(p)p.subscribe('confirm',function(){k.filtering_active=true;new h('/ajax/web_messenger/dismiss_filtering_nux.php').send();p.hide();g.inform(o.ACCEPTED_EVENT,{});});g.inform(o.DIALOG_REGISTERED_EVENT,{},g.BEHAVIOR_PERSISTENT);}};e.exports=o;},null);
__d("WebMessengerTabbedFolderControl",["Event","CSS","WebMessengerTemplates"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k,l,m,n){"use strict";this._template=i[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',k);this._listener=g.listen(this._template.getNode('link'),'click',m);if(n)this._countListener=g.listen(this._template.getNode('count'),'click',n);l.push(this._template.getRoot());}j.prototype.getCountBadge=function(){"use strict";return this._template.getNode('count');};j.prototype.setSelected=function(k){"use strict";h.conditionClass(this._template.getRoot(),'selectedFolder',k);};j.prototype.getElement=function(){"use strict";this._template.getRoot();};j.prototype.destroy=function(){"use strict";this._listener.remove();this._countListener&&this._countListener.remove();};e.exports=j;},null);
__d("WebMessengerEditFilteringSettingDialog",["AsyncDialog","AsyncRequest","MercuryConstants","DOM","csx"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l='/ajax/mercury/edit_filtering_type.php',m='/ajax/mercury/change_filtering_type.php',n={show:function(){var o=function(q){var r=q.getRoot(),s=j.find(r,"._cq6").checked,t=j.find(r,"._cq7").checked,u='';if(s){u=i.MessagingFilteringType.MODERATE;}else if(t)u=i.MessagingFilteringType.STRICT;new h(m).setData({filtering_type:u}).send();q.hide();},p=function(q){q.subscribe('confirm',o.bind(null,q));q.show();};g.send(new h(l),p);}};e.exports=n;},null);
__d("MercuryOrderedThreadlist",["LogHistory","MercuryActionType","MercuryFilters","MercuryFolders","MercuryPayloadSource","MercurySingletonMixin","MessagingTag","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();'use strict';var t=g.getInstance('ordered_threadlist_model'),u=i.getSupportedFilters().concat([i.ALL,m.GROUPS]),v=j.getSupportedFolders();function w(ga,ha,ia,ja){var ka=[],la=false,ma=false,na=(ha||[]).filter(function(ua){var va=ua.filter||i.ALL;return (ua.folder==ia||(!ua.folder&&ia==m.INBOX))&&va==ja;}),oa=ga._threadlistOrderMap[ia][ja].getAllResources(),pa;na.forEach(function(ua){ka=ka.concat(ua.thread_ids);if(ua.error){if(ua.end>oa.length)ma=ua.error;}else{var va=ua.end-ua.start;if(ua.thread_ids.length<va)la=true;}if(!pa||ua.end>pa)pa=ua.end;});aa(ga,ka,ia,ja);if(la){ga._threadlistOrderMap[ia][ja].setReachedEndOfArray();}else if(ma){ga._threadlistOrderMap[ia][ja].setError(ma);}else{var qa=ga._threadlistOrderMap[ia][ja].getCurrentArraySize();if(pa&&qa<pa){var ra={},sa=oa.concat(ka),ta=sa.filter(function(ua){var va=ra[ua];ra[ua]=true;return va;});if(ta.length){t.warn('duplicate_threads',{folder:ia,expected_final_size:pa,actual_final_size:qa,duplicate_thread_ids:ta});ga._serverRequests.fetchThreadlistInfo(pa,ta.length,ia,ja==i.ALL?null:ja);}}}}function x(ga,ha){v.forEach(function(ia){u.forEach(function(ja){w(ga,ha,ia,ja);});});}function y(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ha.forEach(function(ja){if(ja.is_forward)return;var ka=ja.thread_id,la=ba(ga,ka),ma=ca(ga,ka);function na(){ma.forEach(function(pa){ia[la][pa].to_add.push(ka);if(!ga._threadlistOrderMap[la][pa].hasReachedEndOfArray()&&!ga._threadlistOrderMap[la][pa].hasResource(ka))ia[la][pa].to_remove_if_last_after_add[ka]=true;});}function oa(pa){if(r(u,pa))if(r(ma,pa)){ia[la][pa].to_add.push(ka);}else ia[la][pa].to_remove.push(ka);}if(!la){if(ja.action_type===h.CHANGE_FOLDER||ja.action_type===h.CHANGE_ARCHIVED_STATUS)v.forEach(function(pa){if(pa!==la)u.forEach(function(qa){ga._threadlistOrderMap[pa][qa].removeResources([ka]);});});return;}switch(ja.action_type){case h.DELETE_THREAD:ma.forEach(function(pa){ia[la][pa].to_remove.push(ka);});break;case h.CHANGE_ARCHIVED_STATUS:case h.CHANGE_FOLDER:na();break;case h.CHANGE_READ_STATUS:oa(m.UNREAD);break;case h.USER_GENERATED_MESSAGE:case h.LOG_MESSAGE:ma.forEach(function(pa){if(da(ga,ka,la,pa))ia[la][pa].to_add.push(ka);});break;}});v.forEach(function(ja){u.forEach(function(ka){var la=ga._threadlistOrderMap[ja][ka];aa(ga,ia[ja][ka].to_add,ja,ka);for(var ma=la.getCurrentArraySize()-1;ma>=0;ma--){var na=la.getResourceAtIndex(ma);if(!ia[ja][ka].to_remove_if_last_after_add[na])break;ia[ja][ka].to_remove.push(na);}la.removeResources(ia[ja][ka].to_remove);});});}function z(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]=[];});});ha.forEach(function(ja){var ka=ba(ga,ja.thread_id),la=ca(ga,ja.thread_id);if(ka)la.forEach(function(ma){if(da(ga,ja.thread_id,ka,ma))ia[ka][ma].push(ja.thread_id);});});v.forEach(function(ja){u.forEach(function(ka){if(ia[ja][ka].length>0)aa(ga,ia[ja][ka],ja,ka);});});}function aa(ga,ha,ia,ja){ja=ja||i.ALL;ga._threadlistOrderMap[ia][ja].addResources(ha);v.forEach(function(ka){if(ka!=ia)ga._threadlistOrderMap[ka][ja].removeResources(ha);});}function ba(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=null;if(!ia){ja='No thread metadata';}else if(!ia.folder)ja='No thread folder';if(ja){var ka={error:ja,tid:ha};t.warn('no_thread_folder',ka);return null;}var la=ia.folder;if(ia.is_archived)la=m.ACTION_ARCHIVED;if(ga._threadlistOrderMap[la]){return la;}else return null;}function ca(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=[i.ALL];if(!ia){var ka={error:'no_thread_metadata',tid:ha};t.warn('no_thread_metadata',ka);return [];}if(ia.unread_count)ja.push(m.UNREAD);if(!ia.is_canonical)ja.push(m.GROUPS);return ja;}function da(ga,ha,ia,ja){var ka=ga._threads.getThreadMetaNow(ha);return ka&&ka.timestamp&&ba(ga,ha)==ia&&r(ca(ga,ha),ja);}function ea(ga){this._fbid=ga;this._serverRequests=o.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._threads=q.getForFBID(this._fbid);this._threadlistOrderMap={};v.forEach(function(ha){this._threadlistOrderMap[ha]={};u.forEach(function(ia){this._threadlistOrderMap[ha][ia]=new n(function(ja){return this._threads.getThreadMetaNow(ja).timestamp;}.bind(this),function(ja,ka){return ka-ja;},this._serverRequests.canLinkExternally.bind(this._serverRequests));}.bind(this));}.bind(this));this._serverRequests.subscribe('update-threadlist',function(ha,ia){if(!fa(ia))return;var ja=ia.ordered_threadlists;if(ja&&ja.length){x(this,ja);}else{var ka=(ia.actions||[]).filter(function(la){return la.thread_id;});z(this,ia.threads||[]);y(this,ka);}this._threadInformer.updatedThreadlist();}.bind(this));}s(ea.prototype,{getThreadlist:function(ga,ha,ia,ja,ka,la){return this.getFilteredThreadlist(ga,ha,ia,i.ALL,ja,ka,la);},getFilteredThreadlist:function(ga,ha,ia,ja,ka,la,ma){var na=this._threadlistOrderMap[ia][ja],oa=na.executeOrEnqueue(ga,ha,ka,la),pa=na.getUnavailableResources(oa),qa=na.getError(ga,ha,la);if(pa.length||qa){if(na.getCurrentArraySize()<ga){var ra={start:ga,limit:ha,filter:ja,resources_size:na.getCurrentArraySize()};t.warn('range_with_gap',ra);}na.setError(false);this._serverRequests.fetchThreadlistInfo(na.getCurrentArraySize(),pa.length,ia,ja==i.ALL?null:ja,ma);}return oa;},getThreadlistUntilTimestamp:function(ga,ha,ia){ia=ia||i.ALL;return this._threadlistOrderMap[ha][ia].getElementsUntil(ga);},getAvailableThreadlistNow:function(ga,ha){ha=ha||i.ALL;return this._threadlistOrderMap[ga][ha].getAllResources();},getThreadCount:function(ga,ha){ha=ha||i.ALL;return this._threadlistOrderMap[ga][ha].getCurrentArraySize();},hasLoadedThreadlist:function(ga,ha){ha=ha||i.ALL;return this._threadlistOrderMap[ga][ha].hasReachedEndOfArray();},unsubscribe:function(ga,ha,ia){ia=ia||i.ALL;this._threadlistOrderMap[ha][ia].unsubscribe(ga);}});s(ea,l);function fa(ga){switch(ga.payload_source){case k.CLIENT_CHANGE_ARCHIVED_STATUS:case k.CLIENT_CHANGE_READ_STATUS:case k.CLIENT_CHANGE_FOLDER:case k.CLIENT_CHANNEL_MESSAGE:case k.CLIENT_DELETE_MESSAGES:case k.CLIENT_DELETE_THREAD:case k.CLIENT_SEND_MESSAGE:case k.SERVER_SEND_MESSAGE:case k.SERVER_CONFIRM_MESSAGES:case k.SERVER_FETCH_THREADLIST_INFO:case k.SERVER_THREAD_SYNC:return true;case k.SERVER_INITIAL_DATA:return ga.ordered_threadlists;default:return false;}}e.exports=ea;},null);
__d("WebMessengerMercury",["MercuryMessages","MercuryOrderedThreadlist","MercuryServerRequests","WebMessengerStateManager","MercuryThreadInformer","MercuryThreadActions","MercuryThreads","MercuryUnreadState","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p={getMessages:function(){return g.getForFBID(q());},getOrderedThreadlist:function(){return h.getForFBID(q());},getServerRequests:function(){return i.getForFBID(q());},getThreadInformer:function(){return k.getForFBID(q());},getThreadActions:function(){return l.getForFBID(q());},getThreads:function(){return m.getForFBID(q());},getUnreadState:function(){return n.getForFBID(q());},getUnseenState:function(){return o.getForFBID(q());}};function q(){return j.getCurrentUserID();}e.exports=p;},null);
__d("WebMessengerMasterViewTabBarControl",["JSXDOM","Arbiter","CSS","DOM","Event","Ellipsizer","WebMessengerMenuFolderControl","MercuryConfig","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingFilteringNux","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTabbedFolderControl","WebMessengerTemplates","WebMessengerEditFilteringSettingDialog","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerMercury","copyProperties","csx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){b.__markCompiled&&b.__markCompiled();function ea(la,ma,na){"use strict";this._manager=la;this._rootElement=ma;this._rootTopContentElement=na;this._threadInformer=aa.getThreadInformer();this._unreadState=aa.getUnreadState();j.empty(this._rootElement);var oa=w[':fb:web-messenger:master-view:tab-bar'].build(),pa=w[':fb:web-messenger:master-view:top-content'].build();j.setContent(this._rootElement,oa.getRoot());j.setContent(this._rootTopContentElement,pa.getRoot());this._tabList=oa.getRoot();this._moreMenu=oa.getNode('moreMenu');this._topContentCont=pa.getRoot();this._topContent=pa.getNode('masterViewTopContentHolder');this._closeButton=pa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=pa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=p.getSupportedFolders();this._foldersToHeader={};this._filters=o.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=g.a({href:"#"},da._("Tout marquer comme lu"));this._unreadMarkAllRead=g.a({href:"#"},da._("Tout marquer comme lu"));this._otherEditSettings=g.a({href:"#"},da._("Modifier les pr\u00e9f\u00e9rences"));var qa=[];this._filters.forEach(function(ta){var ua=ja.bind(null,this,s.INBOX,ta);switch(ta){case s.UNREAD:this._filtersToHeader[ta]=this._filtersToHeader[ta]||new m(da._("Non lus"),this._moreMenu,ua);break;}}.bind(this));this._folders.forEach(function(ta){var ua=ja.bind(null,this,ta,o.ALL),va=ja.bind(null,this,ta,s.UNREAD);switch(ta){case s.INBOX:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v(da._("Bo\u00eete de r\u00e9ception"),qa,ua,va);break;case s.OTHER:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v(da._("Autre"),qa,ua);break;case s.ACTION_ARCHIVED:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m(da._("Archiv\u00e9(s)"),this._moreMenu,ua);break;case s.SPAM:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m(da._("Contenu ind\u00e9sirable"),this._moreMenu,ua);break;}}.bind(this));j.prependContent(this._tabList,qa);var ra=j.scry(this._tabList,"._6xt");ra.push(oa.getNode('moreMenuLabel'));this._ellipsizer=new l(ra);fa(this);var sa=ja.bind(null,this,s.INBOX,o.ALL);h.subscribe(r.ACCEPTED_EVENT,ia.bind(null,this));z.addSubscriptions(this._threadInformer.subscribe('unread-updated',ka.bind(null,this)),k.listen(this._otherMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.OTHER);}.bind(this)),k.listen(this._unreadMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.INBOX);}.bind(this)),k.listen(this._otherEditSettings,'click',function(){x.show();}),k.listen(this._closeButton,'click',sa));}ea.prototype.updateView=function(){"use strict";var la=ha(this);ga(this);if(la)ia(this);fa(this);};ea.prototype.getOtherFolderLabel=function(){"use strict";var la=s.OTHER,ma=this._foldersToHeader[la];if(!ma||!ma._template)return null;return ma._template.getNode('folderLabel');};ea.prototype.destroy=function(){"use strict";for(var la in this._foldersToHeader)this._foldersToHeader[la]&&this._foldersToHeader[la].destroy();for(var ma in this._filtersToHeader)this._filtersToHeader[ma]&&this._filtersToHeader[ma].destroy();};function fa(la){var ma=85;j.scry(la._tabList,"._1r").forEach(function(na){ma+=na.offsetWidth;});la._ellipsizer.confineWithin(la._rootElement.offsetWidth-ma,1.3);}function ga(la){var ma=u.getCurrentStateData();la._state=u.getCurrentMasterState();la._folder=ma.folder;la._filter=ma.filter;la._query=ma.query;}function ha(la){if(!la._state||!la._folder)return true;var ma=u.getCurrentStateData();if(la._folder!=ma.folder)return true;if(la._filter!=ma.filter)return true;return false;}function ia(la){var ma=false,na;la._folders.forEach(function(oa){var pa=la._filter==s.UNREAD,qa=oa==la._folder&&(la._filter==o.ALL||pa),ra,sa;switch(oa){case s.INBOX:if(pa){var ta=g.strong(null,da._("Non lus")),ua=g.strong(null,da._("Bo\u00eete de r\u00e9ception")),va=da._("Messages {unread} dans {inbox}",[da.param("unread",ta),da.param("inbox",ua)]);ra=g.div(null,va,' \u00b7 ',la._unreadMarkAllRead);sa=true;}break;case s.OTHER:var wa='';if(n.filtering_active)wa=g.span(null,la._otherEditSettings,' \u00b7 ');ra=g.div(null,g.p(null,g.strong(null,da._("Conseil\u00a0:")+' '),da._("Vous voyez un message d\u2019une personne que vous connaissez\u00a0? Il suffit de r\u00e9pondre ou de cliquer sur D\u00e9placer vers la bo\u00eete de r\u00e9ception dans le menu Actions.")),wa,la._otherMarkAllRead);r.tryShow(la.getOtherFolderLabel());break;}if(qa){na=oa;i.conditionShow(la._closeButtonCont,sa);}else la._foldersToHeader[oa].setSelected(false);if(qa&&ra){ma=true;j.setContent(la._topContent,ra);}});la._filters.forEach(function(oa){var pa=la._folder==s.INBOX&&oa==la._filter;la._filtersToHeader[oa].setSelected(pa);});na&&la._foldersToHeader[na].setSelected(true);i.conditionShow(la._topContentCont,ma);ka(la);la._manager.draw();}function ja(la,ma,na){var oa=la._state==t.MASTER.SEARCH;if(oa||la._folder!=ma||la._filter!=na){var pa=ba({},u.getCurrentStateData()),qa=u.getCurrentDetailState();if(qa!==t.DETAIL.SEARCH_SNIPPET&&qa!==t.DETAIL.SEARCH_CONTEXT)delete pa.query;u.updateMasterState(t.MASTER.RECENT_THREADS,ba(pa,{folder:ma,filter:na}));}y.focusComposer();return false;}function ka(la){for(var ma in la._foldersToHeader){if(ma==s.ACTION_ARCHIVED)continue;var na=la._unreadState.exceedsMaxCount(ma)?q.MAX_UNREAD_COUNT+'+':la._unreadState.getUnreadCount(ma),oa=[la._foldersToHeader[ma].getCountBadge()];if(ma==s.INBOX)la._filters.forEach(function(pa){oa.push(la._filtersToHeader[pa].getCountBadge());});oa.forEach(function(pa){if(na)j.setContent(pa,da._("({unread_count})",[da.param("unread_count",na)]));i.conditionShow(pa,na);});}fa(la);}e.exports=ea;},null);
__d("MercuryLocalThreadResults",["MercuryFolders","MercuryIDs","MercurySingletonMixin","MercuryOrderedThreadlist","MercuryParticipants","MercuryThreadSearchUtils","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(o){"use strict";this.$MercuryLocalThreadResults0=o;this.$MercuryLocalThreadResults1=j.getForFBID(this.$MercuryLocalThreadResults0);this.$MercuryLocalThreadResults2=m.getForFBID(this.$MercuryLocalThreadResults0);}n.prototype.findMatchingThreadsFromIds=function(o,p){"use strict";return p.filter(function(q){var r=this.$MercuryLocalThreadResults2.getThreadMetaNow(q);return this.$MercuryLocalThreadResults3(r,o);}.bind(this));};n.prototype.findMatchingThreads=function(o){"use strict";var p=[];g.getSupportedFolders().forEach(function(q){p=p.concat(this.$MercuryLocalThreadResults1.getThreadlistUntilTimestamp(0,q));}.bind(this));return this.findMatchingThreadsFromIds(o,p);};n.prototype.$MercuryLocalThreadResults3=function(o,p){"use strict";var q=this.$MercuryLocalThreadResults4(o.participants),r=l.wordsInString(p),s=null;k.getMulti(q,function(t){s=q.map(function(u){return t[u];});});if(!s)return false;return l.allMatchPredicate(r,function(t){var u=l.anyMatchPredicate(s,function(w){return w&&w.name&&l.queryWordMatchesAnyNameWord(t,l.wordsInString(w.name));}),v=o.name&&l.queryWordMatchesAnyNameWord(t,l.wordsInString(o.name));return u||v;});};n.prototype.$MercuryLocalThreadResults4=function(o){"use strict";if(o.length===1&&h.tokenize(o[0]).value===this.$MercuryLocalThreadResults0)return o;return o.filter(function(p){var q=h.tokenize(p).value;return q!==this.$MercuryLocalThreadResults0;}.bind(this));};Object.assign(n,i);e.exports=n;},null);
__d("MercurySearchThreadResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercurySingletonMixin","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=new g(),o=j.WEBMESSENGER_THREAD_COUNT,p=j.WEBMESSENGER_MORE_COUNT;function q(r){"use strict";this.$MercurySearchThreadResults0=r;this.$MercurySearchThreadResults1=m.getForFBID(this.$MercurySearchThreadResults0);l.registerEndpoints({'/ajax/mercury/search_threads.php':{request_user_id:r,mode:l.IMMEDIATE,handler:function(s){this.handleUpdate(s);}.bind(this)}});}q.prototype.getThreadlist=function(r,s){"use strict";if(r){var t=n.executeOrEnqueue(r,function(w){var x=w.getAllResources(),y=w.hasReachedEndOfArray();s(x,y);}),u=n.getUnavailableResources(t),v=h.WEBMESSENGER;if(u.length)this.$MercurySearchThreadResults2({client:v,query:r,offset:0,limit:o+1});return t;}};q.prototype.isExhausted=function(r){"use strict";var s=n.getResource(r);return s?s.hasReachedEndOfArray():false;};q.prototype.getCachedThreadlist=function(r){"use strict";var s=n.getResource(r);return s?s.getAllResources():null;};q.prototype.cacheThreadlist=function(r,s){"use strict";n.getResource(r);var t=new k();t.addResourcesWithoutSorting(s,0);t.setReachedEndOfArray();n.setResource(r,t);};q.prototype.getMoreThreadlist=function(r,s){"use strict";if(r){var t=n.getResource(r);if(t){var u=t.getCurrentArraySize(),v=p,w=t.executeOrEnqueue(0,u+v,function(){var y=t.getAllResources(),z=t.hasReachedEndOfArray();s(y,z);}),x=t.getUnavailableResources(w);if(x.length)this.$MercurySearchThreadResults2({query:r,offset:u,limit:v+1});return w;}}};q.prototype.handleUpdate=function(r){"use strict";if(r.mercury_payload)this.$MercurySearchThreadResults1.handleUpdate(r.mercury_payload);var s=r.search_threads||{};for(var t in s){var u=s[t]||[],v=u.map(this.$MercurySearchThreadResults1.getClientThreadIDNow.bind(this.$MercurySearchThreadResults1)),w=n.getResource(t);if(w){this.$MercurySearchThreadResults3(w,v,p+1);}else{w=new k();this.$MercurySearchThreadResults3(w,v,o+1);n.setResource(t,w);}}};q.prototype.unsubscribe=function(r,s){"use strict";if(s){var t=n.getResource(s);if(t){t.unsubscribe(r);}else n.unsubscribe(r);}};q.prototype.setInitialCount=function(r){"use strict";o=r;};q.prototype.$MercurySearchThreadResults3=function(r,s,t){"use strict";var u=r.getCurrentArraySize(),v=s.length<t;if(!v)s.pop();r.addResourcesWithoutSorting(s,u);if(v)r.setReachedEndOfArray();};q.prototype.$MercurySearchThreadResults2=function(r){"use strict";r.client=h.WEBMESSENGER;r.index='fbid';l.trySend('/ajax/mercury/search_threads.php',r,null,this.$MercurySearchThreadResults0);};Object.assign(q,i);e.exports=q;},null);
__d("MercurySearchThreadsStrategy",["WebMessengerConstants","MercuryLocalThreadResults","MercurySingletonMixin","MercurySearchThreadResults","copyProperties","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=null,n=null,o=g.SEARCH_THREAD_DELAY;function p(q){"use strict";this.$MercurySearchThreadsStrategy0=q;this.$MercurySearchThreadsStrategy1=h.getForFBID(this.$MercurySearchThreadsStrategy0);this.$MercurySearchThreadsStrategy2=j.getForFBID(this.$MercurySearchThreadsStrategy0);}p.prototype.clearTimer=function(){"use strict";m=null;clearTimeout(n);n=null;};p.prototype.search=function(q,r,s,t){"use strict";if(q!=m){m=q;clearTimeout(n);n=null;}var u=this.$MercurySearchThreadsStrategy1.findMatchingThreads(q),v=this.$MercurySearchThreadsStrategy2.getCachedThreadlist(q);if(v){var w=this.$MercurySearchThreadsStrategy3(u,v);r(w);s([],this.$MercurySearchThreadsStrategy2.isExhausted(q));t(null,q);return;}var x=this.$MercurySearchThreadsStrategy4(q),y=this.$MercurySearchThreadsStrategy3(u,x.thread_ids);if(x.from_exhausted_remote_results){this.$MercurySearchThreadsStrategy2.cacheThreadlist(q,y);r(y);s([],true);t(null,q);return;}r(y);n=setTimeout(function(){var z=this.$MercurySearchThreadsStrategy2.getThreadlist(q,s);t(z,q);}.bind(this),o);};p.prototype.$MercurySearchThreadsStrategy4=function(q){"use strict";var r='',s=[];for(var t=q.length-1;t>0;t--){var u=q.slice(0,t),v=this.$MercurySearchThreadsStrategy2.getCachedThreadlist(u);if(!v)continue;if(this.$MercurySearchThreadsStrategy2.isExhausted(u)){return {from_exhausted_remote_results:true,thread_ids:this.$MercurySearchThreadsStrategy1.findMatchingThreadsFromIds(q,v)};}else if(r.length===0){r=u;s=this.$MercurySearchThreadsStrategy1.findMatchingThreadsFromIds(q,v);}}return {from_exhausted_remote_results:false,thread_ids:s};};p.prototype.$MercurySearchThreadsStrategy3=function(q,r){"use strict";return Object.keys(k(l(q),l(r)));};Object.assign(p,i);e.exports=p;},null);
__d("WebMessengerMasterViewSearchInputControl",["Event","CSS","DOM","Input","Keys","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerSubscriptionsHandler","WebMessengerEvents","cx","MercurySearchThreadsStrategy"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercurySearchThreadsStrategy').get();function t(ba,ca){"use strict";this._manager=ba;this._rootElement=ca;i.empty(this._rootElement);var da=o[':fb:web-messenger:master-view:search-input'].build();i.replace(this._rootElement,da.getRoot());this._searchBox=da.getRoot();this._searchInput=da.getNode('searchInput');this._searchClear=da.getNode('searchClear');this._searchButton=i.find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');p.addSubscriptions(q.subscribe(q.UPDATE_SELECTION,aa.bind(null,this)),g.listen(this._searchButton,'click',function(){var ea=j.getValue(this._searchInput);if(ea)y(this,ea);}.bind(this)),g.listen(this._searchClear,'click',x.bind(null,this)),g.listen(this._searchInput,'keyup',function(event){var ea=j.getValue(this._searchInput);if(event.keyCode==k.ESC){x(this);}else if(event.keyCode==k.RETURN&&ea){l.openSearchThread();}else if(ea){z(this,ea);}else if(ea!==n.getCurrentStateData().query){x(this);this.focus();}return false;}.bind(this)),g.listen(this._searchInput,'focus',function(ea){this._focused=true;}.bind(this)),g.listen(this._searchInput,'blur',function(ea){this._focused=false;}.bind(this)));}t.prototype.updateView=function(){"use strict";var ba=v(this);u(this);if(ba)w(this);};t.prototype.focusAndSelectSearch=function(){"use strict";y(this,j.getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();};t.prototype.focus=function(){"use strict";setTimeout((function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}).bind(this),0);};t.prototype.destroy=function(){"use strict";};function u(ba){var ca=n.getCurrentStateData();ba._state=n.getCurrentMasterState();ba._folder=ca.folder;if(ba._state!=m.MASTER.SEARCH){ba._query=null;}else ba._query=ca.query;}function v(ba){if(!ba._state||!ba._folder)return true;var ca=n.getCurrentMasterState(),da=n.getCurrentStateData();if(ba._folder!=da.folder)return true;if(ca!=ba._state)return true;if(ca==m.MASTER.SEARCH&&ba._query!=da.query)return true;return false;}function w(ba){if(ba._state==m.MASTER.SEARCH){var ca=ba._query||'';if(j.getValue(ba._searchInput)!=ca)j.setValue(ba._searchInput,ca);ba.focus();}else{j.reset(ba._searchInput);ba._searchInput.blur();}h.conditionClass(ba._searchBox,"_47",!j.isEmpty(ba._searchInput));}function x(ba){s.clearTimer();var ca=n.getCurrentStateData();ca.no_uri=true;delete ca.query;n.updateMasterState(m.MASTER.RECENT_THREADS,ca);}function y(ba,ca){var da=n.getCurrentMasterState();if(da!=m.MASTER.SEARCH)ba._threadID=n.getCurrentStateData().thread_id;if(ca)n.updateDetailState(m.DETAIL.SEARCH_SNIPPET,{query:ca,message_query:ca});}function z(ba,ca){var da=n.getCurrentStateData();if(ca!==da.query){var ea=n.getCurrentMasterState();if(ea!=m.MASTER.SEARCH)ba._threadID=da.thread_id;if(ca)n.updateMasterState(m.MASTER.SEARCH,{all_people_query:da.all_people_query,message_query:da.message_query,message_id:da.message_id,query:ca,thread_id:da.thread_id});}}function aa(ba,ca,da){if(i.contains(ba._ariaOwns,da))ba._searchInput.setAttribute('aria-activedescendant',da);}e.exports=t;},null);
__d("MercuryLogger",["JSLogger","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=b('MercuryServerRequests').get(),i=b('MercuryThreads').get(),j=g.create('messaging_impressions');function k(event,o){j.log(event,o);}function l(o,p){var q=i.getThreadMetaNow(o);if(q){var r=h.getServerThreadIDNow(o);if(r){var event=p?'thread_search':'thread',s={is_single_thread:q.is_canonical_user,is_subscribed:q.is_subscribed,query:p||null};s.thread_fbid=r;k(event,s);}j.bump('opened_thread_'+q.folder);}}function m(o,p){var q={};p.forEach(function(r){var s=h.getServerThreadIDNow(r),t=i.getThreadMetaNow(r);if(t&&s){var u={is_single_thread:t.is_canonical_user,folder:t.folder,participants:t.participants,canonical_fbid:t.canonical_fbid};u.thread_fbid=s;q[s]=u;}});k('threadlist',{folder:o,threads:q});j.bump('opened_threadlist_'+o);}var n={logThread:function(o){l(o);},logThreadlist:function(o,p){m(o,p);},logThreadFromSearch:function(o,p){l(p,o);},logThreadlistFromSearch:function(o,p){k('threadlist_search',{folder:p,query:o});}};e.exports=n;},null);
__d("WebMessengerMasterViewUnseenMessagesNotice",["MercuryThreadlistConstants","MessagingTag","WebMessengerStateManager","UserActivity","WebMessengerSubscriptionsHandler","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerMercury","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=m.THREADLIST_SCROLLTOP_OFFSET,q=g.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var r in l)if(l.hasOwnProperty(r))t[r]=l[r];var s=l===null?null:l.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=l;function t(y){"use strict";l.call(this);this._manager=y;this._threadInformer=n.getThreadInformer();this._unseenState=n.getUnseenState();k.addSubscriptions(this._threadInformer.subscribe('messages-received',function(z,aa){var ba=!j.isActive(q),ca=!this.isScrolledWithinTopThreshold();if(!s.getActive.call(this)||w(aa)||!v(aa))return;if(s.onlyReceivedFromSelf.call(this,aa))return;if(ba){this.removeMessageNotice();this._manager.scrollToTop();}else if(ca)this.showMessageNotice();}.bind(this)),this._threadInformer.subscribe('unseen-updated',u.bind(null,this)));this._manager.addScrollCallback(o.withBlocking(function(z){if(s.getActive.call(this)&&z.getScrollTop()<=m.THREADLIST_TOP_OFFSET&&j.isActive(q)&&x()){this.removeMessageNotice();this._unseenState.markAsSeen();}}.bind(this),100,null));}t.prototype.isScrolledWithinTopThreshold=function(){"use strict";return this._manager.getScrollTop()<=p;};t.prototype.showMessageNotice=function(){"use strict";if(!x())return;var y=function(){this._manager.scrollToTop();}.bind(this);s.showMessageNotice.call(this,y,'below');};function u(y){if(y._unseenState.getUnseenCount()===0)y.removeMessageNotice();}function v(y){for(var z in y)for(var aa=0;aa<y[z].length;aa++)if(y[z][aa].folder==h.INBOX)return true;return false;}function w(y){var z=i.getCurrentStateData().thread_id,aa=true;for(var ba in y)if(y.hasOwnProperty(ba))if(ba!==z){aa=false;break;}return x()&&aa;}function x(){var y=i.getCurrentStateData().folder;return y===h.INBOX;}e.exports=t;},null);
__d("WebMessengerMasterViewRecentThreadsControl",["CSS","DOM","Event","MercuryLogger","MercuryAPIArgsSource","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingTag","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","WebMessengerConstants","WebMessengerEvents","WebMessengerInfoBoxRenderer","WebMessengerSubscriptionsHandler","WebMessengerMasterViewUnseenMessagesNotice","WebMessengerMercury","createObjectFrom","cx","ge","fbt","UserActivity"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){b.__markCompiled&&b.__markCompiled();b('UserActivity');var ea='recent:';function fa(xa,ya,za,ab){"use strict";this._manager=xa;this._rootElement=ya;this._infoBox=za;this._orderedThreadlist=z.getOrderedThreadlist();this._serverRequests=z.getServerRequests();this._threadInformer=z.getThreadInformer();this._threads=z.getThreads();this._unseenState=z.getUnseenState();h.empty(this._rootElement);this._pagerExponent=-1;var bb=s[':fb:web-messenger:threadlist'].build();h.setContent(this._rootElement,bb.getRoot());this._loadingSpinner=bb.getNode('loadingSpinner');this._threadlistRows=bb.getNode('threadlistRows');this._loadMoreButton=bb.getNode('loadMoreButton');this._loadMoreLink=bb.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=m.getSupportedFolders();this._filters=l.getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(cb){this._currentCountMap[cb]={};this._filters.concat([l.ALL]).forEach(function(db){this._currentCountMap[cb][db]=n.WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new y(this._manager);this._unseenMessagesNotice.setNoticeContextNode(ab);x.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(cb,db){sa(this,aa(db));}.bind(this)),i.listen(this._loadMoreLink,'click',function(){ra(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&ra(this);}.bind(this)));}fa.prototype.updateView=function(){"use strict";this._active=true;this._unseenMessagesNotice.updateView();g.show(this._rootElement);var xa=ha(this),ya=ia(this),za=this._folder,ab=this._selection;ja(this);if(ya)ka(this,ab);if(xa){qa(this);}else la(this);if(za!=this._folder)j.logThreadlist(this._folder,this._threadIDs);if(this._selection&&ab!=this._selection)j.logThread(this._selection);};fa.prototype.hideView=function(){"use strict";this._active=false;this._unseenMessagesNotice.hideView();g.hide(this._rootElement);};fa.prototype.destroy=function(){"use strict";ga(this);this._unseenMessagesNotice.destroy();};function ga(xa){xa._threadlistSubscription&&xa._orderedThreadlist.unsubscribe(xa._threadlistSubscription.subscriber_id,xa._threadlistSubscription.folder,xa._threadlistSubscription.filter);xa._threadlistSubscription=null;}function ha(xa){var ya=r.getCurrentStateData();if((xa._folder!=ya.folder)||(xa._filter!=ya.filter))return true;return false;}function ia(xa){var ya=r.getCurrentStateData();if(xa._selection!=ya.thread_id)return true;return false;}function ja(xa){var ya=r.getCurrentStateData();xa._state=r.getCurrentMasterState();if((xa._folder!=ya.folder)||(xa._filter!=ya.filter))xa._pageExponent=-1;xa._folder=ya.folder;xa._filter=ya.filter;xa._selection=ya.thread_id;}function ka(xa,ya){var za=ca(wa(ya));if(za){g.removeClass(za,"_kv");za.removeAttribute('aria-selected');}var ab=ca(wa(xa._selection));if(ab){g.addClass(ab,"_kv");ab.setAttribute('aria-selected','true');}v.updateSelection(ab&&ab.id);}function la(xa){if(xa._active)p.updateThreadlistIndex(xa,xa._threadIDs.map(wa),wa(xa._selection));}function ma(xa){g.addClass(xa._manager.getFlexAreaElement(),"_3j6");g.addClass(xa._manager.getFlexAreaElement(),"_3j7");}function na(xa){g.removeClass(xa._manager.getFlexAreaElement(),"_3j6");g.removeClass(xa._manager.getFlexAreaElement(),"_3j7");}function oa(xa){g.hide(xa._threadlistRows);na(xa);}function pa(xa){if(xa._threadIDs.length){g.show(xa._threadlistRows);na(xa);}else{g.hide(xa._threadlistRows);ma(xa);}}function qa(xa){g.show(xa._loadingSpinner);g.hide(xa._infoBox);oa(xa);g.hide(xa._loadMoreButton);ga(xa);var ya=xa._orderedThreadlist.getFilteredThreadlist(n.RECENT_THREAD_OFFSET,xa._currentCountMap[xa._folder][xa._filter],xa._folder,xa._filter,function(za,ab){g.hide(xa._loadingSpinner);ta(xa,za,ab);pa(xa);la(xa);xa._manager.poke();xa._manager.forceFireScrollCallbacks();},null,k.WEBMESSENGER);if(ya)xa._threadlistSubscription={subscriber_id:ya,folder:xa._folder,filter:xa._filter};}function ra(xa){if(xa._requestInFlight||g.hasClass(xa._loadMoreButton,'hidden_elem'))return;xa._requestInFlight=true;g.addClass(xa._loadMoreButton,'async_saving');xa._pagerExponent=Math.min(xa._pagerExponent+1,u.EXPONENTIAL_PAGER_MAX_CYCLES);var ya=Math.pow(2,xa._pagerExponent),za=xa._currentCountMap[xa._folder][xa._filter]+ya*(n.WEBMESSENGER_MORE_COUNT);ga(xa);var ab=xa._orderedThreadlist.getFilteredThreadlist(n.RECENT_THREAD_OFFSET,za,xa._folder,xa._filter,function(bb,cb){g.removeClass(xa._loadMoreButton,'async_saving');xa._currentCountMap[xa._folder][xa._filter]=za;ta(xa,bb,cb);la(xa);xa._manager.poke();xa._requestInFlight=false;},null,k.WEBMESSENGER);if(ab)xa._threadlistSubscription={subscriber_id:ab,folder:xa._folder,filter:xa._filter};}function sa(xa,ya){if(!xa._folder||!xa._olderTimestamp[xa._folder])return;var za=xa._orderedThreadlist.getThreadlistUntilTimestamp(xa._olderTimestamp[xa._folder],xa._folder,xa._filter);if(xa._filter==o.UNREAD){za=va(xa,za);}else xa._unreadThreadIDs=[];if(za.length>xa._currentCountMap[xa._folder][xa._filter])xa._currentCountMap[xa._folder][xa._filter]=za.length;xa._threadIDs=za;pa(xa);t.renderThreadsFromIDs(xa._threadlistRows,za,xa._selection,wa,ya,q.MASTER.RECENT_THREADS);la(xa);xa._manager.poke();}function ta(xa,ya,za){var ab=(ya.length==xa._currentCountMap[xa._folder][xa._filter]);if(ab)ya.pop();if(ya.length){var bb=ya[ya.length-1];xa._threads.getThreadMeta(bb,function(cb){xa._olderTimestamp[xa._folder]=cb.timestamp;},k.WEBMESSENGER);}if(xa._filter==o.UNREAD){xa._unreadThreadIDs=ya;}else xa.unreadThreadIDs=[];g.conditionShow(xa._loadMoreButton,ab);xa._threadIDs=ya;t.renderThreadsFromIDs(xa._threadlistRows,ya,xa._selection,wa,null,q.MASTER.RECENT_THREADS);za=za&&ya.length===0;za&&ua(xa);g.conditionShow(xa._infoBox,za);}function ua(xa){if(xa._builtErrorMessage)return;h.setContent(xa._infoBox,w.render(da._("Impossible de charger les conversations"),[{text:da._("R\u00e9essayer"),handler:qa.bind(null,xa)}]));xa._builtErrorMessage=true;}function va(xa,ya){ya.forEach(function(za){if(xa._unreadThreadIDs.indexOf(za)<0)xa._unreadThreadIDs.push(za);});xa._unreadThreadIDs.sort(function(za,ab){var bb=xa._threads.getThreadMetaNow(za).timestamp,cb=xa._threads.getThreadMetaNow(ab).timestamp;return cb-bb;});xa._unreadThreadIDs=xa._unreadThreadIDs.filter(function(za){var ab=xa._threads.getThreadMetaNow(za);return m.getFromMeta(ab)==xa._folder;});return xa._unreadThreadIDs;}function wa(xa){if(xa)return ea+xa;return null;}e.exports=fa;},null);
__d("MercurySearchThreadResultOrderer",["MercurySingletonMixin","MessagingTag","MercuryThreads","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(o){"use strict";this.$MercurySearchThreadResultOrderer0=o;this.$MercurySearchThreadResultOrderer1=i.getForFBID(o);}k.prototype.separateCanonicalThreadsInFolder=function(o,p){"use strict";var q=[],r=[];o.forEach(function(s){var t=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(s);if(t.folder===p&&t.is_canonical){q.push(s);}else r.push(s);}.bind(this));return {canonical_in_folder:q.sort(function(s,t){return this.$MercurySearchThreadResultOrderer2(s,t);}.bind(this)),remaining:r};};k.prototype.filterThreadsInFolder=function(o,p){"use strict";var q=[];o.forEach(function(r){var s=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(r);if(s.folder===p&&s.is_archived===false){q.push(r);}else if(p===h.ACTION_ARCHIVED&&s.is_archived===true)q.push(r);}.bind(this));return q;};k.prototype.orderResults=function(o,p,q,r){"use strict";var s=n(p,q),t=s.sort(this.$MercurySearchThreadResultOrderer3.bind(this,r));return n(o,t);};k.prototype.$MercurySearchThreadResultOrderer3=function(o,p,q){"use strict";var r=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(p),s=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(q),t=l(r),u=l(s);if(t!==u)return m(t,o)>m(u,o)?-1:1;if(r.is_canonical!==s.is_canonical)return r.is_canonical?-1:1;return this.$MercurySearchThreadResultOrderer2(p,q);};k.prototype.$MercurySearchThreadResultOrderer2=function(o,p){"use strict";var q=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(o),r=this.$MercurySearchThreadResultOrderer1.getThreadMetaNow(p);return q.timestamp>r.timestamp?-1:1;};function l(o){return o.is_archived?h.ACTION_ARCHIVED:o.folder;}function m(o,p){if(o===p)return 5;var q={};q[h.INBOX]=4;q[h.ACTION_ARCHIVED]=3;q[h.OTHER]=2;q[h.SPAM]=1;return q[o];}function n(o,p){var q=j(o),r=p.filter(function(s){return !(s in q);});return o.concat(r);}Object.assign(k,g);e.exports=k;},null);
__d("WebMessengerMasterViewSearchThreadsControl",["Event","CSS","DOM","MercuryFolders","MercuryLogger","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","WebMessengerEvents","WebMessengerMercury","WebMessengerSubscriptionsHandler","createObjectFrom","csx","cx","fbt","ge","getElementText","MercurySearchThreadResultOrderer","MercurySearchThreadResults","MercurySearchThreadsStrategy"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=b('MercurySearchThreadResultOrderer').get(),aa=b('MercurySearchThreadResults').get(),ba=b('MercurySearchThreadsStrategy').get(),ca='search:',da='search-indicator';function ea(ab,bb,cb,db){"use strict";this._manager=ab;this._rootElement=bb;this._noMessagesIndicator=db;this._orderedThreadlist=r.getOrderedThreadlist();this._threadInformer=r.getThreadInformer();this._threads=r.getThreads();i.empty(this._rootElement);var eb=o[':fb:web-messenger:thread-search'].build();i.setContent(this._rootElement,eb.getRoot());this._loadingSpinner=eb.getNode('loadingSpinner');this._threadlistRows=eb.getNode('threadlistRows');this._loadMoreButton=eb.getNode('loadMoreButton');this._loadMoreLink=eb.getNode('loadMoreLink');var fb=o[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=fb.getNode('threadSearchResultDescription');this._searchMessagesIndicator=fb.getRoot();this._searchMessagesIndicator.setAttribute('id',ca+da);i.replace(cb,this._searchMessagesIndicator);this._snippetSearchLink=fb.getNode('snippetSearchLink');this._snippetSearchLinkText=fb.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=ga(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;s.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(gb,hb){sa(this,t(hb));}.bind(this)),this._threadInformer.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),g.listen(this._loadMoreLink,'click',function(){ra(this);}.bind(this)),g.listen(this._snippetSearchLink,'click',function(){this.updateKeyboardSelection(da);za(this);}.bind(this)));}ea.prototype.updateView=function(){"use strict";this._active=true;h.show(this._rootElement);h.hide(this._loadingSpinner);var ab=ha(this),bb=ia(this),cb=this._folder,db=this._query,eb=this._selection;ja(this);if(bb||ab){var fb=this._keyboardSelection;switch(this._detailState){case m.DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case m.DETAIL.SEARCH_SNIPPET:case m.DETAIL.SEARCH_CONTEXT:this._keyboardSelection=da;}ka(this,fb);}if(ab){pa(this);}else{la(this,false);qa(this);}if(db!=this._query||cb!=this._folder)k.logThreadlistFromSearch(this._query,this._folder);if(this._selection&&eb!=this._selection)k.logThreadFromSearch(this._query,this._selection);};ea.prototype.hideView=function(){"use strict";this._active=false;h.hide(this._rootElement);ta(this,false);qa(this);};ea.prototype.openSearchThread=function(ab){"use strict";if(ab==da){za(this);}else n.updateDetailState(m.DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:ab});};ea.prototype.updateKeyboardSelection=function(ab){"use strict";var bb=this._keyboardSelection;this._keyboardSelection=ab;ka(this,bb);};ea.prototype.destroy=function(){"use strict";fa(this);};function fa(ab){ab._searchThreadsSubscription&&aa.unsubscribe(ab._searchThreadsSubscription.subscriber_id,ab._searchThreadsSubscription.query);ab._searchThreadsSubscription=null;}function ga(ab){var bb={};j.getSupportedFolders().forEach(function(cb){var db=ab._orderedThreadlist.getThreadlistUntilTimestamp(0,cb);bb[cb]=db.length>0?ab._threads.getThreadMetaNow(db[db.length-1]).timestamp:Infinity;}.bind(this));return bb;}function ha(ab){var bb=ab._namesChangedSinceLastRedraw;ab._namesChangedSinceLastRedraw=false;if(bb)return true;if(!ab._remoteResultsCompleted)return true;var cb=ga(ab),db=ab._oldestTimestamps;ab._oldestTimestamps=cb;var eb=n.getCurrentStateData();if(ab._query!==eb.query||ab._folder!==eb.folder)return true;for(var fb in db)if(db[fb]>cb[fb])return true;return false;}function ia(ab){var bb=n.getCurrentStateData();if(ab._selection!=bb.thread_id)return true;return false;}function ja(ab){var bb=n.getCurrentStateData();ab._detailState=n.getCurrentDetailState();ab._query=bb.query;ab._folder=bb.folder;ab._selection=bb.thread_id;}function ka(ab,bb){var cb=x(xa(bb));if(cb){h.removeClass(cb,"_kv");cb.removeAttribute('aria-selected');}var db=x(xa(ab._keyboardSelection));if(db){h.addClass(db,"_kv");db.setAttribute('aria-selected',true);}q.updateSelection(db&&db.id);}function la(ab,bb){if(ab._keyboardSelection&&ab._keyboardSelection!=da&&ab._threadIDs.indexOf(ab._keyboardSelection)<0)ab._keyboardSelection=null;if(!ab._keyboardSelection)if(ab._threadIDs.length){ab._keyboardSelection=ab._threadIDs[0];}else if(!bb){ab._keyboardSelection=da;ka(ab);}var cb=ab._threadIDs.slice(0);cb.push(da);if(ab._active)l.updateThreadlistIndex(ab,cb.map(xa),xa(ab._keyboardSelection));}function ma(ab){var bb=i.scry(ab._threadlistRows,"._l5");bb.filter(function(cb){return y(cb)!==n.getCurrentStateData().folder;}).forEach(h.show.bind(h));}function na(ab){var bb=i.scry(ab._threadlistRows,"._l5");bb.forEach(h.hide.bind(h));}function oa(ab){ma(ab);ab._manager.draw();}function pa(ab){h.show(ab._loadingSpinner);ta(ab,false);h.hide(ab._threadlistRows);h.hide(ab._loadMoreButton);na(ab);fa(ab);if(ab._query){var bb=[],cb=[];ab._remoteResultsCompleted=false;ba.search(ab._query,function(db){var eb=z.separateCanonicalThreadsInFolder(db,n.getCurrentStateData().folder);bb=eb.canonical_in_folder;cb=eb.remaining;ya(ab);h.show(ab._threadlistRows);va(ab,bb);oa(ab);},function(db,eb){ab._remoteResultsCompleted=true;var fb=z.orderResults(bb,cb,db,n.getCurrentStateData().folder);if(fb.length>0){h.conditionShow(ab._loadMoreButton,!eb);wa(ab,fb);}else ua(ab);h.hide(ab._loadingSpinner);oa(ab);},function(db,eb){if(db)ab._searchThreadsSubscription={subscriber_id:db,query:eb};});}else{ba.clearTimer();h.hide(ab._loadingSpinner);i.empty(ab._threadlistRows);h.show(ab._threadlistRows);ab._threadIDs=[];}qa(ab);}function qa(ab){var bb=!!ab._query&&ab._active,cb=bb^h.shown(ab._searchMessagesIndicator);h.conditionShow(ab._searchMessagesIndicator,bb);ab._manager.sizeToFit(bb);cb&&ab._manager.draw();}function ra(ab){fa(ab);h.addClass(ab._loadMoreButton,'async_saving');var bb=aa.getMoreThreadlist(ab._query,function(cb,db){h.removeClass(ab._loadMoreButton,'async_saving');h.conditionShow(ab._loadMoreButton,!db);wa(ab,cb);ab._manager.poke();});if(bb)ab._searchThreadsSubscription={subscriber_id:bb,query:ab._query};}function sa(ab,bb){if(ab._threadIDs.length){p.renderThreadsFromIDs(ab._threadlistRows,ab._threadIDs,ab._keyboardSelection,xa,bb,m.MASTER.SEARCH);ab._manager.poke();}}function ta(ab,bb){bb=bb&&ab._active;h.conditionClass(ab._searchMessagesIndicator,"_33x",bb!==false);h.conditionShow(ab._noMessagesIndicator,bb!==false);}function ua(ab){ab._threadIDs=[];la(ab,false);var bb=w._("Aucune personne ou conversation nomm\u00e9e {query}",[w.param("query",ab._query)]),cb=i.create('div',{},bb);i.setContent(ab._noMessagesIndicator,cb);ta(ab,true);}function va(ab,bb){wa(ab,bb,true);}function wa(ab,bb,cb){ab._threadIDs=bb;la(ab,cb);p.renderThreadsFromIDs(ab._threadlistRows,bb,ab._keyboardSelection,xa,null,m.MASTER.SEARCH);q.updateSelection(ab._keyboardSelection);if(ab._keyboardSelection==da)ka(ab);}function xa(ab){if(ab)return ca+ab;return null;}function ya(ab){var bb=w._("R\u00e9sultats pour le nom\u00a0: {query}",[w.param("query",ab._query)]);i.setContent(ab._threadSearchResultDescription,bb);}function za(ab){if(ab._query){n.updateDetailState(m.DETAIL.SEARCH_SNIPPET,{query:ab._query,message_query:ab._query});q.focusSearch();}}e.exports=ea;},null);
__d("WebMessengerMasterViewControlManager",["ArbiterMixin","DOM","WebMessengerFlexibleScrollArea","WebMessengerMasterViewTabBarControl","WebMessengerMasterViewSearchInputControl","WebMessengerMasterViewRecentThreadsControl","WebMessengerMasterViewSearchThreadsControl","WebMessengerStateManager","WebMessengerStateConstants","Style","WebMessengerTemplates","WebMessengerEvents","WebMessengerSubscriptionsHandler","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=t(g);for(var v in u)if(u.hasOwnProperty(v))x[v]=u[v];var w=u===null?null:u.prototype;x.prototype=Object.create(w);x.prototype.constructor=x;x.__superConstructor__=u;function x(y){"use strict";this._rootElement=y;h.empty(this._rootElement);var z=q[':fb:web-messenger:master-view'].build();h.setContent(this._rootElement,z.getRoot());this._tabBarControl=new j(this,z.getNode('masterViewTabBar'),z.getNode('masterViewTopContent'));this._searchInputControl=new k(this,z.getNode('masterViewSearchInput'));this._searchThreadsControl=new m(this,z.getNode('masterViewSearchThreads'),z.getNode('searchMessagesIndicator'),z.getNode('noMessages'));this._threadlistRowsWrapper=z.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var aa={fade:true,persistent:true};this._flexArea=new i(this._threadlistRowsWrapper,aa).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new l(this,z.getNode('masterViewRecentThreads'),z.getNode('masterInfoBox'),z.getNode('masterViewTabBar'));s.addSubscriptions(r.subscribe(r.FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),r.subscribe(r.FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),r.subscribe(r.MASTER_DOM_CHANGED,function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}.bind(this)),n.subscribe(o.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,h.find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];}x.prototype.updateOnStateChange=function(){"use strict";var y=n.getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(y){case o.MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case o.MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}};x.prototype.scrollIntoView=function(y,z){"use strict";this._flexArea&&this._flexArea.scrollIntoView(y,z);};x.prototype.scrollToBottom=function(y){"use strict";this._flexArea&&this._flexArea.scrollToBottom(y);};x.prototype.scrollToTop=function(y){"use strict";this._flexArea&&this._flexArea.scrollToTop(y);};x.prototype.isScrolledToTop=function(){"use strict";return this._flexArea&&this._flexArea.isScrolledToTop();};x.prototype.getScrollTop=function(){"use strict";return this._flexArea.getScrollableArea().getScrollTop();};x.prototype.draw=function(){"use strict";this._flexArea&&this._flexArea.draw();};x.prototype.poke=function(){"use strict";this._flexArea&&this._flexArea.poke();};x.prototype.sizeToFit=function(y){"use strict";this._flexArea&&this._flexArea.setSizeToFit(y);};x.prototype.addScrollCallback=function(y){"use strict";this._flexArea&&this._flexArea.addScrollCallback(y);};x.prototype.forceFireScrollCallbacks=function(){"use strict";this._flexArea&&this._flexArea._onScroll();};x.prototype.getFlexAreaElement=function(){"use strict";return this._flexArea.flexArea;};x.prototype.resizeTo=function(y){"use strict";if(y!==null){y=y.toString();if(!(y.endsWith('%')||y.endsWith('px')))y=y+'px';}this._resizeNodes.forEach(function(z){p.set(z,'width',y);});r.masterDOMChanged();};x.prototype.destroy=function(){"use strict";this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();};e.exports=x;},null);
__d("WebMessengerPageTitleRenderer",["DocumentTitle","MercuryAPIArgsSource","MercuryViewer","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","fbt","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=b('MercuryThreadMetadataRenderer').get(),o=b('MercuryThreads').get(),p={updateTitleForState:function(s,t,u){this.withTitleForState(s,t,u||function(v){var w=l.getCurrentDetailState(),x=l.getCurrentStateData();if(s===w&&t===x)g.set(v);});},withTitleForState:function(s,t,u){switch(s){case k.DETAIL.RECENT_MESSAGES:q(t.thread_id,u);break;default:r(u);break;}}};function q(s,t){if(!s){r(t);return;}o.getThreadMeta(s,function(u){if(u.name){t(m._("{conversation_name} - Messages",[m.param("conversation_name",u.name)]));return;}j.getMulti(u.participants,function(v){var w=[];for(var x in v)if(v.hasOwnProperty(x))w.push(v[x]);var y=n.renderParticipantList(s,w,v[i.getID()]?u.participants.length-1:u.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function(z){var aa=[];if(z.length===1&&z[0].id===i.getID()){aa.push(z[0].name);}else for(var ba=0;ba<z.length;ba++)if(z[ba].id!==i.getID())aa.push(z[ba].name);return aa;}});t(m._("{conversation_name} - Messages",[m.param("conversation_name",y)]));});},h.WEBMESSENGER);}function r(s){s(m._("Messages"));}e.exports=p;},null);
__d("WebMessengerPageTitleControl",["WebMessengerPageTitleRenderer","WebMessengerStateManager","WebMessengerStateConstants","WebMessengerSubscriptionsHandler","WebMessengerEvents"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=function(){var m=function(){g.updateTitleForState(h.getCurrentDetailState(),h.getCurrentStateData());};j.addSubscriptions(h.subscribe(i.STATE_CHANGE_EVENT,m),k.subscribe(k.DETAIL_DOM_CHANGED,m));};e.exports=l;},null);
__d("WebMessengerThreadMessagesAgent",["MercuryAPIArgsSource","MessagingTag","WebMessengerConstants","MercuryMessages","MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('MercuryMessages').get(),k=b('MercuryOrderedThreadlist').get(),l=b('MercuryThreadInformer').get(),m=b('MercuryThreads').get(),n=21,o=false,p='n_inbox_n_unreads',q=i.THREADLIST_MAX_READ_PRELOAD_NUM,r=i.THREADLIST_MAX_UNREAD_PRELOAD_NUM;function s(){"use strict";this._active=true;this._iterative=o;this._strategy=p;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(l.subscribe('threadlist-updated',t.bind(null,this)));}s.prototype.turnOn=function(){"use strict";this._active=true;};s.prototype.turnOff=function(){"use strict";this._active=false;};s.prototype.destroy=function(){"use strict";this._threadInformerSubscriptions.forEach(l.unsubscribe);this._threadInformerSubscriptions=[];};function t(w){if(w._active&&!w._requestIsQueued){if(w._requestInFlight){w._requestIsQueued=true;return;}var x=u(w);if(x.length){w._requestInFlight=true;if(x.length>n){x=x.slice(0,n);w._requestIsQueued=true;}}x.forEach(function(y){w._processedThreadIds[y]=true;w._pendingThreadIds[y]=true;j.getThreadMessagesRange(y,0,i.INITIAL_MESSAGES_LIMIT+1,function(){v(w,y);},null,g.WEBMESSENGER);});}}function u(w){var x=k.getThreadlistUntilTimestamp(0,h.INBOX),y=x.filter(function(da){return !w._processedThreadIds[da]&&!j.hasLoadedNMessages(da,i.INITIAL_MESSAGES_LIMIT+1);});if(w._strategy===p){var z=[],aa=[];for(var ba=0;ba<y.length;ba++){var ca=m.getThreadMetaNow(y[ba]);if(ca){if(ca.unread_count&&aa.length<r)aa.push(y[ba]);if(!ca.unread_count&&z.length<q)z.push(y[ba]);if(aa.length>=r&&z.length>=q)break;}}y=z.concat(aa);}return y;}function v(w,x){if(w._pendingThreadIds[x])delete w._pendingThreadIds[x];if(Object.keys(w._pendingThreadIds).length===0){if(!w._iterative)w._active=false;w._requestInFlight=false;if(w._requestIsQueued){w._requestIsQueued=false;t(w);}}}e.exports=s;},null);
__d("WebMessengerAdsControl",["AdsMouseStateStore","Animation","Arbiter","CSS","CurrentUser","DOM","EgoAdsObjectSet","Event","KeyedCallbackManager","MercuryIDs","UIPagelet","URI","UserActivity","Vector","WebMessengerAdsConfig","WebMessengerStateManager","cx","shield","WebMessengerSubscriptionsHandler","copyProperties","cx","csx","throttle","WebMessengerConstants","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,w,aa,ba,ca){b.__markCompiled&&b.__markCompiled();var da=b('MercuryThreads').get(),ea=600,fa=ca.ADS_ROTATION_INTERVAL_PASSIVE,ga=ca.ADS_ROTATION_THRESHOLD_ACTIVE,ha=ca.MAX_ADS,ia=2,ja=165,ka=g.STATES,la='data-height',ma=new o(),na='webMessengerAdsStage',oa=0,pa={};function qa(){}z(qa,{init:function(){this._ads=new m();this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));y.addSubscriptions(s.subscribe(x(this._refreshIfReady,this)),i.subscribe('footerLoaded',function(){ma.setResource('footer',1);}),i.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide','minisidebar/show'],this._sideBarChanged.bind(this)),ma);return this;},setContainer:function(xa){ma.setResource('container',xa);this._container=xa;},setTrackingCodes:function(xa){ma.setResource('codes',xa);},getTrackingCodes:function(){return ma.getResource('codes');},updateRhcID:function(){var xa=l.scry(this._container,'div.ego_section')[0];if(!xa)return;g.updateRhcID(l.getID(xa));},start:function(){this._stage=l.create('div',{id:na,className:"_2rn"});this._ego=l.find(this._container,"._81");l.insertAfter(this._ego,this._stage);this.updateRhcID();this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));y.addSubscriptions(n.listen(window,'resize',ba(this.draw,100,this)),n.listen(this._ego,'mouseenter',x(this._mouseEvent,this,true)),n.listen(this._ego,'mouseleave',x(this._mouseEvent,this,false)));},stateChanged:function(xa,ya){xa=xa||{};ya=ya||{};if(xa.thread_id&&ya.thread_id&&ya.thread_id!==xa.thread_id)this._refreshIfReady(true);},draw:function(){var xa=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!xa)return;this._adjustAdsToFit();},_processOnPageUnits:function(){this._ads.init(va(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function(){this._pageletInProgress=false;var xa=va(this._stage);if(!this._lastMousedOnAds&&xa.length&&!this._focusedOnAds()){l.empty(this._ego);while(this._stage.childNodes.length)l.appendContent(this._ego,this._stage.firstChild);this._ads.init(xa);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function(xa,ya){var za=va(xa);this._loadingCount=za.length;if(!this._loadingCount){this._lastRefresh=Date.now()-fa/2;this._pageletInProgress=false;return;}var ab=function(bb){ua(bb);if(--this._loadingCount<=0)ya();}.bind(this);za.forEach(function(bb){function cb(){setTimeout(ab.bind(null,bb),0);}var db=l.scry(bb,'img.img')[0];if(!db||db.complete){cb();}else n.listen(db,{load:cb,error:cb,abort:cb});}.bind(this));},_adjustAdsToFit:function(){this._drawCount++;var xa=t.getViewportDimensions().y,ya=xa-this._footerHeight-ja,za=ya,ab=0;while(za>0&&ab<this._ads.getCount()){za-=ta(this._ads.getUnit(ab));if(za>=0)ab++;}ab=Math.max(ab,ia);for(var bb=0;bb<this._ads.getCount();bb++)sa(this._ads.getUnit(bb),bb>=ab);j.conditionShow(this._ego,ab);j.addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var cb=l.scry(this._container,'.ego_section');cb.forEach(function(db){ra(db,l.scry(db,'[data-onscreen]').length);});ra(this._container,true);this._registerImpressions(ab);this._registerHoldoutImpressions(ya);i.inform('WebMessengerAdsControl/adjustAds');},_waitOn:function(xa,ya){ma.executeOrEnqueue(xa,ya);},_mouseEvent:function(xa){this._lastMousedOnAds=xa;},intentShown:function(){if(!u.stateRefresh)return false;var xa=g.getState();switch(xa){case ka.STATIONARY:return !u.refreshOnStationary;case ka.INTENT:case ka.HOVER:return true;default:return false;}},_focusedOnAds:function(){return l.contains(this._container,document.activeElement);},_refreshIfReady:function(xa){var ya=xa?ga:fa;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this.intentShown()||this._lastRefresh+ya>Date.now())return;ma.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=q.loadFromEndpoint('WebEgoPane',na,{pid:43,data:[k.getID(),ha,++oa,wa()]},{crossPage:true,bundle:false,handler:this.onLoadHandler.bind(this)});},onLoadHandler:function(){if(!u.fade)return;(new h(this._container)).from('opacity',0).to('opacity',1).duration(ea).go();},_updateFooterHeight:function(){j.hide(this._ego);this._footerHeight=t.getElementDimensions(this._container).y;j.show(this._ego);},_registerImpression:function(xa){var ya=this.getTrackingCodes();if(!ya||!ya[xa])return null;var za=l.create('iframe',{src:r('/ai.php').addQueryData({aed:ya[xa]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});za.setAttribute('aria-hidden','true');l.appendContent(this._container,za);return za;},_registerImpressions:function(xa){var ya=this.getTrackingCodes(),za=pa;pa={};for(var ab=0;ab<xa;ab++){if(!this._ads.getUnit(ab))continue;var bb=l.scry(this._ads.getUnit(ab),"div._4u8");if(!bb.length)continue;var cb=bb[0].getAttribute('data-ad'),db=JSON.parse(cb).adid;if(db in za){pa[db]=za[db];delete za[db];}else{if(!ya||!ya[db])continue;var eb=this._registerImpression(db);delete ya[db];if(eb)pa[db]=eb;}}for(db in za)l.remove(za[db]);},_registerHoldoutImpressions:function(xa){var ya=this._ads.getHoldoutAdIDsForSpace(xa,ta);if(ya)ya.forEach(this._registerImpression.bind(this));},_sideBarChanged:function(xa,ya){if(xa=='sidebar/initialized')ma.setResource('sidebar',1);this._initializedAds&&this.draw();}});function ra(xa,ya){j.conditionClass(xa,"_2rn",!ya);}function sa(xa,ya){j.conditionClass(xa,"_22r",ya);xa.setAttribute('aria-hidden',ya?'true':'false');if(ya){xa.removeAttribute('data-onscreen');}else xa.setAttribute('data-onscreen','1');}function ta(xa){if(!xa)return 0;var ya=xa.getAttribute(la)||ua(xa);return parseInt(ya,10);}function ua(xa){var ya=t.getElementDimensions(xa).y;xa.setAttribute(la,ya);return ya;}function va(xa){return l.scry(xa,'div.ego_unit');}function wa(){var xa=v.getCurrentStateData();if(xa.thread_id){var ya=da.getThreadMetaNow(xa.thread_id);if(ya)return ya.participants.map(function(za){return p.getUserIDFromParticipantID(za);}).filter(function(za){return za&&za!=k.getID();});}return [];}e.exports=qa;},null);
__d("WebMessengerApp",["Arbiter","CSS","WebMessengerDetailViewControlManager","DOM","WebMessengerMasterViewControlManager","MercuryStateCheck","WebMessengerPageTitleControl","PageTransitions","WebMessengerPermalinks","WebMessengerShortcuts","SnowflakePermalinkUtils","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerStateStore","WebMessengerThreadMessagesAgent","URI","WebMessengerAdsControl","cx","emptyFunction","WebMessengerSubscriptionsHandler","WebMessengerWidthControl","clickRefAction","WebMessengerTemplates","MercuryServerRequests","MercuryThreadInformer","MercuryDeliveryState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){b.__markCompiled&&b.__markCompiled();var da=b('MercuryServerRequests').get(),ea=b('MercuryThreadInformer').get();b('MercuryDeliveryState').get();d(['VideoCallCore'],y);var fa,ga;function ha(na,oa){var pa=oa&&oa.getQueryData().hasOwnProperty('theater'),qa=oa&&q.isPermalinkURI(oa);if(pa){fa=g.subscribe('PhotoSnowlift.CLOSE',ia.bind(null,na),g.SUBSCRIBE_NEW);return false;}else if(qa){ga=g.subscribe('PhotoSnowflake.CLOSE',ia.bind(null,na),g.SUBSCRIBE_NEW);return false;}var ra=o.processURI(oa);if(ra){var sa=s.getCurrentStateData();if(ra.redirect){o.goNextURI(ra.master_state,ra.detail_state,ra.data,ra.replace);}else s.updateStateOnURI(ra.master_state,ra.detail_state,ra.data);n.transitionComplete();na._adsControl.stateChanged(sa,s.getCurrentStateData());return true;}ma(na);return false;}function ia(na){n.registerHandler(ha.bind(null,na),6);if(fa){fa.unsubscribe();fa=null;}if(ga){ga.unsubscribe();ga=null;}}function ja(){var na=s.getCurrentStateData();t.setLastSeen(na.folder,na.thread_id);}function ka(na,oa,pa,qa,ra,sa){z.engage();ia(this);g.inform('chat/set_does_page_occlude_tabs',true,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',false,g.BEHAVIOR_PERSISTENT);new u();s.setStandaloneMode(sa);da.handleUpdate(oa);l.get();j.empty(na);var ta=ca[':fb:web-messenger:page-skeleton'].build();j.setContent(na,ta.getRoot());if(s.getStandaloneMode())h.addClass(document.body,"_k0_");p.registerGeneralShortcuts();this._masterViewManager=new k(ta.getNode('masterView'));this._detailViewManager=new i(ta.getNode('detailView'));this._pageTitleControl=new m();qa&&j.prependContent(ta.getRoot(),qa);if(s.getStandaloneMode()){this._widthControl=null;this._masterViewManager.resizeTo(null);this._detailViewManager.resizeTo(null);}else this._widthControl=new aa(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),ra);this._adsControl=w.init();var ua=pa?new v(pa):o.getDefaultURI();ha(this,ua);ba('web_messenger').set_namespace('web_messenger');z.addSubscriptions(ea.subscribe('threads-deleted',function(va,wa){var xa=s.getCurrentStateData().thread_id,ya=s.getCurrentDetailState();if(ya==r.DETAIL.RECENT_MESSAGES&&wa[xa]){s.updateDetailState(r.DETAIL.RECENT_MESSAGES,{thread_id:null});}else ja();}),s.subscribe(r.STATE_CHANGE_EVENT,ja));d(['MercuryBrowserAlerts'],function(va){z.addSubscriptions(ea.subscribe('messages-received',function(wa,xa){for(var ya in xa){var za=xa[ya];for(var ab=0;ab<za.length;ab++)va.messageReceived(za[ab]);}}));va.subscribe('before-alert',function(wa,event){if(event.threadID==la())event.cancelAlert();});});}function la(){var na=s.getCurrentDetailState(),oa=s.getCurrentStateData();if(na==r.DETAIL.RECENT_MESSAGES||na==r.DETAIL.SEARCH_CONTEXT)return oa.thread_id;return null;}function ma(na){var oa=true;d(['ChatTabActions'],function(pa){oa&&pa.persistLocalState();});z.release();g.inform('chat/set_does_page_occlude_tabs',false,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',true,g.BEHAVIOR_PERSISTENT);na._masterViewManager.destroy();na._detailViewManager.destroy();oa=false;}e.exports=ka;},null);
__d("MercuryExpandableDataSource",["MercuryTypeaheadDataSource"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";this.$MercuryExpandableDataSource0=l;this.$MercuryExpandableDataSource1=m;this.$MercuryExpandableDataSource2={};k=k||{};k.maxResults=this.$MercuryExpandableDataSource0;g.call(this,k);}j.prototype.query=function(k,l,m){"use strict";this.setQueryData({offset:0,limit:this.$MercuryExpandableDataSource0});return i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){"use strict";var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){"use strict";if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this.$MercuryExpandableDataSource0;this.setQueryData({offset:k[this.value],limit:this.$MercuryExpandableDataSource1});k[this.value]+=this.$MercuryExpandableDataSource1;if(k[this.value]>this.$MercuryExpandableDataSource3)this.$MercuryExpandableDataSource3=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){"use strict";return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){"use strict";var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){"use strict";return this.$MercuryExpandableDataSource2;};j.prototype.getState=function(k){"use strict";var l=this.getStates();if(!l[k])l[k]={};return l[k];};e.exports=j;},null);
__d("WebMessengerTypeaheadDataSource",["MercuryExpandableDataSource","MercuryIDs","MercuryParticipants","MercuryTypeaheadConstants","WebMessengerStateManager"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();for(var l in g)if(g.hasOwnProperty(l))n[l]=g[l];var m=g===null?null:g.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=g;function n(q){"use strict";q=q||{};q.kanaNormalization=true;g.call(this,q,j.COMPOSER_THREADS_INITIAL_LIMIT,j.COMPOSER_SHOW_MORE_LIMIT);this.setMaxResults(j.COMPOSER_WM_MAX);}n.prototype.bootstrap=function(){"use strict";if(!m.bootstrap.call(this))this.fetchEntryBigProfilePic();};n.prototype.updateBootstrapData=function(){"use strict";m.updateBootstrapData.call(this);this.fetchEntryBigProfilePic();};n.prototype.buildData=function(q){"use strict";var r=[],s=[],t=[],u=[],v=[];q.forEach(function(x){var y=m.getEntry.call(this,x);switch(y.render_type){case j.FRIEND_TYPE:if(r.length<j.COMPOSER_FRIENDS_MAX)r.push(x);break;case j.THREAD_TYPE:var z=y.mercury_thread.thread_fbid;y.uid=z;m.setEntry.call(this,z,y);if(o().length===0)s.push(z);break;case j.NON_FRIEND_TYPE:if(t.length<j.COMPOSER_NON_FRIENDS_MAX)t.push(x);break;case j.FB4C_TYPE:if(u.length<j.COMPOSER_FB4C_MAX)u.push(x);break;case j.PAGE_TYPE:if(v.length<j.COMPOSER_PAGES_MAX&&o().length===0)v.push(x);break;}},this);var w=r.concat(u,s,v,t);return m.buildData.call(this,w);};n.prototype.query=function(q,r,s){"use strict";this.value=q;if(!m.query.call(this,q,r,s)){if(this.getState('loaded_all_threads_per_query')[q]==null)this.getState('loaded_all_threads_per_query')[q]=true;this.getState('loaded_initial_per_query')[q]=true;}this.logQuery({event:'query_web_messenger',query:q});};n.prototype.respond=function(q,r,s){"use strict";var t=m.respond.call(this,q,r,s);this.logResponse({event:'query_response_web_messenger',response_query:q,response_uids:r});return t;};n.prototype.getQueryData=function(q,r){"use strict";var s=m.getQueryData.call(this,q,r);s.existing_token_ids=o();return s;};n.prototype.fetchHandler=function(q,r){"use strict";this.getState('loaded_all_threads_per_query')[r.value]=q.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[r.value]=true;m.fetchHandler.call(this,q,r);};n.prototype.hasLoadedInitialResults=function(q){"use strict";if(q===(void 0))q=this.value;return this.getState('loaded_initial_per_query')[q]||(q&&q.length<=1);};n.prototype.hasLoadedAllResults=function(q){"use strict";if(q===(void 0))q=this.value;return this.getState('loaded_all_threads_per_query')[q];};n.prototype.fetchEntryBigProfilePic=function(){"use strict";var q=this.getCachedShortProfileIDs().map(function(r){return h.getParticipantIDFromUserID(r);});i.getBigImageMulti(q,p.bind(this));};n.prototype.loadMore=function(){"use strict";this.setMaxResults(this.buildQueryResults(this.value).length+(j.COMPOSER_SHOW_MORE_LIMIT*2));m.loadMore.call(this);};function o(){var q=k.getCurrentStateData();return (q.participants||[]).map(function(r){return h.tokenize(r).value;});}function p(q){for(var r in q)if(q.hasOwnProperty(r)){var s=this.getEntry(h.getUserIDFromParticipantID(r));if(s)s.photo=q[r];}if(this.value)this.query(this.value);}e.exports=n;},null);
__d("MercuryRecipientsDataSource",["DataSource","MercuryTypeaheadConstants"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(l){"use strict";l=l||{};l.kanaNormalization=true;g.call(this,l);}k.prototype.buildData=function(l){"use strict";var m=[],n=[];l.forEach(function(o){var p=j.getEntry.call(this,o);if(p.render_type==h.NON_FRIEND_TYPE){var q=h.COMPOSER_NON_FRIENDS_MAX;if(n.length<q)n.push(o);}else if(m.length<h.COMPOSER_FRIENDS_MAX){p.render_type=h.FRIEND_TYPE;m.push(o);}}.bind(this));return j.buildData.call(this,m.concat(n));};e.exports=k;},null);
__d("MessagingDebug",["URI","BugBar","WebMessengerMessageIDFinder"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={showTrace:function(k){var l=i.find(k,k.getAttribute('data-selector')),m=new g(k.getAttribute('data-uri'));m.setQueryData({message_id:l,timestamp:k.getAttribute('data-timestamp')});window.open(m.toString(),'_blank');},reportBug:function(k){var l=i.find(k,k.getAttribute('data-selector')),m=k.getAttribute('data-timestamp');h.addMetadata({'Message ID':l});h.addMetadata({'Message Timestamp':m});}};e.exports=j;},null);